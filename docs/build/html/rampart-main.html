

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to Rampart &mdash; Rampart 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/hacks.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rampart 0.1.0 documentation" href="index.html"/>
        <link rel="next" title="rampart.utils" href="rampart-utils.html"/>
        <link rel="prev" title="Welcome to Rampart’s documentation." href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rampart
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Rampart JavaScript</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preface">Preface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#acknowledgement">Acknowledgement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-does-it-do">What does it do?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#features">Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#core-features-of-duktape">Core features of Duktape</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-additions">Rampart additions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rampart-philosophy">Rampart philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rampart-global-variable-and-functions">Rampart Global Variable and Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rampart-globalize">rampart.globalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-utils">rampart.utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-event">rampart.event</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rampart-event-on">rampart.event.on()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rampart-event-trigger">rampart.event.trigger()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rampart-event-off">rampart.event.off()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rampart-event-remove">rampart.event.remove()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-include">rampart.include</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-import">rampart.import</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#csvfile">csvFile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#csv">csv</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#process-global-variable-and-functions">Process Global Variable and Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exit">exit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#env">env</a></li>
<li class="toctree-l3"><a class="reference internal" href="#argv">argv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scriptpath">scriptPath</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getpid">getpid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getppid">getppid</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-require-function-to-import-modules">Using the require Function to Import Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-creating-a-javascript-module">Example creating a JavaScript module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-creating-a-c-module">Example creating a C module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-search-path">Module Search Path</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extra-javascript-functionality">Extra JavaScript Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#object-values">Object.values()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#template-literals">Template Literals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tagged-functions">Tagged Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rest-parameters">Rest Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#template-literals-and-sprintf">Template Literals and sprintf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#settimeout">setTimeout()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cleartimeout">clearTimeout()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setinterval">setInterval()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clearinterval">clearInterval()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#additional-global-variables-and-functions">Additional Global Variables and Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ecmascript-2015-and-babel-js">ECMAScript 2015+ and Babel.js</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#babel-acknowledgement">Babel Acknowledgement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#babel-license">Babel License</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#caveats">Caveats</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rampart-utils.html">Rampart Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sqltoc.html">The rampart-sql module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-server.html">The rampart-server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-html.html">The rampart-html module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-crypto.html">The rampart-crypto module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-curl.html">The rampart-curl module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-lmdb.html">The rampart-lmdb module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-redis.html">The rampart-redis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-robots.html">The rampart-robots module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-cmark.html">The rampart-cmark module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rampart</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Introduction to Rampart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/rampart-main.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction-to-rampart">
<h1>Introduction to Rampart<a class="headerlink" href="#introduction-to-rampart" title="Permalink to this headline">¶</a></h1>
<div class="section" id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="acknowledgement">
<h3>Acknowledgement<a class="headerlink" href="#acknowledgement" title="Permalink to this headline">¶</a></h3>
<p>Rampart uses the <a class="reference external" href="https://duktape.org">Duktape JavaScript Engine</a>. Duktape is an
embeddable JavaScript engine, with a focus on portability and compact footprint.
The developers of Rampart are extremely grateful for the excellent api and
ease of use of this library.</p>
</div>
<div class="section" id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<p>Duktape and the Core Rampart program are MIT licensed.</p>
</div>
<div class="section" id="what-does-it-do">
<h3>What does it do?<a class="headerlink" href="#what-does-it-do" title="Permalink to this headline">¶</a></h3>
<p>Rampart uses a low memory footprint JavaScript interpreter to bring together
several high performance tools and useful utilities for use in Web
and information management applications.  At its core is the Duktape
JavaScript library and added to it is a SQL database, full text search
engine, a fast and innovative NOSQL Mmap database, a fast multi-threaded
webserver, client functionality via the Curl and crypto functions via
Openssl.  It attempts to provide performance, maximum flexibility and
ease of use through the marriage of C code and JavaScript scripting.</p>
</div>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="core-features-of-duktape">
<h3>Core features of Duktape<a class="headerlink" href="#core-features-of-duktape" title="Permalink to this headline">¶</a></h3>
<p>A partial list of Duktape features:</p>
<ul class="simple">
<li><p>Partial support for ECMAScript 2015 (E6) and ECMAScript 2016 (E7).</p></li>
<li><p>ES2015 TypedArray and Node.js <span class="green">Buffer</span> bindings</p></li>
<li><p>CBOR bindings</p></li>
<li><p>Encoding API bindings based on the WHATWG Encoding Living Standard</p></li>
<li><p>performance.now()</p></li>
<li><p>Built-in regular expression engine</p></li>
<li><p>Built-in Unicode support</p></li>
<li><p>Combined reference counting and mark-and-sweep garbage collection with finalization</p></li>
<li><p>Property virtualization using a subset of ECMAScript ES2015 Proxy object</p></li>
<li><p>Bytecode dump/load for caching compiled functions</p></li>
</ul>
<p>See full list <a class="reference external" href="https://duktape.org">Here</a></p>
</div>
<div class="section" id="rampart-additions">
<h3>Rampart additions<a class="headerlink" href="#rampart-additions" title="Permalink to this headline">¶</a></h3>
<p>In addition to the standard features in Duktape JavaScript, Rampart adds the
following:</p>
<ul class="simple">
<li><p>Standard module support for <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">JavaScript</span></code> modules via the
<code class="docutils literal notranslate"><span class="pre">require()</span></code> function.</p></li>
<li><p>File and C-functions utilities such as <code class="docutils literal notranslate"><span class="pre">printf</span></code>, <code class="docutils literal notranslate"><span class="pre">fseek</span></code>, and <code class="docutils literal notranslate"><span class="pre">exec</span></code>.</p></li>
<li><p>Included <code class="docutils literal notranslate"><span class="pre">C</span></code> modules (<code class="docutils literal notranslate"><span class="pre">rampart-sql</span></code>, <code class="docutils literal notranslate"><span class="pre">rampart-server</span></code>, <code class="docutils literal notranslate"><span class="pre">rampart-curl</span></code>,
<code class="docutils literal notranslate"><span class="pre">rampart-crypto</span></code>, <code class="docutils literal notranslate"><span class="pre">rampart-html</span></code>, <code class="docutils literal notranslate"><span class="pre">rampart-lmdb</span></code>, <code class="docutils literal notranslate"><span class="pre">rampart-redis</span></code>,
<code class="docutils literal notranslate"><span class="pre">rampart-cmark</span></code> and <code class="docutils literal notranslate"><span class="pre">rampart-robots</span></code>).</p></li>
<li><p>Event loop using <code class="docutils literal notranslate"><span class="pre">libevent2</span></code>.</p></li>
<li><p>ECMA 2015, 2016, 2017 and 2018 support using the <a class="reference external" href="https://babeljs.io/">Babel</a>
JavaScript transpiler.</p></li>
<li><p>Full Text Search and SQL databasing via <code class="docutils literal notranslate"><span class="pre">rampart-sql</span></code>.</p></li>
<li><p>Multi-threaded http(s) server from libevhtp via <code class="docutils literal notranslate"><span class="pre">rampart-server</span></code>.</p></li>
<li><p>http, ftp, etc. client functionality via <code class="docutils literal notranslate"><span class="pre">rampart-curl</span></code>.</p></li>
<li><p>Cryptography functions from Openssl via <code class="docutils literal notranslate"><span class="pre">rampart-crypto</span></code>.</p></li>
<li><p>Html parsing and and error correcting via <code class="docutils literal notranslate"><span class="pre">rampart-html</span></code>.</p></li>
<li><p>Fast NOSQL database via <code class="docutils literal notranslate"><span class="pre">rampart-lmdb</span></code>.</p></li>
<li><p>Redis Client via <code class="docutils literal notranslate"><span class="pre">rampart-redis</span></code>.</p></li>
<li><p>Simple Event functions via <a class="reference internal" href="#rampart-event">rampart.event</a>.</p></li>
<li><p><a class="reference internal" href="#extra-javascript-functionality">Extra JavaScript Functionality</a>.</p></li>
</ul>
</div>
</div>
<div class="section" id="rampart-philosophy">
<h2>Rampart philosophy<a class="headerlink" href="#rampart-philosophy" title="Permalink to this headline">¶</a></h2>
<p>Though Rampart supports <code class="docutils literal notranslate"><span class="pre">setTimeout()</span></code>, <a class="reference external" href="rampart.events">Events</a> (and
other async functions via, e.g., <a class="reference internal" href="rampart-server.html#websockets"><span class="std std-ref">websockets</span></a>,
<a class="reference internal" href="rampart-redis.html#the-rampart-redis-module"><span class="std std-ref">rampart-redis</span></a>, Babel, etc),
all functions included in the <a class="reference external" href="https://duktape.org">Duktape</a> JavaScript
engine (as well as most of the functions added to Rampart) are synchronous.  Raw
JavaScript execution ismore memory efficient, but far slower than with, e.g.,
node.js.  However, the functionality and speed of the available C functions provide
comparable efficacy, excellent performance and are a viable alternative to
<a class="reference external" href="https://en.wikipedia.org/wiki/LAMP_(software_bundle)">LAMP</a>,
<a class="reference external" href="https://en.wikipedia.org/wiki/MEAN_(solution_stack)">MEAN</a> or other stacks, all
in a single product, while consuming considerably less resources than the
aforementioned.</p>
</div>
<div class="section" id="rampart-global-variable-and-functions">
<h2>Rampart Global Variable and Functions<a class="headerlink" href="#rampart-global-variable-and-functions" title="Permalink to this headline">¶</a></h2>
<p>Rampart provides global variables beyond what is available in Duktape:
<code class="docutils literal notranslate"><span class="pre">rampart</span></code> and <code class="docutils literal notranslate"><span class="pre">process</span></code>, as well as the <code class="docutils literal notranslate"><span class="pre">require</span></code> function.  Below is
a listing of these added functions.</p>
<div class="section" id="rampart-globalize">
<h3>rampart.globalize<a class="headerlink" href="#rampart-globalize" title="Permalink to this headline">¶</a></h3>
<p>Put all or named properties of an <span class="green">Object</span> in the global namespace.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class="p">(</span><span class="nx">var_obj</span> <span class="p">[,</span> <span class="nx">prop_names</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 18%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>var_obj</p></td>
<td><p><span class="green">Object</span></p></td>
<td><p>The <span class="green">Object</span> with the properties to be globalized</p></td>
</tr>
<tr class="row-odd"><td><p>prop_names</p></td>
<td><p><span class="green">Array</span></p></td>
<td><p>optional <span class="green">Array</span> of property names to be
put into the global namespace.  If specified, only
the named properties will be exported.</p></td>
</tr>
</tbody>
</table>
<p>Without <code class="docutils literal notranslate"><span class="pre">prop_names</span></code>, this is equivalent to <code class="docutils literal notranslate"><span class="pre">Object.assign(global,</span> <span class="pre">var_obj);</span></code>.</p>
<dl class="simple">
<dt>Return value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span> <span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class="p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">);</span>
 <span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;rampart.utils.* are now global vars!\n&quot;</span><span class="p">);</span>

 <span class="cm">/* or */</span>

<span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class="p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;printf&quot;</span><span class="p">]);</span>
<span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;only printf is a global var\n&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="rampart-utils">
<h3>rampart.utils<a class="headerlink" href="#rampart-utils" title="Permalink to this headline">¶</a></h3>
<p>A collection of utility functions.
See <a class="reference internal" href="rampart-utils.html#rampart-utils"><span class="std std-ref">this page</span></a>
for full description of functions.</p>
</div>
<div class="section" id="rampart-event">
<h3>rampart.event<a class="headerlink" href="#rampart-event" title="Permalink to this headline">¶</a></h3>
<p>Rampart can execute functions from within its event loop using its own
event-on-trigger syntax.</p>
<div class="section" id="rampart-event-on">
<h4>rampart.event.on()<a class="headerlink" href="#rampart-event-on" title="Permalink to this headline">¶</a></h4>
<p>Insert a named function to be run upon triggering a named event.  If the named
event does not exist, it will be created.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">funcName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">callbackUserVar</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">eventName</span></code> is an arbitrary <span class="green">String</span> used to identify, trigger
and remove the event using the <a class="reference internal" href="#rampart-event-remove">rampart.event.remove()</a> function below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">funcName</span></code> is an arbitrary <span class="green">String</span> used to identify and remove
the callback function using the <a class="reference internal" href="#rampart-event-off">rampart.event.off()</a> function below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callback</span></code> is a <span class="green">Function</span> to be executed when the event is triggered.
It is called, when triggered, as such: <code class="docutils literal notranslate"><span class="pre">callback(callbackUserVar,</span> <span class="pre">callbackTriggerVar)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callbackUserVar</span></code> is an arbitrary variable which will be passed to the <code class="docutils literal notranslate"><span class="pre">callback</span></code>
<span class="green">Function</span> as its first parameter.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="rampart-event-trigger">
<h4>rampart.event.trigger()<a class="headerlink" href="#rampart-event-trigger" title="Permalink to this headline">¶</a></h4>
<p>Trigger a named event, calling all the callbacks registered under the given name.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">callbackTriggerVar</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">eventName</span></code> is the <span class="green">String</span> used when registering the event with <a class="reference internal" href="#rampart-event-on">rampart.event.on()</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callbackTriggerVar</span></code> is the second parameter passed to the <code class="docutils literal notranslate"><span class="pre">callback</span></code> function specified
when the event and function were registered with <a class="reference internal" href="#rampart-event-on">rampart.event.on()</a>.</p></li>
<li><p><strong>Caveat</strong>, the <code class="docutils literal notranslate"><span class="pre">callbackTriggerVar</span></code> must be a variable which
can be serialized using <a class="reference external" href="https://duktape.org/guide.html#builtin-cbor">CBOR</a>.
Because this function may trigger events that span several threads and Duktape stacks, when
used with the <a class="reference internal" href="rampart-server.html#the-rampart-server-http-module"><span class="std std-ref">rampart-server</span></a>
module, special variables such as <code class="docutils literal notranslate"><span class="pre">req</span></code> (see:
<a class="reference internal" href="rampart-server.html#the-request-object"><span class="std std-ref">The Request Object</span></a>) may contain
functions and hidden state variables which cannot be moved from stack
to stack.  In most cases, it will not be limiting since each callback is run on its own thread/stack
and can take a <code class="docutils literal notranslate"><span class="pre">callbackUserVar</span></code> which does not have the above limitations.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="rampart-event-off">
<h4>rampart.event.off()<a class="headerlink" href="#rampart-event-off" title="Permalink to this headline">¶</a></h4>
<p>Remove a named function from the list of functions for the given event.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">funcName</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">eventName</span></code> is a <span class="green">String</span>, the <code class="docutils literal notranslate"><span class="pre">eventName</span></code> passed to the <cite>rampart.utils.on()</cite>
function above.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">funcName</span></code> is a <span class="green">String</span>, the <code class="docutils literal notranslate"><span class="pre">funcName</span></code> passed to the <cite>rampart.utils.on()</cite>
function above.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="rampart-event-remove">
<h4>rampart.event.remove()<a class="headerlink" href="#rampart-event-remove" title="Permalink to this headline">¶</a></h4>
<p>Remove all function from the list of functions for the given event. This effectively
removes the event.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">eventName</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">eventName</span></code> is a <span class="green">String</span>, the <code class="docutils literal notranslate"><span class="pre">eventName</span></code> passed to the <cite>rampart.utils.on()</cite>
function above.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">usr_var</span> <span class="o">=</span> <span class="s2">&quot;I&#39;m a user variable.&quot;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">myCallback</span> <span class="p">(</span><span class="nx">uservar</span><span class="p">,</span><span class="nx">triggervar</span><span class="p">){</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">uservar</span><span class="p">,</span> <span class="s2">&quot;Triggervar = &quot;</span><span class="o">+</span><span class="nx">triggervar</span><span class="p">);</span>
    <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">triggervar</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">)</span>
        <span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&quot;myev&quot;</span><span class="p">);</span>

    <span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;myev&quot;</span><span class="p">,</span> <span class="nx">triggervar</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;myev&quot;</span><span class="p">,</span> <span class="s2">&quot;myfunc&quot;</span><span class="p">,</span> <span class="nx">myCallback</span><span class="p">,</span> <span class="nx">usr_var</span><span class="p">);</span>

<span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;myev&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cm">/* expected output:</span>
<span class="cm">I&#39;m a user variable. Triggervar = 1</span>
<span class="cm">I&#39;m a user variable. Triggervar = 2</span>
<span class="cm">I&#39;m a user variable. Triggervar = 3</span>
<span class="cm">I&#39;m a user variable. Triggervar = 4</span>
<span class="cm">I&#39;m a user variable. Triggervar = 5</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>See also: the <a class="reference internal" href="rampart-server.html#example-echo-chat-server"><span class="std std-ref">Echo/Chat Server Example</span></a>.</p>
<p>For a more complete example of events using the webserver and websockets,
see the <code class="docutils literal notranslate"><span class="pre">rampart/examples/web_server/modules/wschat.js</span></code>
script.</p>
</div>
</div>
<div class="section" id="rampart-include">
<h3>rampart.include<a class="headerlink" href="#rampart-include" title="Permalink to this headline">¶</a></h3>
<p>Include the source of a file in the current script as global code.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">jsfile</span><span class="p">);</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">jsfile</span></code> is the path of the script to be included.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">jsfile</span></code> is not a absolute path name it will be searched for in the same
manner as with <a class="reference internal" href="#module-search-path">Module Search Path</a> except that in addition to the
current directory and the <code class="docutils literal notranslate"><span class="pre">process.scriptPath</span></code> directory, it will search in
<code class="docutils literal notranslate"><span class="pre">/usr/local/rampart/includes/</span></code> and <code class="docutils literal notranslate"><span class="pre">~/.rampart/includes/</span></code> rather than the
equivalent <code class="docutils literal notranslate"><span class="pre">*/modules/</span></code> paths.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rampart.include</span></code> function is similar to the following code:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">icode</span> <span class="o">=</span> <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">readFile</span><span class="p">({</span><span class="nx">file</span><span class="o">:</span> <span class="nx">jsfile</span><span class="p">,</span> <span class="nx">retString</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
<span class="nb">eval</span><span class="p">(</span><span class="nx">icode</span><span class="p">);</span>
</pre></div>
</div>
<p>With the exception that it:</p>
<blockquote>
<div><ul class="simple">
<li><p>Processes <a class="reference external" href="ECMAScript2015+andBabel.js">babel</a> code.</p></li>
<li><p>Includes the <a class="reference internal" href="#extra-javascript-functionality">Extra JavaScript Functionality</a> described below.</p></li>
<li><p>Searches for the <code class="docutils literal notranslate"><span class="pre">jscode</span></code> file in a manner similar to
the <a class="reference external" href="UsingtherequireFunctiontoImportModules">require</a>
function.</p></li>
</ul>
</div></blockquote>
<p>Return Value:
<code class="docutils literal notranslate"><span class="pre">undefined</span></code></p>
</div>
<div class="section" id="rampart-import">
<h3>rampart.import<a class="headerlink" href="#rampart-import" title="Permalink to this headline">¶</a></h3>
<div class="section" id="csvfile">
<h4>csvFile<a class="headerlink" href="#csvfile" title="Permalink to this headline">¶</a></h4>
<p>The csvFile <span class="green">Function</span> imports csv data from a file.  It takes a
<span class="green">String</span> containing a file name and optionally
an <span class="green">Object</span> of options and/or a callback
<span class="green">Function</span>.  The parameters may be specified in any order.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">rampart</span><span class="p">.</span><span class="kr">import</span><span class="p">.</span><span class="nx">csvFile</span><span class="p">(</span><span class="nx">filename</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 22%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>filename</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>The csv file to import</p></td>
</tr>
<tr class="row-odd"><td><p>options</p></td>
<td><p><span class="green">Object</span></p></td>
<td><p>Options <em>described below</em></p></td>
</tr>
<tr class="row-even"><td><p>callback</p></td>
<td><p><span class="green">Function</span></p></td>
<td><p>a function to handle data one row at a time.</p></td>
</tr>
</tbody>
</table>
<dl>
<dt>filename:</dt><dd><p>The name of the csv file to be opened;</p>
</dd>
<dt>options:</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> <span class="green">Object</span> may contain any of the following.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stripLeadingWhite</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>):
Remove leading whitespace characters from cells.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stripTrailingWhite</span></code> - <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): Remove
trailing whitespace characters from cells.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doubleQuoteEscape</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>):
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> within strings is used to embed <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> characters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">singleQuoteNest</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): Strings
may be bounded by <code class="docutils literal notranslate"><span class="pre">'</span></code> pairs and <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> characters within are ignored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">backslashEscape</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>):
Characters preceded by ‘\’ are translated and escaped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allEscapes</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): All <code class="docutils literal notranslate"><span class="pre">\</span></code>
escape sequences known by the ‘C’ compiler are translated, if
<code class="docutils literal notranslate"><span class="pre">false</span></code> only backslash, single quote, and double quote are escaped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">europeanDecimal</span></code>  -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>):
Numbers like <code class="docutils literal notranslate"><span class="pre">123</span> <span class="pre">456,78</span></code> will be parsed as <code class="docutils literal notranslate"><span class="pre">123456.78</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tryParsingStrings</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>): Look
inside quoted strings for dates and numbers to parse, if <code class="docutils literal notranslate"><span class="pre">false</span></code>
anything quoted is a string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delimiter</span></code> - <span class="green">String</span> (default <code class="docutils literal notranslate"><span class="pre">&quot;,&quot;</span></code>):  Use the first
character of string as a column delimiter (e.g <code class="docutils literal notranslate"><span class="pre">\t</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeFormat</span></code> -  <span class="green">String</span> (default <code class="docutils literal notranslate"><span class="pre">&quot;%Y-%m-%d</span> <span class="pre">%H:%M:%S&quot;</span></code>):
Set the format for parsing a date/time. See man page for
<a class="reference external" href="https://man7.org/linux/man-pages/man3/strptime.3p.html">strptime()</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">returnType</span></code>-  <span class="green">String</span> (default <code class="docutils literal notranslate"><span class="pre">&quot;array&quot;</span></code>, optionally
<code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code>): Whether to
return an <span class="green">Array</span> or an <span class="green">Object</span> for each row.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hasHeaderRow</span></code> - -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>): Whether
to treat the first row as column names. If <code class="docutils literal notranslate"><span class="pre">false</span></code>, the first row
is imported as csv data and the column names will
default to <code class="docutils literal notranslate"><span class="pre">col_1,</span> <span class="pre">col_2,</span> <span class="pre">...,</span> <span class="pre">col_n</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normalize</span></code> - <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>): If <code class="docutils literal notranslate"><span class="pre">true</span></code>,
examine each column in the parsed CSV object to find the majority
type of that column.  It then casts all the members of that column
to the majority type, or set it to <code class="docutils literal notranslate"><span class="pre">null</span></code> if it is
unable to do so. If <code class="docutils literal notranslate"><span class="pre">false</span></code>, each cell is individually normalized.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">includeRawString</span></code> <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>): if
<code class="docutils literal notranslate"><span class="pre">true</span></code>, return each cell as an object containing
<code class="docutils literal notranslate"><span class="pre">{value:</span> <span class="pre">normalized</span> <span class="pre">value,</span> <span class="pre">raw:</span> <span class="pre">originalString}</span></code>.  If false, each
cell value is the primitive normalized value.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>callback:</dt><dd><p>A <span class="green">Function</span> taking as parameters (<code class="docutils literal notranslate"><span class="pre">result_row</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">columns</span></code>).
The callback is executed once for each row in the csv file:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result_row</span></code>: (<span class="green">Array</span>/<span class="green">Object</span>): depending on the setting of <code class="docutils literal notranslate"><span class="pre">returnType</span></code>
in <code class="docutils literal notranslate"><span class="pre">Options</span></code> above, a single row is passed to the callback as an
<span class="green">Object</span> or an <span class="green">Array</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>: (<span class="green">Number</span>) The ordinal number of the current search result.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code>: an <span class="green">Array</span> corresponding to the column names or
aliases selected and returned in results.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
<dl id="returnval">
<dt>Return Value:</dt><dd><p><span class="green">Number</span>/<span class="green">Object</span>.</p>
<p>With no callback, an <span class="green">Object</span> is returned.  The <span class="green">Object</span> contains
three key/value pairs:</p>
<blockquote>
<div><ul class="simple">
<li><p>Key: <code class="docutils literal notranslate"><span class="pre">results</span></code> - Value: an <span class="green">Array</span> of <span class="green">Arrays</span>.
Each outer <span class="green">Array</span> corresponds to a row in the csv file
and each inner <span class="green">Array</span> corresponds to the columns in that row.
If <code class="docutils literal notranslate"><span class="pre">returnType</span></code> is set to <code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code>, an <span class="green">Array</span> of
<span class="green">Objects</span> with keys set to the corresponding column names
and the values set to the corresponding column values  of the
imported row.</p></li>
<li><p>Key: <code class="docutils literal notranslate"><span class="pre">rowCount</span></code> - Value: a <span class="green">Number</span> corresponding to the number of rows returned.</p></li>
<li><p>Key:  <code class="docutils literal notranslate"><span class="pre">columns</span></code> - Value: an <span class="green">Array</span> corresponding to the column names or
aliases selected and returned in results.</p></li>
</ul>
</div></blockquote>
<p>With a callback, the return value is set to number of rows in the
csv file (not including the Header if <code class="docutils literal notranslate"><span class="pre">hasHeaderRow</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>).</p>
</dd>
</dl>
<p>Note: In the callback, the loop can be cancelled at any point by returning
<code class="docutils literal notranslate"><span class="pre">false</span></code>.  The return value (number of rows) will still be the total number
of rows in the csv file.</p>
</div>
<div class="section" id="csv">
<h4>csv<a class="headerlink" href="#csv" title="Permalink to this headline">¶</a></h4>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">rampart</span><span class="p">.</span><span class="kr">import</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span><span class="nx">csvData</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]);</span>
</pre></div>
</div>
<p>Same as <a class="reference internal" href="#csvfile">csvFile</a>() except instead of a file name, a <span class="green">String</span> or <span class="green">Buffer</span> containing
the csv data is passed as a parameter.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">csvdata</span> <span class="o">=</span>
<span class="s2">&quot;column 1, column 2, column 3, column 4\n&quot;</span><span class="o">+</span>
<span class="s2">&quot;1.0, val2, val3, val4\n&quot;</span> <span class="o">+</span>
<span class="s2">&quot;valx, val5, val6, value 7\n&quot;</span><span class="p">;</span>

<span class="cm">/* no callback */</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span>
    <span class="nx">rampart</span><span class="p">.</span><span class="kr">import</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span><span class="nx">csvdata</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="nx">hasHeaderRow</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">normalize</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">),</span><span class="kc">null</span><span class="p">,</span><span class="mi">3</span>
  <span class="p">)</span>
<span class="p">);</span>

<span class="cm">/* with callback */</span>
<span class="kd">var</span> <span class="nx">rows</span><span class="o">=</span><span class="nx">rampart</span><span class="p">.</span><span class="kr">import</span><span class="p">.</span><span class="nx">csv</span><span class="p">(</span>
   <span class="nx">csvdata</span><span class="p">,</span>
   <span class="p">{</span>
      <span class="nx">hasHeaderRow</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">normalize</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">returnType</span><span class="o">:</span><span class="s1">&#39;object&#39;</span><span class="p">,</span>
      <span class="nx">includeRawString</span><span class="o">:</span><span class="kc">true</span>
   <span class="p">},</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">col</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">res</span><span class="p">,</span><span class="nx">col</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;rows:&quot;</span><span class="p">,</span> <span class="nx">rows</span><span class="p">);</span>

<span class="cm">/* expected output:</span>
<span class="cm">{</span>
<span class="cm">   &quot;results&quot;: [</span>
<span class="cm">      [</span>
<span class="cm">         1,</span>
<span class="cm">         &quot;val2&quot;,</span>
<span class="cm">         &quot;val3&quot;,</span>
<span class="cm">         &quot;val4&quot;</span>
<span class="cm">      ],</span>
<span class="cm">      [</span>
<span class="cm">         null,</span>
<span class="cm">         &quot;val5&quot;,</span>
<span class="cm">         &quot;val6&quot;,</span>
<span class="cm">         &quot;value 7&quot;</span>
<span class="cm">      ]</span>
<span class="cm">   ],</span>
<span class="cm">   &quot;columns&quot;: [</span>
<span class="cm">      &quot;column 1&quot;,</span>
<span class="cm">      &quot;column 2&quot;,</span>
<span class="cm">      &quot;column 3&quot;,</span>
<span class="cm">      &quot;column 4&quot;</span>
<span class="cm">   ],</span>
<span class="cm">   &quot;rowCount&quot;: 2</span>
<span class="cm">}</span>
<span class="cm">0 {&quot;column 1&quot;:{value:1,raw:&quot;1.0&quot;},&quot;column 2&quot;:{value:&quot;val2&quot;,raw:&quot;val2&quot;},&quot;column 3&quot;:{value:&quot;val3&quot;,raw:&quot;val3&quot;},&quot;column 4&quot;:{value:&quot;val4&quot;,raw:&quot;val4&quot;}} [&quot;column 1&quot;,&quot;column 2&quot;,&quot;column 3&quot;,&quot;column 4&quot;]</span>
<span class="cm">1 {&quot;column 1&quot;:{value:null,raw:&quot;valx&quot;},&quot;column 2&quot;:{value:&quot;val5&quot;,raw:&quot;val5&quot;},&quot;column 3&quot;:{value:&quot;val6&quot;,raw:&quot;val6&quot;},&quot;column 4&quot;:{value:&quot;value 7&quot;,raw:&quot;value 7&quot;}} [&quot;column 1&quot;,&quot;column 2&quot;,&quot;column 3&quot;,&quot;column 4&quot;]</span>
<span class="cm">rows: 2</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="process-global-variable-and-functions">
<h2>Process Global Variable and Functions<a class="headerlink" href="#process-global-variable-and-functions" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">process</span></code> global variable contains the following properties:</p>
<div class="section" id="exit">
<h3>exit<a class="headerlink" href="#exit" title="Permalink to this headline">¶</a></h3>
<p>The exit function terminates the execution of the current script.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">([</span><span class="nx">exitcode</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where the optional <code class="docutils literal notranslate"><span class="pre">exitcode</span></code> is a <span class="green">Number</span>, the status that Rampart returns
to its parent (default: <code class="docutils literal notranslate"><span class="pre">0</span></code>);</p>
</div>
<div class="section" id="env">
<h3>env<a class="headerlink" href="#env" title="Permalink to this headline">¶</a></h3>
<p>The value of <code class="docutils literal notranslate"><span class="pre">process.env</span></code> is an <span class="green">Object</span> containing properties and values
corresponding to the environment variables available to Rampart upon
execution.</p>
</div>
<div class="section" id="argv">
<h3>argv<a class="headerlink" href="#argv" title="Permalink to this headline">¶</a></h3>
<p>The value of <code class="docutils literal notranslate"><span class="pre">process.argv</span></code> is an <span class="green">Array</span> of the arguments passed to rampart
upon execution.  The first member is always the name of the rampart
executable.  The second is usually the filename of the script provided on
the command line.  However if flags are present (arguments starting with
<code class="docutils literal notranslate"><span class="pre">-</span></code>), the script name may be a later argument.  Subsequent members occur
in the order they were given on the command line.</p>
</div>
<div class="section" id="scriptpath">
<h3>scriptPath<a class="headerlink" href="#scriptpath" title="Permalink to this headline">¶</a></h3>
<p>The value of <code class="docutils literal notranslate"><span class="pre">process.scriptPath</span></code> is a <span class="green">String</span> containing the
canonical path (directory) in which the currently executing script can be
found (e.g.  if <code class="docutils literal notranslate"><span class="pre">rampart</span> <span class="pre">/path/to/my/script.js</span></code> is run,
<code class="docutils literal notranslate"><span class="pre">process.scriptPath</span></code> will be <code class="docutils literal notranslate"><span class="pre">/path/to/my</span></code>).</p>
</div>
<div class="section" id="getpid">
<h3>getpid<a class="headerlink" href="#getpid" title="Permalink to this headline">¶</a></h3>
<p>Get the process id of the current process.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">getpid</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><span class="green">Number</span>. The pid of the current process.</p>
</dd>
</dl>
</div>
<div class="section" id="getppid">
<h3>getppid<a class="headerlink" href="#getppid" title="Permalink to this headline">¶</a></h3>
<p>Get the process id of the parent of the current process.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ppid</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">getppid</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><span class="green">Number</span>. The pid of the parent process.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="using-the-require-function-to-import-modules">
<h2>Using the require Function to Import Modules<a class="headerlink" href="#using-the-require-function-to-import-modules" title="Permalink to this headline">¶</a></h2>
<p>Scripts may reference function stored in external files.  These files are
known as modules.  A module is a compiled C program or a JavaScript file
which exports an <span class="green">Object</span> or <span class="green">Function</span> when the
<code class="docutils literal notranslate"><span class="pre">require(&quot;module-name&quot;)</span></code> syntax is used.</p>
<p>Example for the SQL C Module:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This will search the current directory and the rampart modules directories
for a module named <code class="docutils literal notranslate"><span class="pre">rampart-sql.so</span></code> or <code class="docutils literal notranslate"><span class="pre">rampart-sql.js</span></code> and use the
first one found.  In this case <code class="docutils literal notranslate"><span class="pre">rampart-sql.so</span></code> will be found and the SQL
module and its functions will be usable via the named variable <code class="docutils literal notranslate"><span class="pre">Sql</span></code>.  See,
e.g, <a class="reference internal" href="rampart-sql.html#loading-the-javascript-module"><span class="std std-ref">The rampart-sql documentation</span></a>
for full details.</p>
<div class="section" id="example-creating-a-javascript-module">
<h3>Example creating a JavaScript module<a class="headerlink" href="#example-creating-a-javascript-module" title="Permalink to this headline">¶</a></h3>
<p>If you have an often used function, or a function used for serving web pages
with <a class="reference internal" href="rampart-server.html#the-rampart-server-http-module"><span class="std std-ref">The rampart-server HTTP module</span></a>, it can be placed in a
separate file (here the file is named <code class="docutils literal notranslate"><span class="pre">times2.js</span></code>):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">timestwo</span> <span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">num</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="nx">timestwo</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">module.exports</span></code> variable is set to the <span class="green">Object</span> or
<span class="green">Function</span> being exported.</p>
<p>In another script, the exported <code class="docutils literal notranslate"><span class="pre">timestwo</span></code> function could be accessed as such:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;times2&quot;</span><span class="p">);</span>
<span class="cm">/* alternatively</span>
<span class="cm">  var x2 = require(&quot;times2.js&quot;);</span>
<span class="cm">*/</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">x2</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="cm">/* res == 10 */</span>
</pre></div>
</div>
<p>Note also that from within a module, the <code class="docutils literal notranslate"><span class="pre">module</span></code> object contains some useful
information.  An example module named <code class="docutils literal notranslate"><span class="pre">mod.js</span></code> and loaded with the
statement <code class="docutils literal notranslate"><span class="pre">require(&quot;mod.js&quot;)</span></code> will have
<code class="docutils literal notranslate"><span class="pre">module</span></code> set to a value similar to the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;/path/to/my/mod.js&quot;</span><span class="p">,</span>
   <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;/path/to/my&quot;</span><span class="p">,</span>
   <span class="s2">&quot;exports&quot;</span><span class="o">:</span> <span class="p">{},</span>
   <span class="s2">&quot;mtime&quot;</span><span class="o">:</span> <span class="mi">1624904227</span><span class="p">,</span>
   <span class="s2">&quot;atime&quot;</span><span class="o">:</span> <span class="mi">1624904227</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-creating-a-c-module">
<h3>Example creating a C module<a class="headerlink" href="#example-creating-a-c-module" title="Permalink to this headline">¶</a></h3>
<p>A module can also be written in C.  When exporting from C, the module should
return a <span class="green">Function</span> or an <span class="green">Object</span> which may contain functions
and/or other JavaScript variables.</p>
<p>Example (where filename is <code class="docutils literal notranslate"><span class="pre">times3.c</span></code>):</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;rampart.h&quot;</span><span class="cp"></span>

<span class="k">static</span> <span class="n">duk_ret_t</span> <span class="nf">timesthree</span><span class="p">(</span><span class="n">duk_context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">num</span> <span class="o">=</span> <span class="n">duk_get_number_default</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="n">duk_push_number</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">num</span> <span class="o">*</span> <span class="mf">3.0</span> <span class="p">);</span>

    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* **************************************************</span>
<span class="cm">   Initialize module</span>
<span class="cm">   ************************************************** */</span>
<span class="n">duk_ret_t</span> <span class="nf">duk_open_module</span><span class="p">(</span><span class="n">duk_context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">duk_push_c_function</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">timesthree</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This could be compiled with GCC as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">cc</span> <span class="pre">-I/usr/local/rampart/include</span> <span class="pre">-fPIC</span> <span class="pre">-shared</span> <span class="pre">-Wl,-soname,times3.so</span> <span class="pre">-o</span> <span class="pre">times3.so</span> <span class="pre">times3.c</span></code></p>
<p>The module could then be imported using the <code class="docutils literal notranslate"><span class="pre">require()</span></code> function.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;times3&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">x3</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="cm">/* res == 15 */</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://duktape.org/api.html">The Duktape API Documentation</a>
for a full listing of functions available.</p>
</div>
<div class="section" id="module-search-path">
<h3>Module Search Path<a class="headerlink" href="#module-search-path" title="Permalink to this headline">¶</a></h3>
<p>Modules are searched for in the following order:</p>
<ol class="arabic simple">
<li><p>As given.  If <code class="docutils literal notranslate"><span class="pre">/path/to/module.js</span></code> is given, the absolute path is checked first.
If <code class="docutils literal notranslate"><span class="pre">path/to/module.js</span></code> or <code class="docutils literal notranslate"><span class="pre">module.js</span></code> is given
<code class="docutils literal notranslate"><span class="pre">./path/to/module.js</span></code> or <code class="docutils literal notranslate"><span class="pre">./module.js</span></code> is checked
first. Thus relative paths are checked from the current directory first.</p></li>
<li><p>In <a class="reference internal" href="#scriptpath"><span class="std std-ref">process.scriptPath</span></a>.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">.rampart/modules</span></code> directory of current user’s home directory
as provided by the <code class="docutils literal notranslate"><span class="pre">$HOME</span></code> environment variable.</p></li>
<li><p>In the “/lib/rampart_modules” directory of the <code class="docutils literal notranslate"><span class="pre">-DRP_INST_PATH</span></code> path set when Rampart
was compiled.  The default is <code class="docutils literal notranslate"><span class="pre">/usr/local/rampart/lib/rampart_modules</span></code>. Or
preferentially, if set, the path pointed to by the environment variable
<code class="docutils literal notranslate"><span class="pre">$RAMPART_PATH</span></code> + “/lib/rampart_modules”.</p></li>
<li><p>In the “/modules” directory of the <code class="docutils literal notranslate"><span class="pre">-DRP_INST_PATH</span></code> path set when Rampart
was compiled.  The default is <code class="docutils literal notranslate"><span class="pre">/usr/local/rampart/modules</span></code>. Or
preferentially, if set, the path pointed to by the environment variable
<code class="docutils literal notranslate"><span class="pre">$RAMPART_PATH</span></code> + “/modules”.</p></li>
<li><p>In the current working directory. If <code class="docutils literal notranslate"><span class="pre">/module.js</span></code> is given,
<code class="docutils literal notranslate"><span class="pre">./module.js</span></code> is checked.</p></li>
</ol>
</div>
</div>
<div class="section" id="extra-javascript-functionality">
<h2>Extra JavaScript Functionality<a class="headerlink" href="#extra-javascript-functionality" title="Permalink to this headline">¶</a></h2>
<p>A subset of post ES5 JavaScript syntax is supported when not using
<a class="reference external" href="ECMAScript2015+andBabel.js">babel</a> below.  It is provided
experimentally (unsupported) and is limited in scope.</p>
<div class="section" id="object-values">
<h3>Object.values()<a class="headerlink" href="#object-values" title="Permalink to this headline">¶</a></h3>
<p>Return an <span class="green">Array</span> containing the values of an object.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
   <span class="nx">key1</span><span class="o">:</span> <span class="s2">&quot;val1&quot;</span><span class="p">,</span>
   <span class="nx">key2</span><span class="o">:</span> <span class="s2">&quot;val2&quot;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span>
<span class="cm">/* expected output:</span>
<span class="cm">   [&quot;val1&quot;,&quot;val2&quot;]              */</span>
</pre></div>
</div>
</div>
<div class="section" id="template-literals">
<h3>Template Literals<a class="headerlink" href="#template-literals" title="Permalink to this headline">¶</a></h3>
<p>These may be uses much as expected:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">color</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="sb">`I&#39;m a </span><span class="si">${</span><span class="nx">color</span><span class="o">?</span> <span class="nx">color</span><span class="o">:</span> <span class="sb">`black`</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span> <span class="nx">type</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">type</span><span class="si">}</span><span class="sb"> `</span> <span class="o">:</span> <span class="sb">`tea`</span><span class="si">}</span><span class="sb">pot`</span><span class="p">;</span>
<span class="cm">/* out = &quot;I&#39;m a black teapot&quot; */</span>

<span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;coffee&quot;</span><span class="p">;</span>
<span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
<span class="nx">out</span> <span class="o">=</span> <span class="sb">`I&#39;m a </span><span class="si">${</span><span class="nx">color</span><span class="o">?</span> <span class="nx">color</span><span class="o">:</span> <span class="sb">`black`</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span> <span class="nx">type</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">type</span><span class="si">}</span><span class="sb"> `</span> <span class="o">:</span> <span class="sb">`tea`</span><span class="si">}</span><span class="sb">pot`</span><span class="p">;</span>
<span class="cm">/* out = &quot;I&#39;m a red coffee pot&quot; */</span>
</pre></div>
</div>
</div>
<div class="section" id="tagged-functions">
<h3>Tagged Functions<a class="headerlink" href="#tagged-functions" title="Permalink to this headline">¶</a></h3>
<p>These may be used much as expected:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">aboutMe</span><span class="p">(</span><span class="nx">strings</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">strings</span><span class="p">);</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">keys</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;Francis&quot;</span><span class="p">,</span> <span class="nx">age</span><span class="o">=</span><span class="mi">31</span><span class="p">;</span>

<span class="nx">aboutMe</span><span class="sb">`My name is </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb"> and I am </span><span class="si">${</span><span class="nx">age</span><span class="si">}</span><span class="sb"> years old`</span><span class="p">;</span>
<span class="cm">/* expected output:</span>
<span class="cm">   [&quot;My name is &quot;,&quot; and I am &quot;,&quot; years old&quot;]</span>
<span class="cm">   [&quot;Francis&quot;,31]</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="rest-parameters">
<h3>Rest Parameters<a class="headerlink" href="#rest-parameters" title="Permalink to this headline">¶</a></h3>
<p>Rest Parameter syntax may also be used for arguments to functions.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">aboutMe</span><span class="p">(</span><span class="nx">strings</span><span class="p">,</span> <span class="p">...</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">strings</span><span class="p">);</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">keys</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;Francis&quot;</span><span class="p">,</span> <span class="nx">age</span><span class="o">=</span><span class="mi">31</span><span class="p">;</span>

<span class="nx">aboutMe</span><span class="sb">`My name is </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb"> and I am </span><span class="si">${</span><span class="nx">age</span><span class="si">}</span><span class="sb"> years old`</span><span class="p">;</span>
<span class="cm">/* expected output:</span>
<span class="cm">   [&quot;My name is &quot;,&quot; and I am &quot;,&quot; years old&quot;]</span>
<span class="cm">   [&quot;Francis&quot;,31]</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="template-literals-and-sprintf">
<h3>Template Literals and sprintf<a class="headerlink" href="#template-literals-and-sprintf" title="Permalink to this headline">¶</a></h3>
<p>A non-standard shortcut syntax may be used in template literals in place of
<a class="reference internal" href="rampart-utils.html#sprintf"><span class="std std-ref">rampart.utils.sprintf</span></a> by specifying a format
string followed by a colon <code class="docutils literal notranslate"><span class="pre">:</span></code> in a substituted variable (<code class="docutils literal notranslate"><span class="pre">${}</span></code>).  If
the string begins with a <code class="docutils literal notranslate"><span class="pre">%</span></code>, or if the string is quoted with single or
double quotes <a class="reference internal" href="rampart-utils.html#sprintf"><span class="std std-ref">rampart.utils.sprintf</span></a> is
called.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myhtml</span> <span class="o">=</span> <span class="sb">`</span>
<span class="sb">&lt;div&gt;</span>
<span class="sb">    my contents</span>
<span class="sb">&lt;/div&gt;</span>
<span class="sb">`</span><span class="p">;</span>

<span class="cm">/* same as:</span>
<span class="cm">console.log(&quot;Here is the html:&lt;br&gt;\n&lt;pre&gt;&quot;+rampart.utils.sprintf(&quot;%H&quot;,myhtml)+&quot;&lt;/pre&gt;&quot;);</span>
<span class="cm">*/</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Here is the html:&lt;br&gt;\n&lt;pre&gt;${</span><span class="nx">%H:myhtml</span></span><span class="sb">}&lt;/pre&gt;`</span><span class="p">);</span>

<span class="cm">/* or */</span>

<span class="cm">/* same as:</span>
<span class="cm">console.log(&quot;Here is the html:&lt;br&gt;\n&quot;+rampart.utils.sprintf(&quot;&lt;pre&gt;%H&lt;/pre&gt;&quot;,myhtml));</span>
<span class="cm">*/</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Here is the html&lt;br&gt;\n${</span><span class="nx">&quot;&lt;pre&gt;%H&lt;/pre&gt;&quot;:myhtml</span></span><span class="sb">}`</span><span class="p">);</span>

<span class="cm">/* expected output:</span>
<span class="cm">Here is the html:&lt;br&gt;</span>
<span class="cm">&lt;pre&gt;</span>
<span class="cm">&amp;lt;div&amp;gt;</span>
<span class="cm">    my contents</span>
<span class="cm">&amp;lt;&amp;#47;div&amp;gt;</span>
<span class="cm">&lt;/pre&gt;</span>
<span class="cm">*/</span>
</pre></div></div><p>Note that this non-standard syntax is not available when using
<a class="reference internal" href="#babeljs"><span class="std std-ref">babel</span></a> below.</p>
</div>
<div class="section" id="settimeout">
<h3>setTimeout()<a class="headerlink" href="#settimeout" title="Permalink to this headline">¶</a></h3>
<p>Also added to Rampart is the <code class="docutils literal notranslate"><span class="pre">setTimeout()</span></code> function.  It supports the
asynchronous calling of functions from within Rampart’s event loop in the same
manner as <code class="docutils literal notranslate"><span class="pre">setTimeout</span></code> in <code class="docutils literal notranslate"><span class="pre">node.js</span></code> or a browser.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">timeOut</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">callback</span></code> is a <span class="green">Function</span> to be run when the elapsed time is reached.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeOut</span></code> is the amount of time in milliseconds to wait before the <code class="docutils literal notranslate"><span class="pre">callback</span></code> function is called.</p></li>
</ul>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An id which may be used with <a href="#id5"><span class="problematic" id="id6">`clearTimeout`_</span></a>.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* print message after 2 seconds */</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hi from a timeout callback&quot;</span><span class="p">);</span> <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that Rampart JavaScript executes all global code before entering its event loop.
Thus if a script uses synchronous functions that take longer than <code class="docutils literal notranslate"><span class="pre">timeOut</span></code>, the
<code class="docutils literal notranslate"><span class="pre">callback</span></code> will be run immediately after the global code is executed. Consider the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Hi from a timeout callback&quot;</span><span class="p">);</span> <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>

<span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">callback</span></code> function will not be executed until after the sleep
function returns.  At that time, the clock will have expired and the
<code class="docutils literal notranslate"><span class="pre">setTimeout</span></code> callback will be run immediately.  The net effect is that
<code class="docutils literal notranslate"><span class="pre">console.log</span></code> will be executed after approximately 3 seconds.</p>
</div>
<div class="section" id="cleartimeout">
<h3>clearTimeout()<a class="headerlink" href="#cleartimeout" title="Permalink to this headline">¶</a></h3>
<p>Clear a pending <a class="reference internal" href="#settimeout">setTimeout()</a> timer before it has executed.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">timeOut</span><span class="p">);</span>

<span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> is the return value from a call to <a class="reference internal" href="#settimeout">setTimeout()</a>.</p></li>
</ul>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code></p>
</dd>
</dl>
</div>
<div class="section" id="setinterval">
<h3>setInterval()<a class="headerlink" href="#setinterval" title="Permalink to this headline">¶</a></h3>
<p>Similar to <a class="reference internal" href="#settimeout">setTimeout()</a> except it repeats every <code class="docutils literal notranslate"><span class="pre">interval</span></code> milliseconds.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">interval</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">callback</span></code> is a <span class="green">Function</span> to be run when the elapsed time is reached.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interval</span></code> is the amount of time in milliseconds between calls to <code class="docutils literal notranslate"><span class="pre">callback</span></code>.</p></li>
</ul>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An id which may be used with <a class="reference internal" href="#clearinterval">clearInterval()</a>.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="cm">/* print message every second, 10 times */</span>
<span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
     <span class="nx">x</span><span class="o">++</span><span class="p">;</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;loop &quot;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="nx">x</span><span class="o">&gt;</span><span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;all done&quot;</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="clearinterval">
<h3>clearInterval()<a class="headerlink" href="#clearinterval" title="Permalink to this headline">¶</a></h3>
<p>Clear a pending <a class="reference internal" href="#setinterval">setInterval()</a> timer, breaking the loop.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">interval</span><span class="p">);</span>

<span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> is the return value from a call to <a class="reference internal" href="#setinterval">setInterval()</a>.</p></li>
</ul>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code></p>
</dd>
</dl>
</div>
</div>
<div class="section" id="additional-global-variables-and-functions">
<h2>Additional Global Variables and Functions<a class="headerlink" href="#additional-global-variables-and-functions" title="Permalink to this headline">¶</a></h2>
<p>Other global variables are provided by the Duktape JavaScript engine and
include:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://duktape.org/guide.html#builtin-duktape">Duktape</a></p></li>
<li><p><a class="reference external" href="https://duktape.org/guide.html#builtin-cbor">CBOR</a></p></li>
<li><p><a class="reference external" href="https://duktape.org/guide.html#builtin-textencoder">TextEncoder</a></p></li>
<li><p><a class="reference external" href="https://duktape.org/guide.html#builtin-textdecoder">TextDecoder</a></p></li>
<li><p><a class="reference external" href="https://duktape.org/guide.html#builtin-performance">performance</a></p></li>
</ul>
<p>For more information, see the <a class="reference external" href="https://duktape.org/guide.html">Duktape Guide</a></p>
</div>
<div class="section" id="ecmascript-2015-and-babel-js">
<span id="babeljs"></span><h2>ECMAScript 2015+ and Babel.js<a class="headerlink" href="#ecmascript-2015-and-babel-js" title="Permalink to this headline">¶</a></h2>
<div class="section" id="babel-acknowledgement">
<h3>Babel Acknowledgement<a class="headerlink" href="#babel-acknowledgement" title="Permalink to this headline">¶</a></h3>
<p>Rampart <strong>experimentally</strong> uses <a class="reference external" href="https://babeljs.io/">Babel.js</a> to support a
greater breath of JavaScript syntax and functionality.  Babel.js is a
toolchain that converts ECMAScript 2015+ (and optionally TypeScript) code
into a version of JavaScript compatible with Duktape.  The authors of
Rampart are extremely grateful to the
<a class="reference external" href="https://babeljs.io/team">Babel development team</a>.</p>
</div>
<div class="section" id="babel-license">
<h3>Babel License<a class="headerlink" href="#babel-license" title="Permalink to this headline">¶</a></h3>
<p>Babel.js is
<a class="reference external" href="https://github.com/babel/babel/blob/main/LICENSE">MIT licensed</a>.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>A slightly modified version of babel.js (currently babel-standalone v
7.11.1) and the associated collection of polyfills (babel-polyfill.js) are
included in the Rampart distribution.  To use ECMA 2015+ features of
JavaScript, simply include the following at the beginning of the script:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use babel&quot;</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">babel&quot;</span></code> string should be the first JavaScript text in
the script.  However it may come after any comments or a hash-bang line.  It
also should be the only text on the line, other than an optional comment.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/local/bin/rampart</span>
<span class="c1">// above is ignored by rampart.</span>

<span class="cm">/* My first ECMA 2015 Script using Rampart/Duktape/Babel */</span>

<span class="s2">&quot;use babel&quot;</span> <span class="cm">/* a comment on this line is ok */</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`a multi-line string</span>
<span class="sb">using backticks is much easier than</span>
<span class="sb">using</span>
<span class="sb">console.log(</span>
<span class="sb">             &quot;string\\n&quot; +</span>
<span class="sb">             &quot;string2\\n&quot;</span>
<span class="sb">           );</span>
<span class="sb">`</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">babel&quot;</span></code> directive optionally takes a <code class="docutils literal notranslate"><span class="pre">:</span></code> followed by babel
options.  Without options <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">babel&quot;</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">babel:{</span> <span class="pre">presets:</span> <span class="pre">['env'],</span> <span class="pre">retainLines:</span> <span class="pre">true</span> <span class="pre">}&quot;</span></code>.  See
<a class="reference external" href="https://babeljs.io/docs/en/babel-preset-env">babel documentation</a>
for more information on possible options.</p>
<p>A simple example in
<a class="reference external" href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html">TypeScript</a>:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* note that filename is required for &#39;typescript&#39;</span>
<span class="cm">   and that &#39;env&#39; is also included to allow for ECMA 2015+  */</span>

<span class="s2">&quot;use babel:{ filename: &#39;myfile.ts&#39;, presets: [&#39;typescript&#39;,&#39;env&#39;], retainLines: true }&quot;</span>

<span class="kr">interface</span> <span class="nx">Point</span> <span class="p">{</span>
  <span class="nx">x</span><span class="o">:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="nx">y</span><span class="o">:</span> <span class="nx">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">printPoint</span><span class="p">(</span><span class="nx">p</span><span class="o">:</span> <span class="nx">Point</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">p</span><span class="p">.</span><span class="nx">x</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">p</span><span class="p">.</span><span class="nx">y</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// prints &quot;12, 26&quot;</span>
<span class="kr">const</span> <span class="nx">point</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">26</span> <span class="p">};</span>
<span class="nx">printPoint</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that babel does not actually do any type checking.  See
<a class="reference external" href="https://babeljs.io/docs/en/babel-plugin-transform-typescript#caveats">this caveat</a>.</p>
<p>For a list of tested and supported syntax, see the
<code class="docutils literal notranslate"><span class="pre">/usr/local/rampart/tests/babel-test.js</span></code> file.</p>
</div>
<div class="section" id="how-it-works">
<h3>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h3>
<p>When the <code class="docutils literal notranslate"><span class="pre">&quot;use</span> <span class="pre">babel&quot;</span></code> string is found, Rampart automatically loads
babel.js and uses it to transpile the script into JavaScript compatible with
the Duktape JavaScript engine.  A cache copy of the transpiled script will
be saved in the same directory, and will be named by removing <code class="docutils literal notranslate"><span class="pre">.js</span></code> from
the original script name and replacing it with <code class="docutils literal notranslate"><span class="pre">.babel.js</span></code>.  Thus if, e.g.,
the original script was named <code class="docutils literal notranslate"><span class="pre">myfile.js</span></code>, the transpiled version will be
named <code class="docutils literal notranslate"><span class="pre">myfile.babel.js</span></code>.</p>
<p>When the original script is run again, Rampart will check the date on the
script, and if it was not modified after the modification date of the
<code class="docutils literal notranslate"><span class="pre">*.babel.js</span></code> file, the transpile stage will be skipped and the cached,
transpiled script will be run directly.</p>
</div>
<div class="section" id="caveats">
<h3>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h3>
<p>For a complicated script, the transpile stage can be very slow.  However if
the script has not changed since last run, the execution speed will be
normal as the cached/transpiled code will be used and thus no traspiling
will occur.</p>
<p>Though nearly all rampart functions are synchronous, asynchronous code may
also be used with babel.  For example, the following code produces the same
output in Rampart and Node.js.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use babel&quot;</span> <span class="cm">/* ignored in node */</span>

<span class="kd">function</span> <span class="nx">resolveme</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="p">=&gt;</span> <span class="p">{</span>

    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;**I&#39;m async in a Timeout!!**&quot;</span><span class="p">);</span>
    <span class="p">},</span><span class="mi">5</span><span class="p">);</span>

    <span class="nx">resolve</span><span class="p">(</span><span class="s2">&quot;**I&#39;m async!!**&quot;</span><span class="p">);</span>

  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">asyncCall</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">resolveme</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">asyncCall</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<span class="sb">`a multiline string</span>
<span class="sb">using backticks`</span>
<span class="p">);</span>

<span class="cm">/* expect output:</span>
<span class="cm">a multiline string</span>
<span class="cm">using backticks</span>
<span class="cm">**I&#39;m async!!**</span>
<span class="cm">**I&#39;m async in a Timeout!!**</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rampart-utils.html" class="btn btn-neutral float-right" title="rampart.utils" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to Rampart’s documentation." accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Moat Crossing Systems.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>