

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The rampart-lmdb module &mdash; Rampart 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/hacks.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rampart 0.1.0 documentation" href="index.html"/>
        <link rel="next" title="The rampart-redis module" href="rampart-redis.html"/>
        <link rel="prev" title="The rampart-curl module" href="rampart-curl.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rampart
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="rampart-main.html">Rampart JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-utils.html">Rampart Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="sqltoc.html">The rampart-sql module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-server.html">The rampart-server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-html.html">The rampart-html module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-crypto.html">The rampart-crypto module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-curl.html">The rampart-curl module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The rampart-lmdb module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preface">Preface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#acknowledgment">Acknowledgment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-does-it-do">What does it do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#loading-and-using-the-module">Loading and Using the Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading">Loading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-function-init">Main Function (init)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lmdb-easy-functions">LMDB Easy Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#opendb">openDb</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get">get</a></li>
<li class="toctree-l3"><a class="reference internal" href="#put">put</a></li>
<li class="toctree-l3"><a class="reference internal" href="#del">del</a></li>
<li class="toctree-l3"><a class="reference internal" href="#drop">drop</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sync">sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getcount">getCount</a></li>
<li class="toctree-l3"><a class="reference internal" href="#listdbs">listDbs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#close">close</a></li>
<li class="toctree-l3"><a class="reference internal" href="#easy-functions-full-example">Easy Functions Full Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lmdb-transaction-functions">LMDB Transaction Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lmdb-transaction">lmdb.transaction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-get">txn.get</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-getref">txn.getRef</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-put">txn.put</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-del">txn.del</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-cursors">Using Cursors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-cursorget">txn.cursorGet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-cursorput">txn.cursorPut</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-cursordel">txn.cursorDel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-cursornext">txn.cursorNext</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-cursorprev">txn.cursorPrev</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-commit">txn.commit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txn-abort">txn.abort</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-functions-full-example">Transaction Functions Full Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rampart-redis.html">The rampart-redis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-robots.html">The rampart-robots module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-cmark.html">The rampart-cmark module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rampart</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>The rampart-lmdb module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/rampart-lmdb.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-rampart-lmdb-module">
<h1>The rampart-lmdb module<a class="headerlink" href="#the-rampart-lmdb-module" title="Permalink to this headline">¶</a></h1>
<div class="section" id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="acknowledgment">
<h3>Acknowledgment<a class="headerlink" href="#acknowledgment" title="Permalink to this headline">¶</a></h3>
<p>The rampart-lmdb module uses
<a class="reference external" href="https://symas.com/lmdb/">Symas LMDB library</a>.
The authors of Rampart extend our thanks to
<a class="reference external" href="https://symas.com/">Symas</a>
for this library.</p>
</div>
<div class="section" id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<p>The LMDB library is licensed under the
<a class="reference external" href="https://github.com/LMDB/lmdb/blob/mdb.master/libraries/liblmdb/LICENSE">OpenLdap Public License</a>,
which is a BSD-like license.
The rampart-lmdb module is released under the MIT license.</p>
</div>
<div class="section" id="what-does-it-do">
<h3>What does it do?<a class="headerlink" href="#what-does-it-do" title="Permalink to this headline">¶</a></h3>
<p>The rampart-lmdb module provides a key/value store database using the LMDB
library.  For background information, see
<a class="reference external" href="https://symas.com/lmdb/">Symas’ description here</a>.</p>
</div>
<div class="section" id="how-does-it-work">
<h3>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h3>
<p>The rampart-lmdb module exports a get and put function which allow a program
to store data indexed by its key.  Data may be a <span class="green">String</span> or
<span class="green">Buffer</span>, or optionally data can be converted to and from JSON
automatically.</p>
</div>
</div>
<div class="section" id="loading-and-using-the-module">
<h2>Loading and Using the Module<a class="headerlink" href="#loading-and-using-the-module" title="Permalink to this headline">¶</a></h2>
<div class="section" id="loading">
<h3>Loading<a class="headerlink" href="#loading" title="Permalink to this headline">¶</a></h3>
<p>Loading the module is a simple matter of using the <code class="docutils literal notranslate"><span class="pre">require()</span></code> function:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>Within LMDB, a “database environment” is a single file which lives in its own
directory, and has an accompanying lock file.  Within that file, data may be
partitioned into “databases”.  Thus an LMDB “database environment” is
organizationally similar to a SQL database and an LMDB “database” is similar
to a SQL table.</p>
</div>
<div class="section" id="main-function-init">
<h2>Main Function (init)<a class="headerlink" href="#main-function-init" title="Permalink to this headline">¶</a></h2>
<p>After loading, a new database environment can be opened (and optionally created) as
follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code> is a <span class="green">String</span>, the location of the database environment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">create</span></code> is a <span class="green">Boolean</span>, whether to create a new database
environment, if it doesn’t exist.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code> is a <span class="green">Object</span>, a list of options for opening a new
database environment.  Options include:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mapSize</span></code> - a <span class="green">Number</span>, an integer to set the size of the memory map
in megabytes to use for this environment.  The size of the memory
map is also the maximum size of the database environment.  The
value should be chosen as large as possible, to accommodate future
growth of the database environment.  It may be increased after the
database environment is created.  The default is <code class="docutils literal notranslate"><span class="pre">16</span></code> (16Mb).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conversion</span></code> - <span class="green">String</span>, whether and what type of
conversions should be performed before storing values.  This
applies to <a class="reference internal" href="#lmdb-easy-functions">LMDB Easy Functions</a> only.  The value is of these
case-insensitive <span class="green">Strings</span>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Buffer</span></code> - the default if not specified.  Input values
(<a class="reference internal" href="#put">put</a>) can be a <span class="green">String</span> or a <span class="green">Buffer</span> and are
stored as is.  Output values (<a class="reference internal" href="#get">get</a>) will be a
<span class="green">Buffer</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">String</span></code> - Input values (<a class="reference internal" href="#put">put</a>) can be a <span class="green">String</span>
or a <span class="green">Buffer</span> and are stored as is.  Output values
(<a class="reference internal" href="#get">get</a>) will be a <span class="green">String</span>.  If the output value
includes NULL characters, the <span class="green">String</span> will be truncated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JSON</span></code> - Input values (<a class="reference internal" href="#put">put</a>) can be any type
except a <span class="green">Buffer</span> or an <span class="green">Object</span> that contains a
<span class="green">Buffer</span>.  Output values (<a class="reference internal" href="#get">get</a>) will be the same as
the input value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CBOR</span></code> - Input values
(<a class="reference internal" href="#put">put</a>) can be any type including a <span class="green">Buffer</span> or
<span class="green">Objects</span> that contains a <span class="green">Buffers</span>.  Output
values (<a class="reference internal" href="#get">get</a>) will be the same as the input value. See
<a class="reference external" href="https://duktape.org/guide.html#builtin-cbor">CBOR encoding description</a>
for more information on CBOR encoding.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxDbs</span></code> - a positive <span class="green">Number</span>, the maximum number of
named databases that can be used in the opened database
environment.  Default is 256.  There is a cost to opening an
environment with a large <code class="docutils literal notranslate"><span class="pre">maxDbs</span></code> value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noSync</span></code> - a <span class="green">Boolean</span>, whether to turn off the flushing
of LMDB buffers to disk when committing a transaction.  This
optimization means a system crash can corrupt the database or lose
the last transactions if buffers are not yet flushed to disk.  The
risk is governed by how often the system flushes dirty buffers to
disk and how often <a class="reference internal" href="#sync">sync</a> is manually called.  However, if the
filesystem preserves write order and the <code class="docutils literal notranslate"><span class="pre">writeMap</span></code> setting
below is not set or set <code class="docutils literal notranslate"><span class="pre">false</span></code>, transactions exhibit ACI
(atomicity, consistency, isolation) properties and only lose D
(durability).  This means database integrity is maintained, but a
system crash may undo the final transactions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noMetaSync</span></code> - a <span class="green">Boolean</span>, whether flushing of the system buffers
to disk happens only once per transaction, omitting the metadata
flush.  If true, LMDB will defer that until the system flushes
files to disk, or when <a class="reference internal" href="#sync">sync</a> below is called.
This optimization maintains database integrity, but a system crash
may undo the last committed transaction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mapAsync</span></code> - a <span class="green">Boolean</span>, whether, when using
<code class="docutils literal notranslate"><span class="pre">writeMap</span></code>, LMDB should use asynchronous flushes to disk. As with
<code class="docutils literal notranslate"><span class="pre">noSync</span></code>, a system crash can then corrupt the database or lose
the last transactions. Calling <a class="reference internal" href="#sync">sync</a> below ensures on-disk
database integrity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noReadAhead</span></code> - a <span class="green">Boolean</span>, whether LMDB should Turn off
readahead. Most operating systems perform readahead on read
requests by default. This option turns it off if the OS supports
it. Turning it off may help random read performance when the DB is
larger than RAM and system RAM is full.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">writeMap</span></code> - a <span class="green">Boolean</span>, whether to write data directly
to LMDB’s memory map of the database environment. This is faster
and uses fewer mallocs, but loses protection from application bugs
like wild pointer writes and other bad updates into the database.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A set of functions to operate on the database environment.  See below.</p>
</dd>
</dl>
</div>
<div class="section" id="lmdb-easy-functions">
<h2>LMDB Easy Functions<a class="headerlink" href="#lmdb-easy-functions" title="Permalink to this headline">¶</a></h2>
<p>After a database environment is opened, the following functions and
flags are available in the return object:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">create</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="cm">/* return value:</span>
<span class="cm">    {</span>
<span class="cm">        openDb:      {_func: true},</span>
<span class="cm">        getCount:    {_func: true},</span>
<span class="cm">        get:         {_func: true},</span>
<span class="cm">        put:         {_func: true},</span>
<span class="cm">        del:         {_func: true},</span>
<span class="cm">        drop:        {_func: true},</span>
<span class="cm">        sync:        {_func: true},</span>
<span class="cm">        transaction: {_func: true}</span>
<span class="cm">    }</span>
<span class="cm">*/</span>
</pre></div>
</div>
<div class="section" id="opendb">
<h3>openDb<a class="headerlink" href="#opendb" title="Permalink to this headline">¶</a></h3>
<p>Open a database for use with the below functions.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">openDb</span><span class="p">([</span><span class="nx">dbase</span><span class="p">[,</span> <span class="nx">create</span><span class="p">]]);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <span class="green">String</span>, the name of the database
to be accessed.  If <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, the lmdb default database
for the database envirnoment will be opened.</p>
<p><code class="docutils literal notranslate"><span class="pre">create</span></code> is a <span class="green">Boolean</span>, if <code class="docutils literal notranslate"><span class="pre">true</span></code> openDb will be
a write transaction which creates the database, if it does not
exist.</p>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> representing the opened database.</p>
</dd>
<dt>Note:</dt><dd><p>If opening a database for use in one of the
<a class="reference internal" href="#lmdb-transaction-functions">LMDB Transaction Functions</a> below, this function must be called
before any transaction is opened (before calling <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction()</span></code>).</p>
</dd>
</dl>
</div>
<div class="section" id="get">
<h3>get<a class="headerlink" href="#get" title="Permalink to this headline">¶</a></h3>
<p>Retrieve values from a database.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>


<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dbase</span><span class="p">,</span> <span class="nx">key</span><span class="p">[,</span> <span class="nx">nKeys</span><span class="p">]);</span>

<span class="cm">/* or */</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dbase</span><span class="p">,</span> <span class="nx">key</span><span class="p">[,</span> <span class="nx">endkey</span><span class="p">][,</span> <span class="nx">max</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a> or a
<span class="green">String</span>, the name of the database to be accessed.  If the
database does not exist, an error will be thrown.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is a <span class="green">String</span>, the name of the key whose data
will be retrieved.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nKeys</span></code> is an optional <span class="green">Number</span>, the total number of keys to
retrieve.  If a positive number, the <code class="docutils literal notranslate"><span class="pre">key</span></code> will be returned
along with the next <code class="docutils literal notranslate"><span class="pre">nKeys</span> <span class="pre">-</span> <span class="pre">1</span></code> keys that follow in lexical
order.  If a negative number, the <code class="docutils literal notranslate"><span class="pre">key</span></code> will be returned
along with the previous <code class="docutils literal notranslate"><span class="pre">nKeys</span> <span class="pre">-</span> <span class="pre">1</span></code> keys that preceed in lexical
order. NOTE that if key is not found, no other keys will be returned.
See the glob version in <code class="docutils literal notranslate"><span class="pre">endkey</span></code> below for that functionality.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">endkey</span></code> is an optional <span class="green">String</span>, the last key to retrieve, retrieving
all keys between <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">endKey</span></code> (but no more than <code class="docutils literal notranslate"><span class="pre">max</span></code>, if given).  If
<code class="docutils literal notranslate"><span class="pre">endKey</span></code> preceeds <code class="docutils literal notranslate"><span class="pre">key</span></code> in lexical order, the keys and values will
be returned in reverse order (but no more than <code class="docutils literal notranslate"><span class="pre">max</span></code>, if given).</p>
<p>Globbing: If <code class="docutils literal notranslate"><span class="pre">endKey</span></code> is set to the special string <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code>, all keys beginning
with <code class="docutils literal notranslate"><span class="pre">key</span></code> will be returned.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max</span></code> is an optional positive <span class="green">Number</span> greater than 0 which may be specified
to limit the number of key/value pairs returned when using <code class="docutils literal notranslate"><span class="pre">endkey</span></code>.</p></li>
</ul>
</div></blockquote>
<dl>
<dt>Return Value:</dt><dd><p>If neither <code class="docutils literal notranslate"><span class="pre">nKeys</span></code> nor <code class="docutils literal notranslate"><span class="pre">endkey</span></code> is specified, a single value is
returned.  The type of the return value is determined by the <code class="docutils literal notranslate"><span class="pre">conversion</span></code>
setting above.</p>
<p>If either <code class="docutils literal notranslate"><span class="pre">nKeys</span></code> or <code class="docutils literal notranslate"><span class="pre">endkey</span></code> is specified, an <span class="green">Object</span> of
key/value pairs is returned with each key set to the name of the
retrieved key and each value set as described above.</p>
</dd>
</dl>
</div>
<div class="section" id="put">
<h3>put<a class="headerlink" href="#put" title="Permalink to this headline">¶</a></h3>
<p>Put (store) values in a given <span class="green">Object</span> or in a given key:value pair
into a given database, indexed by the key(s).</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">dbase</span><span class="p">,</span> <span class="nx">kvpairs</span><span class="p">);</span>

<span class="cm">/* or */</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">dbase</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a> or a
<span class="green">String</span>, the name of the database to be accessed.  If the
database does not exist, it will be created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kvpairs</span></code> is an <span class="green">Object</span> with each <span class="green">Object</span> key
corresponding to a database key to be used and each <span class="green">Object</span>
value corresponding to the database value to be stored.  Note: Values must
be a <span class="green">String</span> or <span class="green">Buffer</span> unless <code class="docutils literal notranslate"><span class="pre">conversion</span></code> above is
set to “JSON” or “CBOR”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is the key of a single key:value pair.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is the value of a single key:value pair.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="del">
<h3>del<a class="headerlink" href="#del" title="Permalink to this headline">¶</a></h3>
<p>Delete values in a database.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">del</span><span class="p">(</span><span class="nx">dbase</span><span class="p">,</span> <span class="nx">key</span><span class="p">[,</span> <span class="nx">nKeys</span><span class="p">][,</span> <span class="nx">retValues</span><span class="p">]);</span>

<span class="cm">/* or */</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">del</span><span class="p">(</span><span class="nx">dbase</span><span class="p">,</span> <span class="nx">key</span><span class="p">[,</span> <span class="nx">endkey</span><span class="p">][,</span> <span class="nx">max</span><span class="p">][,</span> <span class="nx">retValues</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where options are the same as in <a class="reference internal" href="#get">get</a> above, with the addition of
<code class="docutils literal notranslate"><span class="pre">retValues</span></code> (which, if provided, is a <span class="green">Boolean</span>).  If <code class="docutils literal notranslate"><span class="pre">retValues</span></code>
is set <code class="docutils literal notranslate"><span class="pre">true</span></code>, the deleted values are returned in the same manner as get.
Otherwise <code class="docutils literal notranslate"><span class="pre">undefined</span></code> is returned.</p>
</div>
<div class="section" id="drop">
<h3>drop<a class="headerlink" href="#drop" title="Permalink to this headline">¶</a></h3>
<p>Drop a database from the database environment removing all the
items in the database along with the database itself.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">dbase</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a> or a
<span class="green">String</span>, the name of the database to be dropped.</p>
<p>To drop the default database, pass an empty string or <code class="docutils literal notranslate"><span class="pre">null</span></code>:
<code class="docutils literal notranslate"><span class="pre">lmdb.drop(null);</span></code>.</p>
</li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
<dt>Note:</dt><dd><p>If a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> is specified, it must not be used as a parameter
to any other function after executing <code class="docutils literal notranslate"><span class="pre">lmdb.drop()</span></code>.  It, however,
may be recreated calling <code class="docutils literal notranslate"><span class="pre">openDb(dbname,</span> <span class="pre">true)</span></code> again.</p>
</dd>
<dt>Note:</dt><dd><p>Dropping the default database will delete the its contents,
however it will not be removed and the named database metadata
will remain.</p>
</dd>
</dl>
</div>
<div class="section" id="sync">
<h3>sync<a class="headerlink" href="#sync" title="Permalink to this headline">¶</a></h3>
<p>Sync the database envirnoment.  Useful if <code class="docutils literal notranslate"><span class="pre">mapAsync</span></code> or <code class="docutils literal notranslate"><span class="pre">noSync</span></code>
is set in order to manually sync data to the disk.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">sync</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="getcount">
<h3>getCount<a class="headerlink" href="#getcount" title="Permalink to this headline">¶</a></h3>
<p>Count the number of items in a database.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">getCount</span><span class="p">(</span><span class="nx">dbase</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a> or a
<span class="green">String</span>, the name of the database to be accessed.  If the
database does not exist, an error will be thrown.</p>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <span class="green">Number</span>, the number of items in the database.</p>
</dd>
</dl>
</div>
<div class="section" id="listdbs">
<h3>listDbs<a class="headerlink" href="#listdbs" title="Permalink to this headline">¶</a></h3>
<p>List the named databases in a database environment.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">listDbs</span><span class="p">(</span><span class="nx">dbase</span><span class="p">);</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An <span class="green">Array</span> of <span class="green">Strings</span>, the names
of all named databases.</p>
</dd>
<dt>Note:</dt><dd><p>The names of named databases are stored in the default database.  To
retrieve the names, every item in the default database must be scanned.
When using named databases, the best practice is to not store data in
the default database.</p>
</dd>
</dl>
</div>
<div class="section" id="close">
<h3>close<a class="headerlink" href="#close" title="Permalink to this headline">¶</a></h3>
<p>Close the database envirnoment.  After closing, all transaction
handles, database handles and all functions using the previously
opened environment will throw errors if used again.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* do stuff */</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="easy-functions-full-example">
<h3>Easy Functions Full Example<a class="headerlink" href="#easy-functions-full-example" title="Permalink to this headline">¶</a></h3>
<p>The following creates random entries of names and addresses.  After the
database is populated with the sample data, a selection that meet specific
criteria is printed.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* make printf and sprintf easier to use */</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class="p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;printf&quot;</span><span class="p">,</span><span class="s2">&quot;sprintf&quot;</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
    <span class="s2">&quot;./lmdb-test&quot;</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span> <span class="cm">/* create if does not exist */</span>
    <span class="p">{</span>
        <span class="nx">mapSize</span><span class="o">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="c1">//one gigabyte</span>
        <span class="nx">conversion</span><span class="o">:</span> <span class="s2">&quot;CBOR&quot;</span><span class="p">,</span>
        <span class="nx">noMetaSync</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">noSync</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="kd">var</span> <span class="nx">dbi</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">openDb</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="cm">/* create test data */</span>

<span class="kd">var</span> <span class="nx">fnames</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Mohamed&quot;</span><span class="p">,</span> <span class="s2">&quot;Imene&quot;</span><span class="p">,</span> <span class="s2">&quot;Santiago&quot;</span><span class="p">,</span> <span class="s2">&quot;Sofía&quot;</span><span class="p">,</span> <span class="s2">&quot;Wei&quot;</span><span class="p">,</span> <span class="s2">&quot;Jing&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Noel&quot;</span><span class="p">,</span> <span class="s2">&quot;Amelia&quot;</span><span class="p">,</span> <span class="s2">&quot;Oliver&quot;</span><span class="p">,</span> <span class="s2">&quot;Olivia&quot;</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">lnames</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Beridze&quot;</span><span class="p">,</span> <span class="s2">&quot;Cohen&quot;</span><span class="p">,</span> <span class="s2">&quot;Kovačević&quot;</span><span class="p">,</span> <span class="s2">&quot;Nielsen&quot;</span><span class="p">,</span> <span class="s2">&quot;Tremblay&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Hernández&quot;</span><span class="p">,</span> <span class="s2">&quot;Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;Kumar&quot;</span><span class="p">,</span> <span class="s2">&quot;Mabiala&quot;</span><span class="p">,</span> <span class="s2">&quot;Kimetto&quot;</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">initials</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">streets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Main&quot;</span><span class="p">,</span> <span class="s2">&quot;Broadway&quot;</span><span class="p">,</span> <span class="s2">&quot;First&quot;</span><span class="p">,</span> <span class="s2">&quot;Second&quot;</span><span class="p">,</span> <span class="s2">&quot;Grove&quot;</span><span class="p">,</span> <span class="s2">&quot;College&quot;</span><span class="p">,</span>
               <span class="s2">&quot;University&quot;</span><span class="p">,</span> <span class="s2">&quot;Park&quot;</span><span class="p">,</span> <span class="s2">&quot;Oak&quot;</span><span class="p">,</span> <span class="s2">&quot;Pine&quot;</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">stsuff</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Street&quot;</span><span class="p">,</span> <span class="s2">&quot;Drive&quot;</span><span class="p">,</span> <span class="s2">&quot;Avenue&quot;</span><span class="p">,</span> <span class="s2">&quot;Blvd&quot;</span><span class="p">,</span> <span class="s2">&quot;Court&quot;</span><span class="p">,</span> <span class="s2">&quot;Circle.&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Road&quot;</span><span class="p">,</span> <span class="s2">&quot;Lane&quot;</span><span class="p">,</span> <span class="s2">&quot;Way&quot;</span><span class="p">,</span> <span class="s2">&quot;Highway&quot;</span><span class="p">];</span>

<span class="kd">function</span> <span class="nx">makeName</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">first</span><span class="o">:</span> <span class="nx">fnames</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)],</span>
        <span class="nx">mi</span><span class="o">:</span>    <span class="nx">initials</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">26</span><span class="p">)),</span>
        <span class="nx">last</span><span class="o">:</span>  <span class="nx">lnames</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)]</span>
    <span class="p">}</span>
    <span class="nx">ret</span><span class="p">.</span><span class="nx">full</span> <span class="o">=</span> <span class="nx">sprintf</span> <span class="p">(</span><span class="s2">&quot;%s %s. %s&quot;</span><span class="p">,</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">first</span><span class="p">,</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">mi</span><span class="p">,</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">last</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">makeAddr</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">streetno</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10000</span><span class="p">);</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">street</span> <span class="o">=</span> <span class="nx">sprintf</span><span class="p">(</span><span class="s2">&quot;%s %s&quot;</span><span class="p">,</span>
                    <span class="nx">streets</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)],</span>
                    <span class="nx">stsuff</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)]</span>
                 <span class="p">);</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">zip</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">90000</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* insert entries */</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">makeName</span><span class="p">();</span>
    <span class="nx">entry</span> <span class="o">=</span> <span class="nx">makeAddr</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">full</span> <span class="o">+</span> <span class="s2">&quot; from &quot;</span> <span class="o">+</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">zip</span><span class="p">;</span>
    <span class="nx">lmdb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">entry</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// sync now, or sync will happen upon script exit.</span>
<span class="c1">//lmdb.sync();</span>

<span class="cm">/* get all the Sofías in the database */</span>
<span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span> <span class="s2">&quot;Sofía&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">entries</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">getCount</span><span class="p">(</span><span class="nx">dbi</span><span class="p">);</span>

<span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;There are %d Sofías out of %d entries in the database.\n&quot;</span><span class="p">,</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">total</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="c1">// find the Sofías living on Main Street</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">street</span> <span class="o">==</span> <span class="s2">&quot;Main Street&quot;</span><span class="p">)</span>
        <span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;%s lives at %d %s\n&quot;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">streetno</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">street</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* possible output:</span>
<span class="cm">There are 471 Sofías out of 5000 entries in the database.</span>
<span class="cm">Sofía D. Cohen from 85916 lives at 2320 Main Street</span>
<span class="cm">Sofía H. Hernández from 17267 lives at 518 Main Street</span>
<span class="cm">Sofía J. Tremblay from 69088 lives at 4701 Main Street</span>
<span class="cm">Sofía T. Kimetto from 73446 lives at 441 Main Street</span>
<span class="cm">Sofía U. Mabiala from 94846 lives at 1608 Main Street</span>
<span class="cm">Sofía Z. Hernández from 57045 lives at 905 Main Street</span>
<span class="cm">*/</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that the above is a naive way of inserting data into a database since
it opens and closes a transaction for every record inserted.</p>
<p>Though more memory intensive, it is far more efficient to use the following
code in order to insert all of the records in a single transaction:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* create entries in an object*/</span>
<span class="kd">var</span> <span class="nx">insertobj</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">makeName</span><span class="p">();</span>
    <span class="nx">entry</span> <span class="o">=</span> <span class="nx">makeAddr</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">full</span> <span class="o">+</span> <span class="s2">&quot; from &quot;</span> <span class="o">+</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">zip</span><span class="p">;</span>
    <span class="nx">insertobj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">=</span><span class="nx">entry</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* insert all at once */</span>
<span class="nx">lmdb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span> <span class="nx">insertobj</span><span class="p">);</span>
</pre></div>
</div>
<p>In order to conserver memory and to insert in a single transaction, see the
<a class="reference internal" href="#transaction-functions-full-example">Transaction Functions Full Example</a> below.</p>
</div>
</div>
<div class="section" id="lmdb-transaction-functions">
<h2>LMDB Transaction Functions<a class="headerlink" href="#lmdb-transaction-functions" title="Permalink to this headline">¶</a></h2>
<p>Transactions provide lower level access to lmdb function.  In the above
functions, transactions are automatically opened and closed without
explicitely having to do so.  In order to have more flexibility and possibly
see a performance gain, the transaction model outlined below provides
the relevant functions.</p>
<div class="section" id="lmdb-transaction">
<h3>lmdb.transaction<a class="headerlink" href="#lmdb-transaction" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">lmdb.transaction</span></code> function opens a new transaction and returns
functions which may perform tasks within the open transaction.</p>
<p>Note that the <a class="reference internal" href="#lmdb-easy-functions">LMDB Easy Functions</a> above that open an internal transaction
for writing will throw an error if they are called while any write
transaction below is open.</p>
<p>These include <a class="reference internal" href="#put">put</a>, <a class="reference internal" href="#del">del</a>, <a class="reference internal" href="#drop">drop</a> and <a class="reference internal" href="#opendb">openDb</a>
(only when a database is being created).</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>var Lmdb = require(&quot;rampart-lmdb&quot;);
var lmdb = new Lmdb.init(path,create,options);

var txn = new lmdb.transaction([dbase, ] open_rw [, commit_by_default] );

/* return value:
    {
        get:         {_func: true},
        put:         {_func: true},
        del:         {_func: true},
        cursorGet:   {_func: true},
        cursorPut:   {_func: true},
        cursorDel:   {_func: true},
        cursorNext:  {_func: true},
        cursorPrev:  {_func: true},
        commit:      {_func: true},
        abort:       {_func: true},
        lmdb:        {} /*the above lmdb object */
    }
*/

/* use connection, then commit or abort */
tnx.commit();
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a> or a
<span class="green">String</span>, the name of the database to be accessed.  If the
database does not exist, it will be created.  If omitted, the
lmdb default database for the current database environment will
be use.  This database will be the default for all operations
below.  However, more than one database may be used per transaction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">open_rw</span></code> is an <span class="green">Boolean</span>, if <code class="docutils literal notranslate"><span class="pre">true</span></code>, open the transaction
for read/write.  This is needed if any data will be added or deleted
from a database.  If <code class="docutils literal notranslate"><span class="pre">false</span></code>, the transaction will be read only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commit_by_default</span></code> is an <span class="green">Boolean</span>.  When a transaction is
opened, it must be eventually closed using either <a class="reference internal" href="#txn-commit">txn.commit</a> or
<a class="reference internal" href="#txn-abort">txn.abort</a>.  If the script exits or <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">txn</span></code> goes out of
scope (e.g. the function in which <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">txn</span></code> was declared returns) without
closing, it will be automatically closed.  If <code class="docutils literal notranslate"><span class="pre">commit_by_default</span></code>
is <code class="docutils literal notranslate"><span class="pre">true</span></code>, <a class="reference internal" href="#txn-commit">txn.commit</a> will be called. Otherwise if <code class="docutils literal notranslate"><span class="pre">false</span></code> (the default) or
not set, <a class="reference internal" href="#txn-abort">txn.abort</a> will be called.  This is only relevant when
<code class="docutils literal notranslate"><span class="pre">open_rw</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> and the database is being altered.</p></li>
</ul>
</div></blockquote>
<dl>
<dt>Note:</dt><dd><p>Only one read/write transaction per database environment may be open at
any time.  Attempting to open one while another is open will throw an
error.  However, along with one read/write transaction, several read
only transactions may be concurrently open in a single database
environment.</p>
<p>Note also that opening a new transaction with a <span class="green">String</span>
<code class="docutils literal notranslate"><span class="pre">dbase</span></code> parameter, and where <code class="docutils literal notranslate"><span class="pre">dbase</span></code> does not exist is a read/write
open even if <code class="docutils literal notranslate"><span class="pre">open_rw</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>.  As such, if another read/write
transaction is open, an error will be thrown.  In such a case, the
database should be opened using <a class="reference internal" href="#opendb">openDb</a> to create it before any
read/write transactions are opened.</p>
<p>Note also that the one open read/write transaction restriction is
per-thread, so no special care is needed when using LMDB from
<a class="reference internal" href="rampart-server.html#the-rampart-server-http-module"><span class="std std-ref">The rampart-server HTTP module</span></a>.  However, when
using LMDB from the server, a mutex lock is used to ensure that only one
read/write transaction is open at any given time.  Therefore read/write
transactions should be closed as soon as all writes are finished.</p>
</dd>
<dt>Return Value:</dt><dd><p>An <span class="green">Object</span> of functions.</p>
</dd>
</dl>
</div>
<div class="section" id="txn-get">
<h3>txn.get<a class="headerlink" href="#txn-get" title="Permalink to this headline">¶</a></h3>
<p>Get a single value from a database.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">get</span><span class="p">([</span><span class="nx">dbase</span> <span class="p">,]</span> <span class="nx">key</span> <span class="p">[,</span> <span class="nx">return_string</span><span class="p">]);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is a <span class="green">String</span> or <span class="green">Buffer</span>, the key of the item
to be retrieved.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code> the return value
will be a <span class="green">String</span>.  If <code class="docutils literal notranslate"><span class="pre">false</span></code> or not set, the return value
will be a <span class="green">Buffer</span>.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <span class="green">Buffer</span> or, if <code class="docutils literal notranslate"><span class="pre">return_string</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, a
<span class="green">String</span>.</p>
</dd>
</dl>
</div>
<div class="section" id="txn-getref">
<h3>txn.getRef<a class="headerlink" href="#txn-getref" title="Permalink to this headline">¶</a></h3>
<p>Get a single value from a database in a mmaped backed buffer.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">getRef</span><span class="p">([</span><span class="nx">dbase</span> <span class="p">,]</span> <span class="nx">key</span><span class="p">);</span>

<span class="cm">/* use res here */</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>

<span class="cm">/* res data is invalid and buffer is reset to zero length */</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is a <span class="green">String</span> or <span class="green">Buffer</span>, the key of the item
to be retrieved.</p></li>
</ul>
</div></blockquote>
<dl>
<dt>Return Value:</dt><dd><p>A <span class="green">Buffer</span>.  The buffer is backed by the mmaped data on disk and
is only valid until <a class="reference internal" href="#txn-commit">txn.commit</a> or <a class="reference internal" href="#txn-abort">txn.abort</a> is called, or until
the <code class="docutils literal notranslate"><span class="pre">txn</span></code> variable is no longer in scope.</p>
</dd>
<dt>Note:</dt><dd><p>This can be used to have <a class="reference internal" href="rampart-server.html#the-rampart-server-http-module"><span class="std std-ref">The rampart-server HTTP module</span></a>
serve content directly from the disk with no copies. In order to do so,
the <code class="docutils literal notranslate"><span class="pre">txn</span></code> variable must stay in scope until the content is served.</p>
<p>In the following example, <code class="docutils literal notranslate"><span class="pre">setTimeout</span></code> is used to keep the <code class="docutils literal notranslate"><span class="pre">txn</span></code>
object in scope until after the http transaction is complete.  Otherwise
the transaction would be automatically closed upon the return of the
function and the contents of the buffer would be invalid and reset to
zero length.</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* callback function for the rampart-server module */</span>
<span class="kd">function</span> <span class="nx">cb</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="cm">/* get a mmap backed reference to our data */</span>
    <span class="kd">var</span> <span class="nx">refbuf</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">getRef</span><span class="p">(</span><span class="s2">&quot;myjpg&quot;</span><span class="p">);</span>

    <span class="cm">/* close transaction after http request is served. *</span>
<span class="cm">     * The setTimeout function is inserted into the    *</span>
<span class="cm">     * event loop and will be run after the http reply *</span>
<span class="cm">     * is sent to the client.                          */</span>
    <span class="nx">setTimeout</span><span class="p">(</span>
        <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">txn</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="mi">0</span>
    <span class="p">);</span>
    <span class="cm">/* serve data directly from disk */</span>
    <span class="k">return</span><span class="p">({</span><span class="s2">&quot;jpg&quot;</span><span class="o">:</span><span class="nx">refbuf</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="txn-put">
<h3>txn.put<a class="headerlink" href="#txn-put" title="Permalink to this headline">¶</a></h3>
<p>Put (store) values in a given <span class="green">Object</span> into a given database, indexed
by the <span class="green">Object’s</span> keys.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read write */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">txn</span><span class="p">.</span><span class="nx">put</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">kvpairs</span><span class="p">);</span>

<span class="cm">/* or */</span>

<span class="nx">txn</span><span class="p">.</span><span class="nx">put</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kvpairs</span></code> is an <span class="green">Object</span> with each <span class="green">Object</span> key
corresponding to a database key to be used and each <span class="green">Object</span>
value corresponding to the database value to be stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is a <span class="green">String</span> or <span class="green">Buffer</span>, the key of a single key:value pair.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is a <span class="green">String</span> <span class="green">Buffer</span>, or <span class="green">Object</span>. The value of a single key:value pair.
If <code class="docutils literal notranslate"><span class="pre">value</span></code> is an <span class="green">Object</span>, it will be automatically converted
to a <span class="green">Buffer</span> using <code class="docutils literal notranslate"><span class="pre">CBOR.encode()</span></code>.  Note, when retrieved
using <code class="docutils literal notranslate"><span class="pre">txn.get</span></code> or <code class="docutils literal notranslate"><span class="pre">txn.cursorGet</span></code>, a CBOR encoded value will not
be automatically decoded.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="txn-del">
<h3>txn.del<a class="headerlink" href="#txn-del" title="Permalink to this headline">¶</a></h3>
<p>Delete an the item with the given key.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read write */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">txn</span><span class="p">.</span><span class="nx">del</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">key</span><span class="p">);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is the key of the item to be deleted.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <span class="green">Boolean</span>:  <code class="docutils literal notranslate"><span class="pre">true</span></code> if the item was deleted.  <code class="docutils literal notranslate"><span class="pre">false</span></code> if
there was no item with the given <code class="docutils literal notranslate"><span class="pre">key</span></code> found.</p>
</dd>
</dl>
</div>
<div class="section" id="using-cursors">
<h3>Using Cursors<a class="headerlink" href="#using-cursors" title="Permalink to this headline">¶</a></h3>
<p>When any of the below Cursor Functions is used, a cursor is automatically
created for the database being accessed. The cursor keeps track of the
position of the last operation and may be used for subsequent operations.</p>
<p>Each database specified in the below functions has its own associated cursor.
Each cursor is automatically destroyed when the transaction is committed or
aborted.</p>
</div>
<div class="section" id="txn-cursorget">
<h3>txn.cursorGet<a class="headerlink" href="#txn-cursorget" title="Permalink to this headline">¶</a></h3>
<p>Position the cursor using one of several possible “operation modes” and
return the key and value of the item at the cursor’s new position.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorGet</span><span class="p">([</span><span class="nx">dbase</span> <span class="p">,]</span> <span class="nx">op</span> <span class="p">[,</span> <span class="nx">key</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">key_is_string</span> <span class="p">[,</span> <span class="nx">val_is_string</span><span class="p">]</span> <span class="p">]);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">op</span></code> is a flag, which specifies the operation mode and is one of the following:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_set</span></code> - Position the cursor at the item with the key
<code class="docutils literal notranslate"><span class="pre">key</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_setRange</span></code> - Position the cursor at the first item with a key greater than or equal to
<code class="docutils literal notranslate"><span class="pre">key</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_first</span></code> - Position the cursor at the first item in the
given database.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_last</span></code> - Position the cursor at the last item in the given
database.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_next</span></code> - Position the cursor one after its current
position.  If the cursor has not been set, position at the
first item in the database.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_prev</span></code> - Position the cursor one before its current
position. If the cursor has not been set, position at the
last item in the database.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lmdb.op_current</span></code> - Cursor stays at its current position.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is the key of the item to be retrieved.  Used for <code class="docutils literal notranslate"><span class="pre">op_set</span></code>
and <code class="docutils literal notranslate"><span class="pre">op_setRange</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_is_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code> (the default),
the return <code class="docutils literal notranslate"><span class="pre">key</span></code> will be converted to a <span class="green">String</span>.
If <code class="docutils literal notranslate"><span class="pre">false</span></code>, (the default) the return <code class="docutils literal notranslate"><span class="pre">key</span></code> will be a <span class="green">Buffer</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_is_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code>, the returned
<code class="docutils literal notranslate"><span class="pre">value</span></code> will be converted to a <span class="green">String</span>.  If <code class="docutils literal notranslate"><span class="pre">false</span></code>,
(the default)``value`` will be a <span class="green">Buffer</span>.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An <span class="green">Object</span> with the propertis <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> set to the
key and value of the retrieved item (e.g. <code class="docutils literal notranslate"><span class="pre">{&quot;key&quot;:</span> <span class="pre">dbkey,</span> <span class="pre">&quot;value&quot;:</span> <span class="pre">dbval}</span></code>).</p>
</dd>
</dl>
</div>
<div class="section" id="txn-cursorput">
<h3>txn.cursorPut<a class="headerlink" href="#txn-cursorput" title="Permalink to this headline">¶</a></h3>
<p>Put (store) value in a given into a database, indexed
by the the given key.  Move cursor to the items location.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read write */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">true</span><span class="p">);</span>

<span class="nx">txn</span><span class="p">.</span><span class="nx">cursorPut</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is a <span class="green">String</span> or <span class="green">Buffer</span>, the key of a single key:value pair.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is a <span class="green">String</span> <span class="green">Buffer</span>, or <span class="green">Object</span>. The value of a single key:value pair.
If <code class="docutils literal notranslate"><span class="pre">value</span></code> is an <span class="green">Object</span>, it will be automatically converted
to a <span class="green">Buffer</span> using <code class="docutils literal notranslate"><span class="pre">CBOR.encode()</span></code>.  Note, when retrieved
using <code class="docutils literal notranslate"><span class="pre">txn.get</span></code> or <code class="docutils literal notranslate"><span class="pre">txn.cursorGet</span></code>, a CBOR encoded value will not
be automatically decoded.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="txn-cursordel">
<h3>txn.cursorDel<a class="headerlink" href="#txn-cursordel" title="Permalink to this headline">¶</a></h3>
<p>Delete the item at the cursor’s position.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read write */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">true</span><span class="p">);</span>

<span class="cm">/* e.g. to position the cursor */</span>
<span class="nx">txn</span><span class="p">.</span><span class="nx">cursorGet</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">op_set</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>

<span class="cm">/* delete item at cursor position */</span>
<span class="nx">txn</span><span class="p">.</span><span class="nx">cursorDel</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="txn-cursornext">
<h3>txn.cursorNext<a class="headerlink" href="#txn-cursornext" title="Permalink to this headline">¶</a></h3>
<p>Move cursor position to the next item and return the key:value pair.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="cm">/* position the cursor at next item*/</span>
<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorNext</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="p">[</span><span class="nx">key_is_string</span> <span class="p">[,</span> <span class="nx">val_is_string</span><span class="p">]</span> <span class="p">]);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_is_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code>
the return <code class="docutils literal notranslate"><span class="pre">key</span></code> will be converted to a <span class="green">String</span>.
If <code class="docutils literal notranslate"><span class="pre">false</span></code> (the default) the return <code class="docutils literal notranslate"><span class="pre">key</span></code> will be a <span class="green">Buffer</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_is_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code> the returned
<code class="docutils literal notranslate"><span class="pre">value</span></code> will be converted to a <span class="green">String</span>.  If <code class="docutils literal notranslate"><span class="pre">false</span></code>
(the default)``value`` will be a <span class="green">Buffer</span>.</p></li>
</ul>
</div></blockquote>
<p>This operates identical to:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="cm">/* position the cursor at next item*/</span>
<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorGet</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">op_next</span><span class="p">);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>The exception is that if the cursor is already at the last item,
<code class="docutils literal notranslate"><span class="pre">undefined</span></code> is returned instead of an empty object.</p>
<p>It allows the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">res</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">    Get every item in the database.</span>
<span class="cm">    If cursor has not been previously set cursorNext()</span>
<span class="cm">      starts at the first item.</span>
<span class="cm">*/</span>
<span class="k">while</span><span class="p">(</span> <span class="p">(</span><span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorNext</span><span class="p">())</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* do something with res */</span>
<span class="p">}</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p>Same as <a class="reference internal" href="#txn-cursorget">txn.cursorGet</a> (an <span class="green">Object</span>) unless the cursor
is at the last item (in which case <code class="docutils literal notranslate"><span class="pre">undefined</span></code> is returned).</p>
</dd>
</dl>
</div>
<div class="section" id="txn-cursorprev">
<h3>txn.cursorPrev<a class="headerlink" href="#txn-cursorprev" title="Permalink to this headline">¶</a></h3>
<p>Move cursor position to the previous item and return the key:value pair.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="cm">/* position the cursor at previous item*/</span>
<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorPrev</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="p">[</span><span class="nx">key_is_string</span> <span class="p">[,</span> <span class="nx">val_is_string</span><span class="p">]</span> <span class="p">]);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbase</span></code> is a <code class="docutils literal notranslate"><span class="pre">dbi</span> <span class="pre">object</span></code> returned from <a class="reference internal" href="#opendb">openDb</a>. If the
database does not exist, it will be created.  If omitted, the
database specified in <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">lmdb.transaction</span></code> will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key_is_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code>
the return <code class="docutils literal notranslate"><span class="pre">key</span></code> will be converted to a <span class="green">String</span>.
If <code class="docutils literal notranslate"><span class="pre">false</span></code> (the default) the return <code class="docutils literal notranslate"><span class="pre">key</span></code> will be a <span class="green">Buffer</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">val_is_string</span></code> is a <span class="green">Boolean</span>. If <code class="docutils literal notranslate"><span class="pre">true</span></code> the returned
<code class="docutils literal notranslate"><span class="pre">value</span></code> will be converted to a <span class="green">String</span>.  If <code class="docutils literal notranslate"><span class="pre">false</span></code>
(the default)``value`` will be a <span class="green">Buffer</span>.</p></li>
</ul>
</div></blockquote>
<p>This operates identical to:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="kc">false</span><span class="p">);</span>

<span class="cm">/* position the cursor at previous item*/</span>
<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorGet</span><span class="p">([</span><span class="nx">dbase</span><span class="p">,</span> <span class="p">]</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">op_prev</span><span class="p">);</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<p>The exception is that if the cursor is already at the first item,
<code class="docutils literal notranslate"><span class="pre">undefined</span></code> is returned instead of an empty object.</p>
<p>It allows the following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="cm">/* open read only if only reading in this transaction */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">res</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">    Get every item in the database in reverse order.</span>
<span class="cm">    If cursor has not been previously set cursorPrev()</span>
<span class="cm">      starts at the last item.</span>
<span class="cm">*/</span>
<span class="k">while</span><span class="p">(</span> <span class="p">(</span><span class="nx">res</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorPrev</span><span class="p">())</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* do something with res */</span>
<span class="p">}</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p>Same as <a class="reference internal" href="#txn-cursorget">txn.cursorGet</a> (an <span class="green">Object</span>) unless the cursor
is at the first item (in which case <code class="docutils literal notranslate"><span class="pre">undefined</span></code> is returned).</p>
</dd>
</dl>
</div>
<div class="section" id="txn-commit">
<h3>txn.commit<a class="headerlink" href="#txn-commit" title="Permalink to this headline">¶</a></h3>
<p>Commit the current transaction.  If it is a read/write transactions, the
associated mutex lock is released.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">],</span> <span class="nx">open_rw</span><span class="p">);</span>

<span class="cm">/* use tnx here */</span>

<span class="nx">tnx</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code></p>
</dd>
</dl>
</div>
<div class="section" id="txn-abort">
<h3>txn.abort<a class="headerlink" href="#txn-abort" title="Permalink to this headline">¶</a></h3>
<p>Abort the current transaction. All data written since starting the
transaction will be discarded. If it is a read/write transactions, the
associated mutex lock is released.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span> <span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>

 <span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span><span class="nx">create</span><span class="p">,</span><span class="nx">options</span><span class="p">);</span>

 <span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">([</span><span class="nx">dbase</span><span class="p">],</span> <span class="nx">open_rw</span><span class="p">);</span>

 <span class="cm">/* use tnx here */</span>

<span class="cm">/* discard any/all changes */</span>
 <span class="nx">tnx</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code></p>
</dd>
</dl>
</div>
<div class="section" id="transaction-functions-full-example">
<h3>Transaction Functions Full Example<a class="headerlink" href="#transaction-functions-full-example" title="Permalink to this headline">¶</a></h3>
<p>This example performs the same tasks as the <a class="reference internal" href="#easy-functions-full-example">Easy Functions Full Example</a>
except that it uses transactions.  As a result, execution speed is
significantly improved.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* make printf and sprintf easier to use */</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class="p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;printf&quot;</span><span class="p">,</span><span class="s2">&quot;sprintf&quot;</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">Lmdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-lmdb&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lmdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Lmdb</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
    <span class="s2">&quot;./lmdb-test&quot;</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>  <span class="cm">/* create if does not exist */</span>
    <span class="p">{</span>
        <span class="nx">mapSize</span><span class="o">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="cm">/* one gigabyte */</span>
        <span class="nx">conversion</span><span class="o">:</span> <span class="s2">&quot;CBOR&quot;</span><span class="p">,</span>
        <span class="nx">noMetaSync</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
        <span class="nx">noSync</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="kd">var</span> <span class="nx">dbi</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">openDb</span><span class="p">(</span><span class="s2">&quot;testdata&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="cm">/* create test data */</span>

<span class="kd">var</span> <span class="nx">fnames</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Mohamed&quot;</span><span class="p">,</span> <span class="s2">&quot;Imene&quot;</span><span class="p">,</span> <span class="s2">&quot;Santiago&quot;</span><span class="p">,</span> <span class="s2">&quot;Sofía&quot;</span><span class="p">,</span> <span class="s2">&quot;Wei&quot;</span><span class="p">,</span> <span class="s2">&quot;Jing&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Noel&quot;</span><span class="p">,</span> <span class="s2">&quot;Amelia&quot;</span><span class="p">,</span> <span class="s2">&quot;Oliver&quot;</span><span class="p">,</span> <span class="s2">&quot;Olivia&quot;</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">lnames</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Beridze&quot;</span><span class="p">,</span> <span class="s2">&quot;Cohen&quot;</span><span class="p">,</span> <span class="s2">&quot;Kovačević&quot;</span><span class="p">,</span> <span class="s2">&quot;Nielsen&quot;</span><span class="p">,</span> <span class="s2">&quot;Tremblay&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Hernández&quot;</span><span class="p">,</span> <span class="s2">&quot;Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;Kumar&quot;</span><span class="p">,</span> <span class="s2">&quot;Mabiala&quot;</span><span class="p">,</span> <span class="s2">&quot;Kimetto&quot;</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">initials</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">streets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Main&quot;</span><span class="p">,</span> <span class="s2">&quot;Broadway&quot;</span><span class="p">,</span> <span class="s2">&quot;First&quot;</span><span class="p">,</span> <span class="s2">&quot;Second&quot;</span><span class="p">,</span> <span class="s2">&quot;Grove&quot;</span><span class="p">,</span> <span class="s2">&quot;College&quot;</span><span class="p">,</span>
               <span class="s2">&quot;University&quot;</span><span class="p">,</span> <span class="s2">&quot;Park&quot;</span><span class="p">,</span> <span class="s2">&quot;Oak&quot;</span><span class="p">,</span> <span class="s2">&quot;Pine&quot;</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">stsuff</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Street&quot;</span><span class="p">,</span> <span class="s2">&quot;Drive&quot;</span><span class="p">,</span> <span class="s2">&quot;Avenue&quot;</span><span class="p">,</span> <span class="s2">&quot;Blvd&quot;</span><span class="p">,</span> <span class="s2">&quot;Court&quot;</span><span class="p">,</span> <span class="s2">&quot;Circle.&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Road&quot;</span><span class="p">,</span> <span class="s2">&quot;Lane&quot;</span><span class="p">,</span> <span class="s2">&quot;Way&quot;</span><span class="p">,</span> <span class="s2">&quot;Highway&quot;</span><span class="p">];</span>

<span class="kd">function</span> <span class="nx">makeName</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">first</span><span class="o">:</span> <span class="nx">fnames</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)],</span>
        <span class="nx">mi</span><span class="o">:</span>    <span class="nx">initials</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">26</span><span class="p">)),</span>
        <span class="nx">last</span><span class="o">:</span>  <span class="nx">lnames</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)]</span>
    <span class="p">}</span>
    <span class="nx">ret</span><span class="p">.</span><span class="nx">full</span> <span class="o">=</span> <span class="nx">sprintf</span> <span class="p">(</span><span class="s2">&quot;%s %s. %s&quot;</span><span class="p">,</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">first</span><span class="p">,</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">mi</span><span class="p">,</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">last</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">makeAddr</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">streetno</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10000</span><span class="p">);</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">street</span> <span class="o">=</span> <span class="nx">sprintf</span><span class="p">(</span><span class="s2">&quot;%s %s&quot;</span><span class="p">,</span>
                    <span class="nx">streets</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)],</span>
                    <span class="nx">stsuff</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)]</span>
                 <span class="p">);</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">zip</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">90000</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Open a new transaction and insert entries */</span>
<span class="kd">var</span> <span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span> <span class="c1">//read/write</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">makeName</span><span class="p">();</span>
    <span class="nx">entry</span> <span class="o">=</span> <span class="nx">makeAddr</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">full</span> <span class="o">+</span> <span class="s2">&quot; from &quot;</span> <span class="o">+</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">zip</span><span class="p">;</span>
    <span class="cm">/* since entry is an object, it will be converted to CBOR */</span>
    <span class="nx">txn</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">entry</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">txn</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>

<span class="c1">// sync now, or sync will happen upon script exit.</span>
<span class="c1">//lmdb.sync();</span>

<span class="cm">/* this must be done while not in a transaction */</span>
<span class="kd">var</span> <span class="nx">total</span> <span class="o">=</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">getCount</span><span class="p">(</span><span class="nx">dbi</span><span class="p">);</span>

<span class="cm">/* get all the Sofías in the database */</span>
<span class="nx">txn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span> <span class="c1">//read only</span>

<span class="cm">/* get first entry, make the key a string, leave value as a buffer */</span>
<span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorGet</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span> <span class="nx">lmdb</span><span class="p">.</span><span class="nx">op_setRange</span><span class="p">,</span> <span class="s2">&quot;Sofía&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="cm">/* process first entry and loop to get entries after */</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="cm">/* if there were no Sofías from the above cursorGet or if</span>
<span class="cm">       the current cursorNext is not a Sofía, we are done      */</span>
    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">key</span> <span class="o">||</span> <span class="o">!</span> <span class="sr">/^Sofía./</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">key</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
    <span class="cm">/* in transactions, CBOR is not automatically decoded */</span>
    <span class="nx">entry</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">CBOR</span><span class="p">.</span><span class="nx">decode</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">street</span> <span class="o">==</span> <span class="s2">&quot;Main Street&quot;</span><span class="p">)</span>
        <span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;%s lives at %d %s\n&quot;</span><span class="p">,</span>
                <span class="nx">entry</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
                <span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">streetno</span><span class="p">,</span>
                <span class="nx">entry</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">street</span>
              <span class="p">);</span>
<span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nx">entry</span> <span class="o">=</span> <span class="nx">txn</span><span class="p">.</span><span class="nx">cursorNext</span><span class="p">(</span><span class="nx">dbi</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>

<span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;There are %d Sofías out of %d entries in the database.\n&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">total</span><span class="p">);</span>

<span class="nx">txn</span><span class="p">.</span><span class="nx">commit</span><span class="p">();</span>

<span class="nx">lmdb</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">dbi</span><span class="p">);</span>

<span class="cm">/* possible output:</span>
<span class="cm">Sofía A. Cohen from 25350 lives at 4458 Main Street</span>
<span class="cm">Sofía I. Beridze from 11345 lives at 8483 Main Street</span>
<span class="cm">Sofía P. Cohen from 48234 lives at 9441 Main Street</span>
<span class="cm">Sofía S. Kimetto from 38632 lives at 5244 Main Street</span>
<span class="cm">Sofía X. Smith from 19604 lives at 21 Main Street</span>
<span class="cm">There are 501 Sofías out of 5000 entries in the database.</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rampart-redis.html" class="btn btn-neutral float-right" title="The rampart-redis module" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rampart-curl.html" class="btn btn-neutral" title="The rampart-curl module" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Moat Crossing Systems.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>