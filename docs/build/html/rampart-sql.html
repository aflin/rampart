

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Preface &mdash; Rampart 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/hacks.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rampart 0.1.0 documentation" href="index.html"/>
        <link rel="up" title="The rampart-sql module" href="sqltoc.html"/>
        <link rel="next" title="Server Functions" href="sql-server-funcs.html"/>
        <link rel="prev" title="The rampart-sql module" href="sqltoc.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rampart
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="rampart-main.html">Rampart JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-utils.html">Rampart Utility Functions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="sqltoc.html">The rampart-sql module</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Preface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#acknowledgment">Acknowledgment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-does-it-do">What does it do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation-caveat">Documentation Caveat</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#loading-the-javascript-module">Loading the Javascript Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-functions">Database Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#init-constructor">init() constructor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exec">exec()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one">one()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">set()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reset">reset()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importcsvfile">importCsvFile()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importcsv">importCsv()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#close">close()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#string-functions">String Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stringformat">stringFormat()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#escape-sequences">Escape Sequences</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standard-formats">Standard Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standard-flags">Standard Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#printing-date-time-values">Printing Date/Time Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#latitude-longitude-and-location">Latitude, Longitude and Location</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-format-codes">Other Format Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extended-flags">Extended Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metamorph-hit-mark-up">Metamorph Hit Mark-up</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#abstract">abstract()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sandr">sandr()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#replacement-strings">Replacement Strings:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sandr2">sandr2()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rex">rex()</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expressions">Expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#repitition-operators">Repitition Operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#discussion">Discussion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#re2">re2()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rexfile">rexFile()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#re2file">re2File()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#searchfile">searchFile()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sql-server-funcs.html">Server Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-set.html">Server Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="tsql.html">Tsql Command Line Utility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rampart-server.html">The rampart-server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-html.html">The rampart-html module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-crypto.html">The rampart-crypto module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-curl.html">The rampart-curl module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-lmdb.html">The rampart-lmdb module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-redis.html">The rampart-redis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-robots.html">The rampart-robots module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-cmark.html">The rampart-cmark module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rampart</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="sqltoc.html">The rampart-sql module</a> &raquo;</li>
        
      <li>Preface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/rampart-sql.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="preface">
<h1>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="acknowledgment">
<h2>Acknowledgment<a class="headerlink" href="#acknowledgment" title="Permalink to this headline">¶</a></h2>
<p>The developers of Rampart are indebted to Thunderstone, LLC for the
Texis library and the decades of development behind it.</p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>Use of the <code class="docutils literal notranslate"><span class="pre">rampart-sql</span></code> module and the Texis library is governed by the
Rampart Source Available License.</p>
</div>
<div class="section" id="what-does-it-do">
<h2>What does it do?<a class="headerlink" href="#what-does-it-do" title="Permalink to this headline">¶</a></h2>
<p>The rampart-sql module provides database and full text search capabilities
in Rampart.  It includes Texis, a SQL relational database with a fully integrated
full text search engine.</p>
</div>
<div class="section" id="documentation-caveat">
<h2>Documentation Caveat<a class="headerlink" href="#documentation-caveat" title="Permalink to this headline">¶</a></h2>
<p>In this document, the term “Texis” used to refer to the SQL engine, the text
search index and the text search engine.  The term “Metamorph” is used to
solely refer to the text search engine.</p>
<p>The convention used in this document is <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">Sql</span></code> with a capital
“S” for the return <span class="green">Object</span> of the loaded module and <code class="docutils literal notranslate"><span class="pre">var</span> <span class="pre">sql</span></code> with a
lower-case “s” for the instance of a connection to a database made with the
JavaScript <a class="reference internal" href="#initconst"><span class="std std-ref">init() constructor</span></a> <span class="green">Function</span>.</p>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>As the Texis library and its included Metamorph search engine encompasses
more functionality than is expressed in this documentation, a full understanding
of the workings of Texis and Metamorph can be found by referring to the
documentation at Thunderstone.com:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.thunderstone.com/site/texisman/">Texis Manual</a></p></li>
<li><p><a class="reference external" href="https://docs.thunderstone.com/site/texisman/metamorph_intelligent_query.html">Metamorph Manual</a></p></li>
</ul>
</div>
</div>
<div class="section" id="loading-the-javascript-module">
<h1>Loading the Javascript Module<a class="headerlink" href="#loading-the-javascript-module" title="Permalink to this headline">¶</a></h1>
<p>Loading of the sql module from within Rampart JavaScript is a simple matter
of using the <code class="docutils literal notranslate"><span class="pre">require</span></code> statement:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Return value:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    init:         {_func:true},
    stringFormat: {_func:true},
    abstract:     {_func:true},
    sandr:        {_func:true},
    sandr2:       {_func:true},
    rex:          {_func:true},
    re2:          {_func:true},
    rexFile:      {_func:true},
    re2File:      {_func:true},
    searchFile:   {_func:true}
}
</pre></div>
</div>
<p>The returned <span class="green">Object</span> contains <span class="green">Functions</span> that can be split into two groups:
<a class="reference internal" href="#database-functions">Database Functions</a> and <a class="reference internal" href="#string-functions">String Functions</a>.</p>
</div>
<div class="section" id="database-functions">
<h1>Database Functions<a class="headerlink" href="#database-functions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="init-constructor">
<span id="initconst"></span><h2>init() constructor<a class="headerlink" href="#init-constructor" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">init</span></code> constructor function takes a <span class="green">String</span>, the path to the database
and an optional <span class="green">Boolean</span> as parameters. It returns an <span class="green">Object</span> representing a
new connection to the specified database.  The return <span class="green">Object</span> includes the
following <span class="green">Functions</span>: <code class="docutils literal notranslate"><span class="pre">exec()</span></code>, <code class="docutils literal notranslate"><span class="pre">one()</span></code>, <code class="docutils literal notranslate"><span class="pre">set()</span></code>,
<code class="docutils literal notranslate"><span class="pre">reset()</span></code>, <code class="docutils literal notranslate"><span class="pre">importCsvFile()</span></code>, <code class="docutils literal notranslate"><span class="pre">importCsv</span></code> and <code class="docutils literal notranslate"><span class="pre">close()</span></code>.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">dbpath</span> <span class="p">[,</span><span class="nx">create</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 23%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>dbpath</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>The path to the directory containing the database</p></td>
</tr>
<tr class="row-odd"><td><p>create</p></td>
<td><p><span class="green">Boolean</span></p></td>
<td><p>if true, and the directory does not exist, the
directory and a new database will be created in
the location specified.</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An <span class="green">Object</span> of <span class="green">Functions</span>:</p>
</dd>
</dl>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
    exec:          {_func:true},
    one:           {_func:true},
    set:           {_func:true},
    reset:         {_func:true},
    importCsvFile: {_func:true},
    importCsv:     {_func:true},
    close:         {_func:true}
}
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>

<span class="cm">/* create database if it does not exist */</span>
<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;/path/to/my/db&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that to create a new database, the folder <code class="docutils literal notranslate"><span class="pre">/path/to/my/db</span></code> <strong>must
not</strong> exist, but <code class="docutils literal notranslate"><span class="pre">/path/to/my</span></code> <strong>must</strong> exist and have write permissions for
the current user.</p>
</div>
<div class="section" id="exec">
<h2>exec()<a class="headerlink" href="#exec" title="Permalink to this headline">¶</a></h2>
<p>The exec <span class="green">Function</span> executes a sql statement on the database opened
with <a class="reference internal" href="#initconst"><span class="std std-ref">init()</span></a>.  It takes a <span class="green">String</span> containing a sql
statement and an optional <span class="green">Object</span> or <span class="green">Array</span> of sql
parameters, an optional <span class="green">Object</span> of options and an optional callback
<span class="green">Function</span>.  The parameters may be specified in any order.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">statement</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">sql_parameters</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 20%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>statement</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>The sql statement</p></td>
</tr>
<tr class="row-odd"><td><p>options</p></td>
<td><p><span class="green">Object</span></p></td>
<td><p>Options (skipRows, maxRows, returnType, includeCounts
returnRows and arg) <em>as described below</em></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>sql_parameters</p></td>
<td><p><span class="green">Array</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">?</span></code> substitution parameters</p></td>
</tr>
<tr class="row-odd"><td><p><span class="green">Object</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">?named</span></code> substution parameters</p></td>
</tr>
<tr class="row-even"><td><p>callback</p></td>
<td><p><span class="green">Function</span></p></td>
<td><p>a function to handle data one row at a time.</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>Statement:</dt><dd><p>A statement is a <span class="green">String</span> containing a single sql statement to be
executed.  A trailing <code class="docutils literal notranslate"><span class="pre">;</span></code> (semicolon) is optional.  Example:</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select * from employees where Salary &gt; 50000 and Start_date &lt; &#39;2018-12-31&#39;&quot;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Note that concatenating statements separated by <code class="docutils literal notranslate"><span class="pre">;</span></code> is not supported in
JavaScript, and as such, a script must use a separate <code class="docutils literal notranslate"><span class="pre">exec()</span></code> for each
statement to be executed.</p>
<dl id="sql-params">
<dt>SQL Parameters:</dt><dd><p>SQL Parameters are specified in an <span class="green">Array</span> with each member
corresponding to each <code class="docutils literal notranslate"><span class="pre">?</span></code> in the SQL statement. Alternatively parameters
can be named in an <span class="green">Object</span> with each value in the
<span class="green">Object</span> corresponding to each <code class="docutils literal notranslate"><span class="pre">?key_name</span></code> in the SQL
statement.</p>
<p>Example:</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select * from employees where Salary &gt; ? and Start-date &lt; ?&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;2018-12-31&quot;</span><span class="p">]</span>
<span class="p">);</span>

<span class="cm">/* or */</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select * from employees where Salary &gt; ?salary and Start-date &lt; ?date&quot;</span><span class="p">,</span>
    <span class="p">{</span> <span class="nx">salary</span><span class="o">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="nx">date</span><span class="o">:</span> <span class="s2">&quot;2018-12-31&quot;</span><span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The use of Parameters can make the handling of user input safe from sql injection.
Note that if there is only one parameter, it still must be contained in an
<span class="green">Array</span> or <span class="green">Object</span>.</p>
<dl id="execopts">
<dt>Options:</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> <span class="green">Object</span> may contain any of the following:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">maxRows</span></code> (<span class="green">Number</span>):  maximum number of rows to return (default: 10
for <code class="docutils literal notranslate"><span class="pre">select</span></code> statements; unlimited (<code class="docutils literal notranslate"><span class="pre">-1</span></code>) for others).  See Caveats
below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skipRows</span></code> (<span class="green">Number</span>): the number of rows to skip (default: 0).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">returnType</span></code> (<span class="green">String</span>): Determines the format of the <code class="docutils literal notranslate"><span class="pre">rows</span></code> value
in the return <span class="green">Object</span>.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>default</strong>: if <code class="docutils literal notranslate"><span class="pre">returnType</span></code> is not set, <code class="docutils literal notranslate"><span class="pre">rows</span></code> in
the return value of <code class="docutils literal notranslate"><span class="pre">select</span></code> statements will be an <span class="green">Array</span>
of <span class="green">Objects</span>, as if <code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code> below was set.  For
<code class="docutils literal notranslate"><span class="pre">delete</span></code>, <code class="docutils literal notranslate"><span class="pre">update</span></code> and <code class="docutils literal notranslate"><span class="pre">insert</span></code> statements, <code class="docutils literal notranslate"><span class="pre">rows</span></code> will
be an empty array as if <code class="docutils literal notranslate"><span class="pre">&quot;novars&quot;</span></code> was set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code>: An <span class="green">Array</span> of <span class="green">Objects</span>.  Each
<span class="green">Array</span> member  correspond to each row fetched. Each
<span class="green">Object</span> has its property names (keys) set the names of the
corresponding column and its values set to the field value of the
corresponding row for the named column.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;array&quot;</span></code>: An <span class="green">Array</span> of <span class="green">Arrays</span>. The outer <span class="green">Array</span>
members correspond to each row fetched.  The inner <span class="green">Array</span>
members correspond to the fields returned in each row.  Note that
column names are still available, in order, in <a class="reference internal" href="#returnval"><span class="std std-ref">columns</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;novars&quot;</span></code>: An empty <span class="green">Array</span> is returned.  The sql statement is
still executed.  This is the default for inserts, updates and deletes
where the return value would normally not be used.</p></li>
<li><p><strong>Note</strong>: If the values of a deleted, inserted or updated row are needed,
<code class="docutils literal notranslate"><span class="pre">returnType</span></code> can be set to either <code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;array&quot;</span></code> and
the statement will be executed as normal with <code class="docutils literal notranslate"><span class="pre">rows</span></code> set as if
the row or rows operated upon were <code class="docutils literal notranslate"><span class="pre">select</span></code>ed.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">returnRows</span></code> (<span class="green">Boolean</span>): If set <code class="docutils literal notranslate"><span class="pre">true</span></code>, performs the same
function as <code class="docutils literal notranslate"><span class="pre">{returnType:</span> <span class="pre">&quot;object&quot;}</span></code> above.  If set <code class="docutils literal notranslate"><span class="pre">false</span></code>,
performs the same function at <code class="docutils literal notranslate"><span class="pre">{returnType:</span> <span class="pre">&quot;novars&quot;}</span></code> above.  This
setting overrides the <code class="docutils literal notranslate"><span class="pre">returnType</span></code> setting if both are present.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">includeCounts</span></code> (<span class="green">Boolean</span>): whether to include count
information in the return <span class="green">Object</span>.  Default is <code class="docutils literal notranslate"><span class="pre">false</span></code>.  The
information will be returned as an <span class="green">Object</span> in the
<code class="docutils literal notranslate"><span class="pre">sql.exec()</span></code> return <span class="green">Object</span> as the value of the key
<code class="docutils literal notranslate"><span class="pre">countInfo</span></code> (or as the fourth parameter to a callback <span class="green">Function</span>).  The
<span class="green">Numbers</span> returned will only be useful when performing a
<span class="xref std std-ref">text search</span> on a field
with a fulltext index.  If count information is not available, the
<span class="green">Numbers</span> will be negative.  See <a class="reference internal" href="#countinfo"><span class="std std-ref">countInfo</span></a>
below.  If <code class="docutils literal notranslate"><span class="pre">false</span></code>, <code class="docutils literal notranslate"><span class="pre">countInfo</span></code> will be <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">argument</span></code>: (aka <code class="docutils literal notranslate"><span class="pre">arg</span></code>). A variable of any type to be passed to the
callback below.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>Caveats for Options, maxRows and skipRows:</dt><dd><ul class="simple">
<li><p>SQL <code class="docutils literal notranslate"><span class="pre">select</span></code> statements are by default limited to 10
rows (<code class="docutils literal notranslate"><span class="pre">{maxRows:10}</span></code>) unless <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> above is set.  This default
can be changed by setting the special variable <code class="docutils literal notranslate"><span class="pre">sql.selectMaxRows</span></code>.</p></li>
</ul>
<blockquote>
<div><p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;./mytestdb&quot;</span><span class="p">);</span>

<span class="nx">sql</span><span class="p">.</span><span class="nx">selectMaxRows</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select * from mytable&quot;</span><span class="p">);</span>
<span class="cm">/* expected results: 20 rows, if 20 are available from &quot;mytable&quot; */</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">maxRows</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">-1</span></code> (unlimited) if not set and the
SQL statement is not a <code class="docutils literal notranslate"><span class="pre">select</span></code> statement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxRows</span></code> and <code class="docutils literal notranslate"><span class="pre">skipRows</span></code> may be specified, as a shortcut, as
parameters to the exec function.  Placement of the <span class="green">Numbers</span> in the
<code class="docutils literal notranslate"><span class="pre">exec()</span></code> function is arbitrary, except that the first number given
will be treated as <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> and the second, if present will be
treated as <code class="docutils literal notranslate"><span class="pre">skipRows</span></code>.  Also note that if <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> and/or
<code class="docutils literal notranslate"><span class="pre">skipRows</span></code> is also set in <code class="docutils literal notranslate"><span class="pre">options</span></code> above, the last set value will be
used.</p>
<p>Example:</p>
</li>
</ul>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;./mytestdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">sqlopts</span> <span class="o">=</span> <span class="p">{</span><span class="nx">maxRows</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">returnType</span><span class="o">:</span> <span class="s2">&quot;array&quot;</span><span class="p">};</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;select * from mytable&quot;</span><span class="p">);</span>
<span class="cm">/* expected results: 20 rows, skipping the first 10,</span>
<span class="cm">   if 30 are available from &quot;mytable&quot;                */</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select * from mytable&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">sqlopts</span><span class="p">);</span>
<span class="cm">/* expected results: 5 rows, skipping the first 10,</span>
<span class="cm">   if 15 are available from &quot;mytable&quot;.  The option maxRows</span>
<span class="cm">   is specified last from within &quot;sqlopts&quot;, so it is used       */</span>

<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select * from mytable&quot;</span><span class="p">,</span> <span class="nx">sqlopts</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="cm">/* expected results: 20 rows, skipping the first 10,</span>
<span class="cm">   if 30 are available from &quot;mytable&quot;.  The parameter 20 is</span>
<span class="cm">   specified last, so maxRows is overwritten and 20 is used     */</span>
</pre></div>
</div>
</div></blockquote>
</dd>
<dt>Callback:</dt><dd><p>A <span class="green">Function</span> taking as parameters (<code class="docutils literal notranslate"><span class="pre">result_row</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">columns</span></code>, <code class="docutils literal notranslate"><span class="pre">countInfo</span></code>, <code class="docutils literal notranslate"><span class="pre">user_argument</span></code>).
The callback is executed once for each row retrieved:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result_row</span></code>: (<span class="green">Array</span>/<span class="green">Object</span>): depending on the setting of <code class="docutils literal notranslate"><span class="pre">returnType</span></code>
in <code class="docutils literal notranslate"><span class="pre">Options</span></code> above, a single row is passed to the callback as an
<span class="green">Object</span> or an <span class="green">Array</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>: (<span class="green">Number</span>) The ordinal number of the current search result.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code>: an <span class="green">Array</span> corresponding to the column names or
aliases selected and returned in results.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">countInfo</span></code>: an <span class="green">Object</span> as described below in <a class="reference internal" href="#countinfo">countinfo</a> if the
<code class="docutils literal notranslate"><span class="pre">includeCounts</span></code> option is set <code class="docutils literal notranslate"><span class="pre">true</span></code>.  Otherwise it will be
<code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_argument</span></code>: a variable that is supplied to the callback after
being set in the <a class="reference internal" href="#execopts"><span class="std std-ref">options</span></a> <code class="docutils literal notranslate"><span class="pre">argument</span></code>
option above.  If not set above, <code class="docutils literal notranslate"><span class="pre">undefined</span></code> will be passed as the
fifth argument.</p></li>
<li><p>Note: Regardless of <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> setting , returning <code class="docutils literal notranslate"><span class="pre">false</span></code> from the
<code class="docutils literal notranslate"><span class="pre">callback</span></code> will cancel the retrieval of any remaining rows.
Returning <code class="docutils literal notranslate"><span class="pre">undefined</span></code> or any other value will allow the next row to be
retrieved up to <code class="docutils literal notranslate"><span class="pre">maxRows</span></code> rows.</p></li>
</ul>
<p>Example</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">nrows</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select NAME, REMARK from SYSTABLES&quot;</span><span class="p">,</span> <span class="c1">// statement</span>
    <span class="p">{</span> <span class="nx">returnType</span><span class="o">:</span><span class="s2">&quot;array&quot;</span><span class="p">},</span>                <span class="c1">// options</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">cols</span><span class="p">)</span> <span class="p">{</span>              <span class="c1">// callback</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;%s\n&quot;</span><span class="p">,</span> <span class="nx">cols</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
        <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;%s\n&quot;</span><span class="p">,</span> <span class="nx">row</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;nrows =&quot;</span><span class="p">,</span> <span class="nx">nrows</span><span class="p">);</span>

<span class="cm">/* expected output:</span>
<span class="cm">    NAME REMARK</span>
<span class="cm">    SYSCOLUMNS Catalog of Columns</span>
<span class="cm">    SYSTABLES Catalog of Tables</span>
<span class="cm">    SYSINDEX Catalog of Indices</span>
<span class="cm">    SYSUSERS Texis Users</span>
<span class="cm">    SYSPERMS Texis Permissions</span>
<span class="cm">    SYSTRIG Texis Triggers</span>
<span class="cm">    SYSMETAINDEX Chkind Parameters</span>
<span class="cm">    SYSSTATISTICS Database Statistics</span>
<span class="cm">    nrows = 8</span>
<span class="cm">*/</span>
</pre></div>
</div>
</dd>
</dl>
<dl id="returnval">
<dt>Return Value:</dt><dd><p><span class="green">Number</span>/<span class="green">Object</span>.</p>
<p>With no callback, an <span class="green">Object</span> is returned.  The <span class="green">Object</span> contains
three or four key/value pairs.</p>
<p>Key: <code class="docutils literal notranslate"><span class="pre">rows</span></code>; Value: an <span class="green">Array</span> of <span class="green">Objects</span>.
Each <span class="green">Object</span> corresponds to a row in the database and will
have keys set to the corresponding column names and the values set
to the corresponding field of the retrieved row.  If <code class="docutils literal notranslate"><span class="pre">returnType</span></code>
is set to <code class="docutils literal notranslate"><span class="pre">&quot;array&quot;</span></code>, an <span class="green">Array</span> of <span class="green">Arrays</span>
containing the values (one inner <span class="green">Array</span> per row) will be
returned.</p>
<p>Key: <code class="docutils literal notranslate"><span class="pre">rowCount</span></code>; Value: a <span class="green">Number</span> corresponding to the number of rows
returned.</p>
<p>Key:  <code class="docutils literal notranslate"><span class="pre">columns</span></code>; Value: an <span class="green">Array</span> corresponding to the column names or
aliases selected and returned in rows.</p>
</dd>
</dl>
<blockquote id="countinfo">
<div><p>Key: <code class="docutils literal notranslate"><span class="pre">countInfo</span></code>; Value: if option <code class="docutils literal notranslate"><span class="pre">includeCounts</span></code> is set
<code class="docutils literal notranslate"><span class="pre">true</span></code>, information regarding the number of total possible matches
is set.  Otherwise <code class="docutils literal notranslate"><span class="pre">countInfo</span></code> is undefined.  When performing a
<span class="xref std std-ref">text search</span> the
<code class="docutils literal notranslate"><span class="pre">countInfo</span></code> <span class="green">Object</span> contains the following:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">indexCount</span></code> (<span class="green">Number</span>): a single value estimating the number
of matching rows.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowsMatchedMin</span></code> (<span class="green">Number</span>): Minimum number of rows matched <strong>before</strong>
any <span class="xref std std-ref">group by</span>,
<a class="reference internal" href="sql-set.html#likeprows"><span class="std std-ref">likepRows</span></a>,
<span class="xref std std-ref">aggregates</span> or
<a class="reference internal" href="sql-set.html#multivaluetomultirow"><span class="std std-ref">multiValueToMultiRow</span></a> are applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowsMatchedMax</span></code> (<span class="green">Number</span>): Maximum number of rows matched <strong>before</strong>
any <span class="xref std std-ref">group by</span>,
<a class="reference internal" href="sql-set.html#likeprows"><span class="std std-ref">likepRows</span></a>,
<span class="xref std std-ref">aggregates</span> or
<a class="reference internal" href="sql-set.html#multivaluetomultirow"><span class="std std-ref">multiValueToMultiRow</span></a> are applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowsReturnedMin</span></code> (<span class="green">Number</span>): Minimum number of rows matched <strong>after</strong>
any <span class="xref std std-ref">group by</span>,
<a class="reference internal" href="sql-set.html#likeprows"><span class="std std-ref">likepRows</span></a>,
<span class="xref std std-ref">aggregates</span> or
<a class="reference internal" href="sql-set.html#multivaluetomultirow"><span class="std std-ref">multiValueToMultiRow</span></a> are applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowsReturnedMax</span></code> (<span class="green">Number</span>): Maximum number of rows matched <strong>after</strong>
any <span class="xref std std-ref">group by</span>,
<a class="reference internal" href="sql-set.html#likeprows"><span class="std std-ref">likepRows</span></a>,
<span class="xref std std-ref">aggregates</span> or
<a class="reference internal" href="sql-set.html#multivaluetomultirow"><span class="std std-ref">multiValueToMultiRow</span></a> are applied.</p></li>
</ul>
</div></blockquote>
<p>If a callback <span class="green">Function</span> is specified, a <span class="green">Number</span> (the
number of rows retrieved) is returned.  The callback is given the above
values as arguments in the following order: <code class="docutils literal notranslate"><span class="pre">cbfunc(result_row,</span> <span class="pre">index,</span>
<span class="pre">columns,</span> <span class="pre">countInfo)</span></code>.</p>
<p>Note also that if <code class="docutils literal notranslate"><span class="pre">includeCounts</span></code> is set <code class="docutils literal notranslate"><span class="pre">true</span></code> and the sql query is
not a text search, the values of the properties of <code class="docutils literal notranslate"><span class="pre">countInfo</span></code> will be
negative.</p>
</div></blockquote>
<dl>
<dt>Error Messages:</dt><dd><p>Errors may or may not throw a JavaScript exception depending on the
error.  If the syntax is correct but the statement cannot be executed, no
exception is thrown and <code class="docutils literal notranslate"><span class="pre">sql.errMsg</span></code> will contain the error message.
Otherwise an exception is thrown, <code class="docutils literal notranslate"><span class="pre">sql.errMsg</span></code> is set and the error may
be caught with <code class="docutils literal notranslate"><span class="pre">catch(error)</span></code>.</p>
<p>Error Message Example:</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>

<span class="cm">/* create database if it does not exist */</span>
<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;./mytestdb&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

<span class="cm">/* create a table */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;create table testtb (text varchar(16), number double)&quot;</span><span class="p">);</span>

<span class="cm">/* create a unique index on number */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;create unique index testtb_number_ux on testtb(number)&quot;</span><span class="p">);</span>

<span class="cm">/* insert a row */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into testtb values (&#39;A B C&#39;, 123)&quot;</span><span class="p">);</span>

<span class="cm">/* attempt to insert a duplicate */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into testtb values (&#39;D E F&#39;, 123)&quot;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sql</span><span class="p">.</span><span class="nx">errMsg</span><span class="p">);</span>
<span class="cm">/* output =</span>
<span class="cm">   &quot;178 Trying to insert duplicate value (123) in index</span>
<span class="cm">   ./mytestdb/testtb_number_ux.btr&quot;</span>
<span class="cm">*/</span>

<span class="k">try</span> <span class="p">{</span>
     <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into testtb values (&#39;D E F&#39;, 456, 789)&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/* output =</span>
<span class="cm">    &quot;Error: sql prep error: 100 More Values Than Fields in the function: Insert</span>
<span class="cm">     000 SQLPrepare() failed with -1: An error occurred in the function: texis_prepare&quot;</span>
<span class="cm">   sql.errMsg is similar.</span>
<span class="cm">*/</span>
</pre></div>
</div>
<dl class="simple" id="exec-full-example">
<dt>Full Example:</dt><dd><p>Below is a full example of <code class="docutils literal notranslate"><span class="pre">exec()</span></code> functionality:</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>

<span class="cm">/* create database if it does not exist */</span>
<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;./mytestdb&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

<span class="cm">/* check if table exists */</span>
<span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select * from SYSTABLES where NAME=&#39;employees&#39;&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;returnType&quot;</span><span class="o">:</span><span class="s2">&quot;novars&quot;</span><span class="p">}</span> <span class="cm">/* we only need the count */</span>
<span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">rowCount</span><span class="p">)</span> <span class="cm">/* 1 if the table exists */</span>
<span class="p">{</span>
    <span class="cm">/* drop table from previous test run of this script */</span>
    <span class="nx">res</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;drop table employees&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* (re)create the table */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
        <span class="s2">&quot;create table employees (Classification varchar(8), &quot;</span> <span class="o">+</span>
        <span class="s2">&quot;Name varchar(16), Age int, Salary int, Title varchar(16), &quot;</span> <span class="o">+</span>
        <span class="s2">&quot;Start_date date, Bio varchar(128) )&quot;</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;returnType&quot;</span><span class="o">:</span><span class="s2">&quot;novars&quot;</span><span class="p">}</span>
<span class="p">);</span>

<span class="cm">/* populate variables for insertion */</span>
<span class="kd">var</span> <span class="nx">emp1</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cl</span><span class="o">:</span>     <span class="s2">&quot;principal&quot;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span>   <span class="s2">&quot;Debbie Dreamer&quot;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span>    <span class="mi">63</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span>  <span class="s2">&quot;Chief Executive Officer&quot;</span><span class="p">,</span>
  <span class="nx">start</span><span class="o">:</span>  <span class="s1">&#39;1999-12-31&#39;</span><span class="p">,</span>
  <span class="nx">salary</span><span class="o">:</span> <span class="mi">250000</span><span class="p">,</span>
  <span class="nx">bio</span><span class="o">:</span>    <span class="s2">&quot;Born and raised in Manhattan, New York. U.C. Berkeley graduate. &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Loves to skydive. Built Company from scratch. Still uses word-perfect.&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">emp2</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cl</span><span class="o">:</span>     <span class="s2">&quot;principal&quot;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span>   <span class="s2">&quot;Rusty Grump&quot;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span>    <span class="mi">58</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span>  <span class="s2">&quot;Chief Financial Officer&quot;</span><span class="p">,</span>
  <span class="nx">start</span><span class="o">:</span>  <span class="s1">&#39;1999-12-31&#39;</span><span class="p">,</span> <span class="c1">// Strings are converted to local time</span>
  <span class="nx">salary</span><span class="o">:</span> <span class="mi">250000</span><span class="p">,</span>
  <span class="nx">bio</span><span class="o">:</span>    <span class="s2">&quot;Born in Switzerland, raised in South Dakota. Columbia graduate. &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Financed operation with inheritance. Has no sense of humor.&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">emp3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cl</span><span class="o">:</span>     <span class="s2">&quot;salary&quot;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span>   <span class="s2">&quot;Georgia Geek&quot;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span>    <span class="mi">44</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span>  <span class="s2">&quot;Lead Programmer&quot;</span><span class="p">,</span>
  <span class="nx">start</span><span class="o">:</span>  <span class="s1">&#39;2001-3-15&#39;</span><span class="p">,</span>
  <span class="nx">salary</span><span class="o">:</span> <span class="mi">100000</span><span class="p">,</span>
  <span class="nx">bio</span><span class="o">:</span>    <span class="s2">&quot;Stanford graduate. Enjoys pizza and beer. Proficient in Perl, COBOL,&quot;</span> <span class="o">+</span>
          <span class="s2">&quot;FORTRAN and IBM System/360&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">emp4</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cl</span><span class="o">:</span>     <span class="s2">&quot;salary&quot;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span>   <span class="s2">&quot;Sydney Slacker&quot;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span>    <span class="mi">44</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span>  <span class="s2">&quot;Programmer&quot;</span><span class="p">,</span>
  <span class="nx">start</span><span class="o">:</span>  <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2002-5-12T00:00:00.0-0800&#39;</span><span class="p">),</span> <span class="c1">// Dates are UTC unless offset is given.</span>
  <span class="nx">salary</span><span class="o">:</span> <span class="mi">100000</span><span class="p">,</span>
  <span class="nx">bio</span><span class="o">:</span>    <span class="s2">&quot;DeVry University graduate. Enjoys a good nap. Proficient in Python, &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Perl and JavaScript&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">emp5</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cl</span><span class="o">:</span>     <span class="s2">&quot;hourly&quot;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span>   <span class="s2">&quot;Pat Particular&quot;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span>    <span class="mi">32</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span>  <span class="s2">&quot;Systems Administrator&quot;</span><span class="p">,</span>
  <span class="nx">start</span><span class="o">:</span>  <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2003-7-14&#39;</span><span class="p">),</span>
  <span class="nx">salary</span><span class="o">:</span> <span class="mi">80000</span><span class="p">,</span>
  <span class="nx">bio</span><span class="o">:</span>    <span class="s2">&quot;Lincoln High School graduate. Self taught Linux and windows administration skills. Proficient in &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Bash and GNU utilities. Capable of crashing or resurrecting machines with a single ping.&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">emp6</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cl</span><span class="o">:</span>     <span class="s2">&quot;intern&quot;</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span>   <span class="s2">&quot;Billie Barista&quot;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span>    <span class="mi">22</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span>  <span class="s2">&quot;Intern&quot;</span><span class="p">,</span>
  <span class="nx">start</span><span class="o">:</span>  <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2020-3-18&#39;</span><span class="p">),</span>
  <span class="nx">salary</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nx">bio</span><span class="o">:</span>    <span class="s2">&quot;Harvard graduate, full ride scholarship, top of class.  Proficient in C, C++, &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;Rust, Haskell, Node, Python. Into skydiving. Makes a mean latte.&quot;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">employees</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">emp1</span><span class="p">,</span> <span class="nx">emp2</span><span class="p">,</span> <span class="nx">emp3</span><span class="p">,</span> <span class="nx">emp4</span><span class="p">,</span> <span class="nx">emp5</span><span class="p">,</span> <span class="nx">emp6</span> <span class="p">];</span>

<span class="cm">/* insert rows */</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">employees</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
        <span class="s2">&quot;insert into employees values(?cl,?name,?age,?salary,?title,?start,?bio)&quot;</span><span class="p">,</span>
        <span class="nx">employees</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* create text index */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;create fulltext index employees_Bio_text on employees(Bio)&quot;</span><span class="p">);</span>

<span class="cm">/* perform some queries */</span>
<span class="nx">res</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select Name, Age from employees&quot;</span><span class="p">);</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">printf</span><span class="p">(</span><span class="s1">&#39;%3J\n&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
<span class="cm">/* expected output:</span>
<span class="cm">   {</span>
<span class="cm">       &quot;columns&quot;: [</span>
<span class="cm">           &quot;Name&quot;,</span>
<span class="cm">           &quot;Age&quot;</span>
<span class="cm">       ],</span>
<span class="cm">       &quot;rows&quot;: [</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Debbie Dreamer&quot;,</span>
<span class="cm">               &quot;Age&quot;: 63</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Rusty Grump&quot;,</span>
<span class="cm">               &quot;Age&quot;: 58</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Georgia Geek&quot;,</span>
<span class="cm">               &quot;Age&quot;: 44</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Sydney Slacker&quot;,</span>
<span class="cm">               &quot;Age&quot;: 44</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Pat Particular&quot;,</span>
<span class="cm">               &quot;Age&quot;: 32</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Billie Barista&quot;,</span>
<span class="cm">               &quot;Age&quot;: 22</span>
<span class="cm">           }</span>
<span class="cm">       ],</span>
<span class="cm">       &quot;rowCount&quot;: 6</span>
<span class="cm">   }</span>
<span class="cm">*/</span>

<span class="nx">res</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select Name, Age from employees&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="nx">returnType</span><span class="o">:</span><span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="nx">maxRows</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="nx">includeCounts</span><span class="o">:</span><span class="kc">true</span><span class="p">}</span>
<span class="p">);</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">printf</span><span class="p">(</span><span class="s1">&#39;%3J\n&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
<span class="cm">/* expected output:</span>
<span class="cm">   {</span>
<span class="cm">       &quot;columns&quot;: [</span>
<span class="cm">           &quot;Name&quot;,</span>
<span class="cm">           &quot;Age&quot;</span>
<span class="cm">       ],</span>
<span class="cm">       &quot;rows&quot;: [</span>
<span class="cm">           [</span>
<span class="cm">               &quot;Debbie Dreamer&quot;,</span>
<span class="cm">               63</span>
<span class="cm">           ],</span>
<span class="cm">           [</span>
<span class="cm">               &quot;Rusty Grump&quot;,</span>
<span class="cm">               58</span>
<span class="cm">           ]</span>
<span class="cm">       ],</span>
<span class="cm">       &quot;countInfo&quot;: {</span>
<span class="cm">           &quot;indexCount&quot;: -1,</span>
<span class="cm">           &quot;rowsMatchedMin&quot;: -1,</span>
<span class="cm">           &quot;rowsMatchedMax&quot;: -2,</span>
<span class="cm">           &quot;rowsReturnedMin&quot;: -1,</span>
<span class="cm">           &quot;rowsReturnedMax&quot;: -2</span>
<span class="cm">       },</span>
<span class="cm">       &quot;rowCount&quot;: 2</span>
<span class="cm">   }</span>
<span class="cm">             Note that countInfo values are all negative since no</span>
<span class="cm">             text search was performed.</span>
<span class="cm">*/</span>
<span class="nx">res</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select Name from employees where Bio likep &#39;proficient&#39; and Salary &gt; 50000&quot;</span><span class="p">,</span>
     <span class="p">{</span><span class="nx">includeCounts</span><span class="o">:</span><span class="kc">true</span><span class="p">}</span>
<span class="p">);</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">printf</span><span class="p">(</span><span class="s1">&#39;%3J\n&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>

<span class="cm">/* expected output:</span>
<span class="cm">   {</span>
<span class="cm">       &quot;columns&quot;: [</span>
<span class="cm">           &quot;Name&quot;</span>
<span class="cm">       ],</span>
<span class="cm">       &quot;rows&quot;: [</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Georgia Geek&quot;</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Sydney Slacker&quot;</span>
<span class="cm">           },</span>
<span class="cm">           {</span>
<span class="cm">               &quot;Name&quot;: &quot;Pat Particular&quot;</span>
<span class="cm">           }</span>
<span class="cm">       ],</span>
<span class="cm">       &quot;countInfo&quot;: {</span>
<span class="cm">           &quot;indexCount&quot;: 4,</span>
<span class="cm">           &quot;rowsMatchedMin&quot;: 0,</span>
<span class="cm">           &quot;rowsMatchedMax&quot;: 4,</span>
<span class="cm">           &quot;rowsReturnedMin&quot;: 0,</span>
<span class="cm">           &quot;rowsReturnedMax&quot;: 4</span>
<span class="cm">       },</span>
<span class="cm">       &quot;rowCount&quot;: 3</span>
<span class="cm">   }</span>
<span class="cm">   Note that indexCount is the count before &quot;Salary &gt; 50000&quot; filter</span>
<span class="cm">*/</span>

<span class="cm">/* skydive =&gt; skydiving */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
    <span class="nx">minwordlen</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="nx">suffixproc</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="nx">nrows</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span>
    <span class="s2">&quot;select Name, Salary from employees where Bio likep &#39;skydive&#39; order by Salary desc&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="nx">returnType</span><span class="o">:</span><span class="s2">&quot;array&quot;</span><span class="p">,</span> <span class="nx">includeCounts</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">coln</span><span class="p">,</span> <span class="nx">cinfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
               <span class="s2">&quot;Total approximate number of matches in db: &quot;</span> <span class="o">+</span>
               <span class="nx">cinfo</span><span class="p">.</span><span class="nx">indexCount</span>
            <span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nx">coln</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">row</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Total: &quot;</span> <span class="o">+</span> <span class="nx">nrows</span><span class="p">);</span> <span class="c1">// 2</span>

<span class="cm">/* expected output:</span>
<span class="cm">   Total approximate number of matches in db: 2</span>
<span class="cm">   - [&quot;Name&quot;,&quot;Salary&quot;]</span>
<span class="cm">   1 [&quot;Debbie Dreamer&quot;,250000]</span>
<span class="cm">   2 [&quot;Billie Barista&quot;,0]</span>
<span class="cm">   Total: 2</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="one">
<h2>one()<a class="headerlink" href="#one" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">one</span></code> <span class="green">Function</span> is a shortcut for executing sql
where only one row is desired and the extra information normally
returned from <a class="reference internal" href="#exec">exec()</a> is not needed.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="nx">statement</span> <span class="p">[,</span> <span class="nx">sql_parameters</span><span class="p">]);</span>
</pre></div>
</div>
<p>This allows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select email from Users where user=?user&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">maxRows</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="nx">user</span><span class="o">:</span><span class="nx">user_name</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">row</span><span class="o">=</span><span class="nx">res</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="cm">/* row = { email : &quot;user@example.com&quot; } */</span>
</pre></div>
</div>
<p>to be more easily written as:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">&quot;select email from Users where user=?user&quot;</span><span class="p">,{</span><span class="nx">user</span><span class="o">:</span><span class="nx">user_name</span><span class="p">});</span>
<span class="cm">/* row = { email : &quot;user@example.com&quot; } */</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">one</span></code> returns <code class="docutils literal notranslate"><span class="pre">undefined</span></code> if a matching row is not found. It thus
can be used in an <code class="docutils literal notranslate"><span class="pre">if</span></code> statement to test the existence of a row:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">&quot;select email from Users where user=?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">user_name</span><span class="p">])</span> <span class="p">)</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;user &quot;</span> <span class="o">+</span> <span class="nx">user_name</span> <span class="o">+</span> <span class="s2">&quot; does not exist in the database.&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="set">
<h2>set()<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">set</span></code> <span class="green">Function</span> sets Texis server properties.  For a full listing, see
<a class="reference internal" href="sql-set.html#server-properties"><span class="std std-ref">Server Properties</span></a>.  Arguments are given as keys with
corresponding values set to a <span class="green">String</span>, <span class="green">Number</span>, <span class="green">Array</span> or
<span class="green">Boolean</span> as appropriate.  Note that <span class="green">Booleans</span>
<code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code> are equivalent to setting <code class="docutils literal notranslate"><span class="pre">1</span></code>/<code class="docutils literal notranslate"><span class="pre">0</span></code>
as described in <a class="reference internal" href="sql-set.html#server-properties"><span class="std std-ref">Server Properties</span></a>.</p>
<p>Normally there is no return value (<code class="docutils literal notranslate"><span class="pre">undefined</span></code>).</p>
<p>However if <a class="reference internal" href="sql-set.html#lstexp"><span class="std std-ref">lstExp</span></a>,
<a class="reference internal" href="sql-set.html#lstindextmp"><span class="std std-ref">lstIndexTmp</span></a>, <a class="reference internal" href="sql-set.html#listprefix"><span class="std std-ref">listPrefix</span></a>,
<a class="reference internal" href="sql-set.html#listsuffix"><span class="std std-ref">listSuffix</span></a>, <a class="reference internal" href="sql-set.html#listsuffixequivs"><span class="std std-ref">listSuffixEquivs</span></a>,  and/or
<a class="reference internal" href="sql-set.html#listnoise"><span class="std std-ref">listNoise</span></a> is set <code class="docutils literal notranslate"><span class="pre">true</span></code>, an <span class="green">Object</span> is
returned with corresponding keys <code class="docutils literal notranslate"><span class="pre">expressionsList</span></code>, <code class="docutils literal notranslate"><span class="pre">indexTempList</span></code>,
<code class="docutils literal notranslate"><span class="pre">prefixList</span></code>, <code class="docutils literal notranslate"><span class="pre">suffixList</span></code>, <code class="docutils literal notranslate"><span class="pre">suffixEquivsList</span></code> and/or
<code class="docutils literal notranslate"><span class="pre">noiseList</span></code> respectively.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/* rank higher docs with words appearing at beginning of document *</span>
<span class="cm"> *  and only return matches with all the given query terms.       */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
        <span class="nx">likepleadbias</span><span class="o">:</span> <span class="mi">750</span><span class="p">,</span>
        <span class="nx">likepallmatch</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="cm">/* an example with a return value */</span>
<span class="kd">var</span> <span class="nx">lists</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
        <span class="nx">addExp</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;[\\alnum\\x80-\\xff]+&quot;</span><span class="p">,</span><span class="s2">&quot;[\\alnum\\x80-\\xff,&#39;]+&quot;</span><span class="p">],</span>
        <span class="nx">addIndexTmp</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;/tmp&quot;</span><span class="p">,</span><span class="s2">&quot;/var/tmp&quot;</span><span class="p">],</span>
        <span class="nx">listNoise</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">listIndextemp</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">listExpressions</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
<span class="cm">/*</span>
<span class="cm">   lists =</span>
<span class="cm">   {</span>
<span class="cm">        noiseList:        [&quot;a&quot;,&quot;about&quot;,...,&quot;you&quot;,&quot;your&quot;],</span>
<span class="cm">        indexTempList:    [&quot;/tmp&quot;,&quot;/var/tmp&quot;],</span>
<span class="cm">        expressionsList:  [&quot;\\alnum{2,99}&quot;, &quot;[\\alnum\\x80-\xff]+&quot;, &quot;[\\alnum\\x80-\xff,&#39;]+&quot;]</span>
<span class="cm">   }</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="reset">
<h2>reset()<a class="headerlink" href="#reset" title="Permalink to this headline">¶</a></h2>
<p>Reset all settings set with <a class="reference internal" href="#set">set()</a> above to their original values.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;/path/to/my/db&quot;</span><span class="p">);</span>

<span class="p">...</span>

<span class="nx">sql</span><span class="p">.</span><span class="nx">set</span><span class="p">({...});</span>  <span class="c1">//settings changed in script</span>

<span class="p">...</span>

<span class="nx">sql</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span> <span class="c1">//reset all to default</span>
</pre></div>
</div>
</div>
<div class="section" id="importcsvfile">
<h2>importCsvFile()<a class="headerlink" href="#importcsvfile" title="Permalink to this headline">¶</a></h2>
<p>The importCsvFile <span class="green">Function</span> is similar to the
<a class="reference internal" href="rampart-main.html#csvfile"><span class="std std-ref">rampart.import.csvFile</span></a> <span class="green">Function</span>
except that it imports csv data from a file directly
into a SQL table.  It takes a <span class="green">String</span> containing a file name, an
<span class="green">Object</span> of options, optionally an <span class="green">Array</span> specifying the
order of columns and optionally a callback <span class="green">Function</span>.  The
parameters may be specified in any order.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">importCsvFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">options</span> <span class="p">[,</span> <span class="nx">ordering</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 22%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>filename</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>The csv file to import</p></td>
</tr>
<tr class="row-odd"><td><p>options</p></td>
<td><p><span class="green">Object</span></p></td>
<td><p>Options <em>described below</em></p></td>
</tr>
<tr class="row-even"><td><p>ordering</p></td>
<td><p><span class="green">Array</span></p></td>
<td><p>Order of csv columns to table columns</p></td>
</tr>
<tr class="row-odd"><td><p>callback</p></td>
<td><p><span class="green">Function</span></p></td>
<td><p>a function to monitor the progress of the import.</p></td>
</tr>
</tbody>
</table>
<dl>
<dt>filename:</dt><dd><p>The name of the csv file to be opened.</p>
</dd>
<dt>options:</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">options</span></code> <span class="green">Object</span> may contain any of the following.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tableName</span></code> - <span class="green">String</span> (no default; <strong>required</strong>) -
The name of the table into which the csv data will be inserted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callbackStep</span></code> - <span class="green">Number</span> - Where number is <code class="docutils literal notranslate"><span class="pre">n</span></code>, execute
callback, if provided, for every nth row imported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stripLeadingWhite</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>):
Remove leading whitespace characters from cells.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stripTrailingWhite</span></code> - <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): Remove
trailing whitespace characters from cells.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doubleQuoteEscape</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>):
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> within strings is used to embed <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> characters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">singleQuoteNest</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): Strings
may be bounded by <code class="docutils literal notranslate"><span class="pre">'</span></code> pairs and <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> characters within are ignored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">backslashEscape</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>):
Characters preceded by ‘\’ are translated and escaped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allEscapes</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): All <code class="docutils literal notranslate"><span class="pre">\</span></code>
escape sequences known by the ‘C’ compiler are translated, if
<code class="docutils literal notranslate"><span class="pre">false</span></code> only backslash, single quote, and double quote are escaped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">europeanDecimal</span></code>  -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>):
Numbers like <code class="docutils literal notranslate"><span class="pre">123</span> <span class="pre">456,78</span></code> will be parsed as <code class="docutils literal notranslate"><span class="pre">123456.78</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tryParsingStrings</span></code> -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>): Look
inside quoted strings for dates and numbers to parse, if <code class="docutils literal notranslate"><span class="pre">false</span></code>
anything quoted is a string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delimiter</span></code> - <span class="green">String</span> (default <code class="docutils literal notranslate"><span class="pre">&quot;,&quot;</span></code>):  Use the first
character of string as a column delimiter (e.g <code class="docutils literal notranslate"><span class="pre">\t</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeFormat</span></code> -  <span class="green">String</span> (default <code class="docutils literal notranslate"><span class="pre">&quot;%Y-%m-%d</span> <span class="pre">%H:%M:%S&quot;</span></code>):
Set the format for parsing a date/time. See manpage for
<a class="reference external" href="https://man7.org/linux/man-pages/man3/strptime.3p.html">strptime()</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hasHeaderRow</span></code> - -  <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">false</span></code>): Whether
to treat the first row as column names. If <code class="docutils literal notranslate"><span class="pre">false</span></code>, the first row
is imported as csv data and the column names will
default to <code class="docutils literal notranslate"><span class="pre">col_1,</span> <span class="pre">col_2,</span> <span class="pre">...,</span> <span class="pre">col_n</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normalize</span></code> - <span class="green">Boolean</span> (default <code class="docutils literal notranslate"><span class="pre">true</span></code>): If <code class="docutils literal notranslate"><span class="pre">true</span></code>,
examine each column in the parsed CSV object to find the majority
type of that column.  It then casts all the members of that column
to the majority type, or set it to <code class="docutils literal notranslate"><span class="pre">null</span></code> if it is
unable to do so. If <code class="docutils literal notranslate"><span class="pre">false</span></code>, each cell is individually normalized.
NOTE: unlike the
<a class="reference internal" href="rampart-main.html#csvfile"><span class="std std-ref">rampart.import.csvFile</span></a> <span class="green">Function</span>,
the default is <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">progressFunc</span></code> - <span class="green">Function</span>: A function to monitor the progress
of the passes over the csv data.  It takes as arguments <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">(stage,</span> <span class="pre">i)</span></code>
The variable <code class="docutils literal notranslate"><span class="pre">stage</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code> for the initial counting of rows, <code class="docutils literal notranslate"><span class="pre">1</span></code> for the parsing
of the cells in each row and <code class="docutils literal notranslate"><span class="pre">2+</span></code> optionally if <code class="docutils literal notranslate"><span class="pre">normalize</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> for the
two stages of the analysis of each column in the csv (e.g. <code class="docutils literal notranslate"><span class="pre">2</span></code> for column 0 first pass,
<code class="docutils literal notranslate"><span class="pre">3</span></code> for column 0 second pass, etc.).  The variable <code class="docutils literal notranslate"><span class="pre">i</span></code> is the row number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">progressStep</span></code> <span class="green">Number</span>: Where number is <code class="docutils literal notranslate"><span class="pre">n</span></code>, execute
<code class="docutils literal notranslate"><span class="pre">progresFunc</span></code> callback, if provided, for every nth row in each stage.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>ordering:</dt><dd><p>An <span class="green">Array</span> of <span class="green">Strings</span> or <span class="green">Numbers</span> corresponding
to the csv columns, listed in the order of insertion into the table.
Example: If <code class="docutils literal notranslate"><span class="pre">[0,3,4]</span></code> is specified, the first, fourth and fifth column
in the csv will be inserted into the first, second and third column of
SQL table.  <code class="docutils literal notranslate"><span class="pre">-1</span></code> can be used to insert a <code class="docutils literal notranslate"><span class="pre">0</span></code> or blank string (<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>)
in that position in each row of the SQL table.  Also a <span class="green">String</span>
corresponding to the csv column name may be used in place of a number.</p>
</dd>
<dt>callback:</dt><dd><p>A <span class="green">Function</span> taking as its sole parameter (<code class="docutils literal notranslate"><span class="pre">index</span></code>), the
current <code class="docutils literal notranslate"><span class="pre">0</span></code> based row being imported.
The callback is executed once for each row in the csv file unless the
option <code class="docutils literal notranslate"><span class="pre">callbackStep</span></code> is specified.</p>
</dd>
<dt>Return Value:</dt><dd><p><span class="green">Number</span>. The return value is set to number of rows in the
csv file.</p>
</dd>
</dl>
<p>Note: In the callback, the loop can cancell the import at any point by returning
<code class="docutils literal notranslate"><span class="pre">false</span></code>.  The return value (number of rows) will still be the total number
of rows in the csv file.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ret</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">importCsvFile</span><span class="p">(</span>
   <span class="cm">/* csv file to import */</span>
   <span class="s2">&quot;sample.csv&quot;</span><span class="p">,</span>

   <span class="cm">/* options */</span>
   <span class="p">{</span>
      <span class="nx">tableName</span><span class="o">:</span><span class="s2">&quot;testtb&quot;</span><span class="p">,</span> <span class="cm">/* table in which to insert csv data */</span>
      <span class="nx">callbackStep</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="cm">/* do callback every 1000th row      */</span>
      <span class="nx">hasHeaderRow</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="cm">/* first row of csv are column names */</span>
   <span class="p">},</span>

   <span class="cm">/* reorder csv columns switching second and third */</span>
   <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>

   <span class="cm">/* print progress */</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;total=&quot;</span><span class="o">+</span><span class="nx">ret</span><span class="p">);</span>

<span class="cm">/* expected output for 10000 row csv:</span>
<span class="cm">1000</span>
<span class="cm">2000</span>
<span class="cm">...</span>
<span class="cm">9000</span>
<span class="cm">total=10000</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="importcsv">
<h2>importCsv()<a class="headerlink" href="#importcsv" title="Permalink to this headline">¶</a></h2>
<p>Same as <a class="reference internal" href="#importcsvfile">importCsvFile()</a> except instead of a file name, a <span class="green">String</span> or
<span class="green">Buffer</span> containing the csv data is passed as a parameter.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sql</span><span class="o">=</span> <span class="k">new</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s2">&quot;/path/mytestdb&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">csv</span> <span class="o">=</span>
<span class="s2">&quot;Dept,       item1 Quantity, item1 Description, item1 Value, item2 Quantity, item2 Description, item2 Value\n&quot;</span> <span class="o">+</span>
<span class="s2">&quot;accounting, 5,              Macbook Pro,       1200.0,      300,            Pencils,           0.1\n&quot;</span> <span class="o">+</span>
<span class="s2">&quot;marketing,  20,             Dell XPS 15,       1150.0,      350,            Pens,              0.5\n&quot;</span> <span class="o">+</span>
<span class="s2">&quot;logistics,  30,             iPad Air,          300.0,       100,            Duktape,           1.5\n&quot;</span>

<span class="cm">/* note this table has more rows than the csv*/</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;create table company_assets(Department varchar(16), &quot;</span><span class="o">+</span>
           <span class="s2">&quot;Num_item1 int, Desc_item1 varchar(16), Val_item1 float, Tot_Val_item1 float, &quot;</span> <span class="o">+</span>
           <span class="s2">&quot;Num_item2 int, Desc_item2 varchar(16), Val_item2 float, Tot_Val_item2 float, &quot;</span> <span class="o">+</span>
           <span class="s2">&quot;Tot_Val_items float);&quot;</span><span class="p">);</span>

<span class="cm">/* import the csv data */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">importCsv</span><span class="p">(</span>
   <span class="nx">csv</span><span class="p">,</span>
   <span class="p">{</span>
       <span class="nx">tableName</span><span class="o">:</span> <span class="s2">&quot;company_assets&quot;</span><span class="p">,</span>
       <span class="nx">hasHeaderRow</span><span class="o">:</span> <span class="kc">true</span>
   <span class="p">},</span>
   <span class="cm">/*</span>
<span class="cm">      order of insertion. Can be column name or column number</span>
<span class="cm">      &quot;&quot; or -1 means insert a null value (0, 0.0 or &quot;&quot;)</span>
<span class="cm">   */</span>
   <span class="p">[</span>
      <span class="s2">&quot;Dept&quot;</span><span class="p">,</span>
      <span class="s2">&quot;item1 Quantity&quot;</span><span class="p">,</span> <span class="s2">&quot;item1 Description&quot;</span><span class="p">,</span> <span class="s2">&quot;item1 Value&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;item2 Quantity&quot;</span><span class="p">,</span> <span class="s2">&quot;item2 Description&quot;</span><span class="p">,</span> <span class="s2">&quot;item2 Value&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
       <span class="o">-</span><span class="mi">1</span>
   <span class="p">]</span>
<span class="p">);</span>

<span class="cm">/* update rows that defaulted to 0*/</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;update company_assets set Tot_Val_item1 = ( Num_item1 * Val_item1 )&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;update company_assets set Tot_Val_item2 = ( Num_item2 * Val_item2 )&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;update company_assets set Tot_Val_items = ( Tot_Val_item1 + Tot_Val_item2 )&quot;</span><span class="p">);</span>

<span class="cm">/* print the rows */</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select * from company_assets&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">returnType</span><span class="o">:</span><span class="s1">&#39;array&#39;</span><span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">cols</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="nx">cols</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">row</span><span class="p">);</span>
<span class="p">});</span>

<span class="cm">/* output:</span>
<span class="cm">- [&quot;Department&quot;,&quot;Num_item1&quot;,&quot;Desc_item1&quot;,&quot;Val_item1&quot;,&quot;Tot_Val_item1&quot;,&quot;Num_item2&quot;,&quot;Desc_item2&quot;,&quot;Val_item2&quot;,&quot;Tot_Val_item2&quot;,&quot;Tot_Val_items&quot;]</span>
<span class="cm">0 [&quot;accounting&quot;,5,&quot;Macbook Pro&quot;,1200,6000,300,&quot;Pencils&quot;,0.10000000149011612,30,6030]</span>
<span class="cm">1 [&quot;marketing&quot;,20,&quot;Dell XPS 15&quot;,1150,23000,350,&quot;Pens&quot;,0.5,175,23175]</span>
<span class="cm">2 [&quot;logistics&quot;,30,&quot;iPad Air&quot;,300,9000,100,&quot;Duktape&quot;,1.5,150,9150]</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="close">
<h2>close()<a class="headerlink" href="#close" title="Permalink to this headline">¶</a></h2>
<p>In general it is not necessary to use <code class="docutils literal notranslate"><span class="pre">close()</span></code> as the “connection” to the
database is not over a socket.  However, if resources to a database are no
longer needed, <code class="docutils literal notranslate"><span class="pre">close()</span></code> will clean up some of those resources.  Note that
even after calling <code class="docutils literal notranslate"><span class="pre">sql.close()</span></code>, using the <code class="docutils literal notranslate"><span class="pre">sql.*</span></code> <span class="green">Functions</span>
will re-open handles to the database and continue to operate as expected and
in the same manner as when the “connection” was first opened.</p>
</div>
</div>
<div class="section" id="string-functions">
<h1>String Functions<a class="headerlink" href="#string-functions" title="Permalink to this headline">¶</a></h1>
<p>As Texis is adept at handling text information, it includes several
text handling <span class="green">Functions</span> which Rampart exposes for use in JavaScript.</p>
<div class="section" id="stringformat">
<h2>stringFormat()<a class="headerlink" href="#stringformat" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">stringFormat()</span></code> <span class="green">Function</span> is identical to the
<a class="reference internal" href="sql-server-funcs.html#server-functions"><span class="std std-ref">server function</span></a>
<a class="reference internal" href="sql-server-funcs.html#stringformat"><span class="std std-ref">stringformat</span></a>, except that it is not limited to five
arguments.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="nx">format</span> <span class="p">[,</span><span class="nx">args</span><span class="p">,</span> <span class="p">...]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 23%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>format</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>A printf() style format</p></td>
</tr>
<tr class="row-odd"><td><p>args</p></td>
<td><p>Varies</p></td>
<td><p>Arguments corresponding to <code class="docutils literal notranslate"><span class="pre">%</span></code> format options</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>Return Value:</dt><dd><p>The formatted <span class="green">String</span>.</p>
</dd>
</dl>
<div class="section" id="escape-sequences">
<h3>Escape Sequences<a class="headerlink" href="#escape-sequences" title="Permalink to this headline">¶</a></h3>
<p>The following escape sequences are recognized in the format <span class="green">String</span>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\n</span></code> Newline (ASCII 10)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\r</span></code> Carriage return (ASCII 13)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\t</span></code> Tab (ASCII 9)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\a</span></code> Bell character (ASCII 7)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\b</span></code> Backspace (ASCII 8)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\e</span></code> Escape character (ASCII 27)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\f</span></code> Form feed (ASCII 12)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\v</span></code> Vertical tab (ASCII 11)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\</span></code> Backslash</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\xhh</span></code> Hexadecimal escape. hh is 1 or more hex digits.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\ooo</span></code> Octal escape. ooo is 1 to 3 octal digits.</p></li>
</ul>
</div>
<div class="section" id="standard-formats">
<h3>Standard Formats<a class="headerlink" href="#standard-formats" title="Permalink to this headline">¶</a></h3>
<p>A format code is a <code class="docutils literal notranslate"><span class="pre">%</span></code> (percent sign), followed by zero or more flag characters,
an optional width and/or precision size, and the format character itself. The
standard format codes, which are the same as in printf(), and how they print
their arguments are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%d</span></code> or <code class="docutils literal notranslate"><span class="pre">%i</span></code> Integer number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%u</span></code> Unsigned integer number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%x</span></code> or <code class="docutils literal notranslate"><span class="pre">%X</span></code> Hexadecimal (base 16) number; upper-case letters are
used if upper-case X.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%o</span></code> Octal (base 8) number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%f</span></code> Floating-point decimal number.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%e</span></code> or <code class="docutils literal notranslate"><span class="pre">%E</span></code> Exponential floating-point number (e.g. 1.23e+05). Upper-case
exponent if upper-case E.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%g</span></code> or <code class="docutils literal notranslate"><span class="pre">%G</span></code> Either <code class="docutils literal notranslate"><span class="pre">%f</span></code> or <code class="docutils literal notranslate"><span class="pre">%e</span></code> format, whichever is shorter. Upper-case
exponent if upper-case G.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%s</span></code> A text string. The <code class="docutils literal notranslate"><span class="pre">j</span></code> flag may be given for newline
translation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%c</span></code> A single character. If the argument is a decimal, hexadecimal
or octal integer, it is interpreted as the ASCII code of the character
to print.  If the <code class="docutils literal notranslate"><span class="pre">!</span></code> flag is given, a character is decoded instead:
prints the decimal ASCII code for the first character of the argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%%</span></code> A percent-sign; no argument and no flags are given. This
is for printing out a literal <code class="docutils literal notranslate"><span class="pre">%</span></code> in the format <span class="green">String</span>, which
otherwise would be interpreted as a format code.</p></li>
</ul>
<p>A simple example (with its output):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;This is %s number %d (in hex: %x).&quot;</span><span class="p">,</span>
      <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="cm">/* output = &quot;This is test number 42 (in hex: 2a).&quot; */</span>
</pre></div>
</div>
</div>
<div class="section" id="standard-flags">
<h3>Standard Flags<a class="headerlink" href="#standard-flags" title="Permalink to this headline">¶</a></h3>
<p>After the <code class="docutils literal notranslate"><span class="pre">%</span></code> sign (and before the format code letter), zero or more of the
following flags may appear:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#</span></code> (pound sign) Specifies that the value should be printed using an
“alternate format”, depending on the format code.  For format code(s):</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%o</span></code> A non-zero result will be prepended with 0 (zero) in the output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%x</span></code>, %X A non-zero result will be prepended with <code class="docutils literal notranslate"><span class="pre">0x</span></code> or <code class="docutils literal notranslate"><span class="pre">0X</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%e</span></code>, <code class="docutils literal notranslate"><span class="pre">%E</span></code>, <code class="docutils literal notranslate"><span class="pre">%f</span></code>, <code class="docutils literal notranslate"><span class="pre">%g</span></code>, <code class="docutils literal notranslate"><span class="pre">%G</span></code> The result will always contain
a decimal point, even if no digits follow it (normally, a decimal
point appears in the results of those conversions only if a digit
follows).  For <code class="docutils literal notranslate"><span class="pre">%g</span></code> and <code class="docutils literal notranslate"><span class="pre">%G</span></code> conversions, trailing zeros are not
removed from the result as they would otherwise be.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%b</span></code> A non-zero result will be prepended with 0b.</p></li>
</ul>
</div></blockquote>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> (digit zero) Specifies zero padding. For all numeric formats,
the output is padded on the left with zeros instead of spaces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code> (minus sign) Indicates that the result is to be left
adjusted in the output field instead of right.  A <code class="docutils literal notranslate"><span class="pre">-</span></code> overrides a
<code class="docutils literal notranslate"><span class="pre">0</span></code> flag if both are present.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">%L</span></code> extended code, this flag indicates the argument is a
latitude.)</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">⠀</span></code> (a space) Indicates that a space should be left before a positive
number produced by a signed format (e.g.  <code class="docutils literal notranslate"><span class="pre">%d</span></code>, <code class="docutils literal notranslate"><span class="pre">%i</span></code>, <code class="docutils literal notranslate"><span class="pre">%e</span></code>,
<code class="docutils literal notranslate"><span class="pre">%E</span></code>, <code class="docutils literal notranslate"><span class="pre">%f</span></code>, <code class="docutils literal notranslate"><span class="pre">%g</span></code>, or <code class="docutils literal notranslate"><span class="pre">%G</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code> (plus sign) If given with a numeric code, indicates that a sign
always be placed before a number produced by a signed format.  A <code class="docutils literal notranslate"><span class="pre">+</span></code>
overrides a space if both are used.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">%L</span></code> extended code, a <code class="docutils literal notranslate"><span class="pre">+</span></code> flag indicates the argument is a
location with latitude and longitude, or a geocode.</p>
<p>If given with a string code, <code class="docutils literal notranslate"><span class="pre">+</span></code> indicates that if the <span class="green">String</span> value
exceeds the given precision, truncate the <span class="green">String</span> by a further 3 bytes, and
append an ellipsis (“…”).  This can be useful to give an indication of
when a value is being truncated on display.</p>
</li>
</ul>
<p>Examples:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Sql</span><span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rampart-sql&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%#x %#x&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">output2</span><span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%+d %+d&quot;</span><span class="p">,</span>  <span class="mi">42</span><span class="p">,</span> <span class="o">-</span><span class="mi">42</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">   output  = &quot;0x2a 0&quot;</span>
<span class="cm">   output2 = &quot;+42 -42&quot;</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>Following any flags, an optional width <span class="green">Number</span> may be given.  This indicates
the minimum field width to print the value in (unless using the <code class="docutils literal notranslate"><span class="pre">m</span></code> flag;
see <a class="reference internal" href="#metamorph-hit-mark-up">Metamorph Hit Mark-up</a>).  If the printed value is narrower, the output
will be padded with spaces on the left.  Note the horizontal spacing in this
example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">87654321</span><span class="p">,</span> <span class="mi">912</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%6d&quot;</span><span class="p">,</span><span class="nx">x</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
<span class="cm">/* output:</span>
<span class="cm">    42</span>
<span class="cm"> 12345</span>
<span class="cm">87654321</span>
<span class="cm">   912</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>After the width, a decimal point (<code class="docutils literal notranslate"><span class="pre">.</span></code>) and precision <span class="green">Number</span> may
be given.  For the integer formats (<code class="docutils literal notranslate"><span class="pre">%d</span></code>, <code class="docutils literal notranslate"><span class="pre">%i</span></code>, <code class="docutils literal notranslate"><span class="pre">%o</span></code>, <code class="docutils literal notranslate"><span class="pre">%u</span></code>, <code class="docutils literal notranslate"><span class="pre">%x</span></code>
and <code class="docutils literal notranslate"><span class="pre">%X</span></code>), the precision indicates the minimum number of digits to print;
if there are fewer the output value is prepended with zeros.  For the
<code class="docutils literal notranslate"><span class="pre">%e</span></code>, <code class="docutils literal notranslate"><span class="pre">%E</span></code> and <code class="docutils literal notranslate"><span class="pre">%f</span></code> formats, the precision is the number of digits to
appear after the decimal point; the default is 6.  For the <code class="docutils literal notranslate"><span class="pre">%g</span></code> and <code class="docutils literal notranslate"><span class="pre">%G</span></code>
formats, the precision is the maximum number of significant digits (default
6).  For the <code class="docutils literal notranslate"><span class="pre">%s</span></code> (string) format, it is the maximum number of characters
to print.</p>
<p>Examples:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;Error number %5.3d:&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="cm">/* output = &quot;Error number   005:&quot; */</span>

<span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;The %1.6s is %4.2f.&quot;</span><span class="p">,</span>
   <span class="s2">&quot;answering machine&quot;</span><span class="p">,</span> <span class="mf">123.456789</span><span class="p">);</span>
<span class="cm">/* output=&quot;The answer is 123.46.&quot; */</span>
</pre></div>
</div>
<p>The field width or precision, or both, may be given as a parameter instead
of a digit string by using an * (asterisk) character instead.  In this case,
the width or precision will be taken from the next (integer) argument.
Example (note spacing):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">prec</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%*.*f&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">prec</span><span class="p">,</span> <span class="mf">123.4567</span><span class="p">);</span>
<span class="cm">/* output = &quot;    123.46&quot; */</span>
</pre></div>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">h</span></code> or <code class="docutils literal notranslate"><span class="pre">l</span></code> (el) flag may appear immediately before the format code
for numeric formats, indicating a short or long value (<code class="docutils literal notranslate"><span class="pre">l</span></code> has a different
meaning for <code class="docutils literal notranslate"><span class="pre">%H</span></code>, <code class="docutils literal notranslate"><span class="pre">%/</span></code> and <code class="docutils literal notranslate"><span class="pre">%:</span></code>, see <a class="reference internal" href="#extended-flags">Extended Flags</a>).  These flags
are for compatibility with the C function printf(), and are not generally
needed.</p>
</div>
<div class="section" id="printing-date-time-values">
<h3>Printing Date/Time Values<a class="headerlink" href="#printing-date-time-values" title="Permalink to this headline">¶</a></h3>
<p>Dates can be printed with <code class="docutils literal notranslate"><span class="pre">stringFormat()</span></code> by using the <code class="docutils literal notranslate"><span class="pre">%at</span></code> format.
The <code class="docutils literal notranslate"><span class="pre">t</span></code> code indicates a time is being printed, and the a flag indicates
that the next argument is a strftime()-style format string.  Following that
is a time argument.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">output</span><span class="o">=</span><span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%at&quot;</span><span class="p">,</span> <span class="s2">&quot;%B&quot;</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">);</span>
<span class="cm">/* &quot;%B&quot; is the strftime()-style string</span>
<span class="cm">   (indicating the month should be printed) */</span>
</pre></div>
</div>
<p>A capital <code class="docutils literal notranslate"><span class="pre">T</span></code> may be used insteadof lower-case <code class="docutils literal notranslate"><span class="pre">t</span></code> to change the timezone to
Universal Time (GMT/UTC) instead of local time for output.  These strftime()
codes are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%a</span></code> for the abbreviated weekday name (e.g. Sun, Mon, Tue, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%A</span></code> for the full weekday name (e.g. Sunday, Monday, Tuesday, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%b</span></code> for the abbreviated month name (e.g. Jan, Feb, Mar, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%B</span></code> for the full month name (e.g. January, February, March, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%c</span></code> for the preferred date and time representation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%d</span></code> for the day of the month as a decimal number (range 01 through 31).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%H</span></code> for the hour as a decimal number using a 24-hour clock (range 00 through 23).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%I</span></code> for the hour as a decimal number using a 12-hour clock (range 01 through 12).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%j</span></code> for the day of the year as a decimal number (range 001 through 366).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%m</span></code> for the month as a decimal number (range 01 through 12).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%M</span></code> for the minute as a decimal number (range 00 through 59).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%p</span></code> for AM or PM, depending on the time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%S</span></code> for the second as a decimal number (range 00 through 60; 60 to allow for possible leap second if implemented).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%U</span></code> for the week number of the current year as a decimal number, starting with the first Sunday as the first day of the first week (range 00 through 53).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%W</span></code> for the week number of the current year as a decimal number, starting with the first Monday as the first day of the first week (range 00 through 53).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%w</span></code> for the day of the week as a decimal, Sunday being 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%x</span></code> for the preferred date representation without the time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%X</span></code> for the preferred time representation without the date.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%y</span></code> for the year as a decimal number without a century (range 00 through 99).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%Y</span></code> for the year as a decimal number including the century.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%Z</span></code> for the time zone or name or abbreviation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%%</span></code> for a literal <code class="docutils literal notranslate"><span class="pre">%</span></code> character.</p></li>
</ul>
<p>Since <code class="docutils literal notranslate"><span class="pre">stringFormat</span></code> arguments are typecast if needed, the date argument can be
a Texis date or counter type, or a Texis-parseable date string.  For
example, to print today’s date in the form month/day/year:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">output</span><span class="o">=</span><span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%at&quot;</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%y&quot;</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">output</span><span class="p">);</span>
</pre></div>
</div>
<p>Or to print the title and insertion date of books matching a query, in the
style “February 20, 1997” (assuming id is a <span class="xref std std-ref">Texis counter field</span>):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select id, Title from books where Desc like ?q&quot;</span><span class="p">,</span>
         <span class="p">{</span><span class="nx">q</span><span class="o">:</span><span class="nx">query</span><span class="p">},</span>
         <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
             <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%at %s&quot;</span><span class="p">,</span> <span class="s2">&quot;%B %d, %Y&quot;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
            <span class="p">);</span>
         <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>To use a default strftime() format, eliminate the <code class="docutils literal notranslate"><span class="pre">a</span></code> flag and its corresponding strftime() format argument:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">curDate</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%t&quot;</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This will print today’s date in a default format.</p>
<dl class="simple">
<dt>CAVEAT:</dt><dd><p>As dates are printed using the standard C library, not all strftime() codes are available or behave identically on all platforms.</p>
</dd>
</dl>
</div>
<div class="section" id="latitude-longitude-and-location">
<h3>Latitude, Longitude and Location<a class="headerlink" href="#latitude-longitude-and-location" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">%L</span></code> code may be used with <code class="docutils literal notranslate"><span class="pre">stringFormat</span></code> to print a latitude, longitude
or location (geocode) value, in a manner similar to how date/time values are
printed with <code class="docutils literal notranslate"><span class="pre">%t</span></code>.  Flags indicate what type of value is expected, and/or if a
subformat is provided:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-</span></code> (minus) A latitude argument is expected (memory aid: latitude
lines are horizontal, so is minus sign).  This is the default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code> (pipe) A longitude is expected (memory aid: longitude lines are
vertical; so is pipe).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code> (plus) A location is expected; either a geocode long value, or a
latitude and longitude (e.g.  comma-separated).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> Like <code class="docutils literal notranslate"><span class="pre">%at</span></code> (date/time format), the next argument (before the
latitude/longitude/location) is a subformat indicating how to print the
latitude and/or longitude.  Without this flag, no subformat argument is
expected, and a default subformat is used.</p></li>
</ul>
<p>Latitude, longitude and location arguments should be in one of the formats
supported by the
<a class="reference internal" href="sql-server-funcs.html#parselatitude-parselongitude"><span class="std std-ref">parselatitude()</span></a>,
<a class="reference internal" href="sql-server-funcs.html#parselatitude-parselongitude"><span class="std std-ref">parselongitude()</span></a>,
or <a class="reference internal" href="sql-server-funcs.html#latlon2geocode-latlon2geocodearea"><span class="std std-ref">latlon2geocode()</span></a>
(with single arg) SQL functions, as appropriate.  If the <code class="docutils literal notranslate"><span class="pre">a</span></code> flag is given,
the subformat string may contain the following codes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%D</span></code> for degrees</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%M</span></code> for minutes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%S</span></code> for seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%H</span></code> for the hemisphere letter (“N”, “S”, “E” or “W”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%h</span></code> for the hemisphere sign (“+” or “-“)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%o</span></code> for an ISO-8859-1 degree sign</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%O</span></code> for a UTF-8 degree sign</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%%</span></code> for a percent sign</p></li>
</ul>
<p>A field width, precision, space, zero and/or minus flags may be given with
the <code class="docutils literal notranslate"><span class="pre">%D</span></code>/<code class="docutils literal notranslate"><span class="pre">%M</span></code>/<code class="docutils literal notranslate"><span class="pre">%S</span></code> codes, with the same meaning as for numeric
<code class="docutils literal notranslate"><span class="pre">stringFormat()</span></code> codes.  If no flags are given to a code, the width is set
to 2 (or 3 for longitude degrees), with space padding for degrees and zero
padding for minutes and seconds.</p>
<p>Additionally, a single <code class="docutils literal notranslate"><span class="pre">d</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">f</span></code> or <code class="docutils literal notranslate"><span class="pre">g</span></code> numeric-type flag may be
given with the <code class="docutils literal notranslate"><span class="pre">%D</span></code>/<code class="docutils literal notranslate"><span class="pre">%M</span></code>/<code class="docutils literal notranslate"><span class="pre">%S</span></code> codes.  This flag will print the value
with the corresponding <code class="docutils literal notranslate"><span class="pre">stringFormat()</span></code> numeric code, e.g.  truncated to
an integer for <code class="docutils literal notranslate"><span class="pre">d</span></code> or <code class="docutils literal notranslate"><span class="pre">i</span></code>, floating-point with potential roundoff for
<code class="docutils literal notranslate"><span class="pre">f</span></code> or <code class="docutils literal notranslate"><span class="pre">g</span></code>.  This flag is only valid for the smallest unit
(degrees/minutes/seconds) printed: larger units will always be printed in
integer format.  This ensures that a fractional value will not be printed
twice erroneously, e.g.  20.5 degrees will not have its “.5” degrees
fractional part printed if “30” minutes is also being printed, because the
degrees numeric-type will be forced to integer regardless of flags.</p>
<p>The default numeric-type flag is <code class="docutils literal notranslate"><span class="pre">g</span></code> for the smallest unit.  This helps ensure
values are printed with the least number of decimal places needed (often
none), yet with more (sub-second) accuracy if specified in the original
value.  Additionally, for the <code class="docutils literal notranslate"><span class="pre">g</span></code> type, if a degrees/minutes/seconds value is
less than ( 10^-(p-2) ), where p is the format code’s precision (default 6),
it will be truncated to 0.  This helps prevent exponential-format printing
of values, which is often merely an artifact of floating-point roundoff
during unit conversion, and not part of the original user-specified value.</p>
<p>Examples:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;create table geotest(city varchar(64), lat double, lon double, geocode long);&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into geotest values(&#39;Cleveland, OH, USA&#39;, 41.4,  -81.5,  -1);&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into geotest values(&#39;Seattle, WA, USA&#39;,   47.6, -122.3,  -1);&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into geotest values(&#39;Dayton, OH, USA&#39;,    39.75, -84.19, -1);&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;insert into geotest values(&#39;Columbus, OH, USA&#39;,  39.96, -83.0,  -1);&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;update geotest set geocode = latlon2geocode(lat, lon);&quot;</span><span class="p">);</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;create index xgeotest_geocode on geotest(geocode);&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">nres</span><span class="o">=</span><span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select city, lat, lon, geocode, distlatlon(41.4, -81.5, lat, lon) MilesAway &quot;</span><span class="o">+</span>
   <span class="s2">&quot;from geotest &quot;</span> <span class="o">+</span>
   <span class="s2">&quot;where geocode between (select latlon2geocodearea(41.4, -81.5, 3.0)) &quot;</span> <span class="o">+</span>
   <span class="s2">&quot;order by 4 asc;&quot;</span><span class="p">,</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">row</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;  Loc: %+L&quot;</span><span class="p">,</span> <span class="nx">row</span><span class="p">.</span><span class="nx">geocode</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">);</span>
<span class="cm">/* expected output:</span>
<span class="cm">1 {city:&quot;Dayton, OH, USA&quot;,lat:39.75,lon:-84.19,geocode:253806089136,MilesAway:181.31350567274416}</span>
<span class="cm">  Loc: 39°45&#39;00&quot;N  84°11&#39;24&quot;W</span>
<span class="cm">2 {city:&quot;Columbus, OH, USA&quot;,lat:39.96,lon:-83,geocode:253824238336,MilesAway:126.70040182902217}</span>
<span class="cm">  Loc: 39°57&#39;36&quot;N  83°00&#39;00&quot;W</span>
<span class="cm">3 {city:&quot;Cleveland, OH, USA&quot;,lat:41.4,lon:-81.5,geocode:253913441856,MilesAway:0}</span>
<span class="cm">  Loc: 41°24&#39;00&quot;N  81°30&#39;00&quot;W</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="other-format-codes">
<h3>Other Format Codes<a class="headerlink" href="#other-format-codes" title="Permalink to this headline">¶</a></h3>
<p>In addition to the standard printf() formatting codes, other
<code class="docutils literal notranslate"><span class="pre">stringFormat</span></code> codes are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%t</span></code>, <code class="docutils literal notranslate"><span class="pre">%T</span></code> strftime()-style output of a date or counter field (see
above)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%L</span></code> Output of a latitude, longitude, or location (geocode); see above</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%H</span></code> Prints its string (e.g.  varchar) argument, applying HTML escape
codes where needed to make the string “safe” for HTML output (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">DEL</span></code> and control chars less than 32 except
<code class="docutils literal notranslate"><span class="pre">TAB</span></code>, <code class="docutils literal notranslate"><span class="pre">LF</span></code>, <code class="docutils literal notranslate"><span class="pre">FF</span></code> and <code class="docutils literal notranslate"><span class="pre">CR</span></code> are escaped).  With the <code class="docutils literal notranslate"><span class="pre">!</span></code> flag,
decodes instead (to ISO-8859-1); see also the <code class="docutils literal notranslate"><span class="pre">l</span></code> (el) flag, here.
The <code class="docutils literal notranslate"><span class="pre">j</span></code> flag (here) may be given for newline translation.  When
decoding with <code class="docutils literal notranslate"><span class="pre">!</span></code>, out-of-ISO-8859-1-range characters are output as
<code class="docutils literal notranslate"><span class="pre">?</span></code>; to decode HTML to UTF-8 instead, use <code class="docutils literal notranslate"><span class="pre">%hV</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%U</span></code> Prints its string argument, encoding for a URL, i.e using
%-codes.  With the !  flag, decodes instead.  With the p (path) flag,
spaces are encoded as <code class="docutils literal notranslate"><span class="pre">%20</span></code> instead of <code class="docutils literal notranslate"><span class="pre">+</span></code>.  With the <code class="docutils literal notranslate"><span class="pre">q</span></code> flag,
<code class="docutils literal notranslate"><span class="pre">/</span></code> (slash) and <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> (at-sign) are encoded as well (or only
unreserved/safe chars are decoded, if <code class="docutils literal notranslate"><span class="pre">!</span></code>  too).
See <a class="reference internal" href="#extended-flags">Extended Flags</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%V</span></code> (upper-case vee) Prints its string argument, encoding 8-bit
ISO-8859-1 chars for UTF-8 (compressed Unicode).  With the <code class="docutils literal notranslate"><span class="pre">!</span></code>  flag,
decodes instead (to ISO-8859-1).  Illegal, truncated, or out-of-range
sequences are translated as question-marks (?); this can be modified with
the <code class="docutils literal notranslate"><span class="pre">h</span></code> flag (here).  The <code class="docutils literal notranslate"><span class="pre">j</span></code> flag (here) may be given for newline
translation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%v</span></code> (lower-case vee) Prints its UTF-8 string argument, encoding to
UTF-16.  With the <code class="docutils literal notranslate"><span class="pre">!</span></code> flag (here), decodes to UTF-8 instead.
Illegal, truncated, or out-of-range sequences are translated as <code class="docutils literal notranslate"><span class="pre">?</span></code>
(question-marks).  This can be modified with the <code class="docutils literal notranslate"><span class="pre">h</span></code> flag.  The <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>
(less-than) flag forces UTF-16LE (little-endian) output (encode) or
treats input as little-endian (decode).  The <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> flag forces UTF-16BE
(big-endian) output (encode) or treats input as big-endian (decode).
The default endian-ness is big-endian; for decode, a leading
byte-order-mark character (hex 0xFEFF) will determine endian-ness if
present.  The <code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore) flag skips printing a leading
byte-order-mark when encoding; when decoding the <code class="docutils literal notranslate"><span class="pre">_</span></code> flag saves (does
not delete) a leading byte-order-mark in the input.  The <code class="docutils literal notranslate"><span class="pre">j</span></code> flag may
be given for newline translation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%B</span></code> Prints its string argument, encoding to base64.  If a non-zero
field width is given, a newline is output after every “width” bytes output
(absolute value, rounded up to 4) and at the end of the base64 output.
Thus “%64B” would format with no more than 64 bytes per line.  This is
useful for encoding into a MIME mail message with line length restraints.
A <code class="docutils literal notranslate"><span class="pre">!</span></code> flag indicates that the string is to be decoded instead of encoded.
The <code class="docutils literal notranslate"><span class="pre">j</span></code> flag (here) may be given to set the newline style, though it only
applies to soft (output) newlines; input CR/LF bytes are never modified
since base64 is a binary encoding.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%Q</span></code> Prints its string argument, encoding to quoted-printable (per RFC
2045).  If a non-zero field width is given, a newline is output after
every “width” bytes output (absolute value, rounded up where needed).  A
negative field width or <code class="docutils literal notranslate"><span class="pre">-</span></code> flag indicates “binary” encoding: input CR and
LF bytes are also hex-encoded; normally they are output as-is (or subject
to the <code class="docutils literal notranslate"><span class="pre">j</span></code> flag, here) and therefore subject to possible newline translation
by a mail transfer agent etc.  A <code class="docutils literal notranslate"><span class="pre">!</span></code> flag indicates that decoding instead
of encoding is to be done (and the field width and negative flag are
ignored).  The <code class="docutils literal notranslate"><span class="pre">j</span></code> flag (here) may be given for newline translation.  If an
<code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore) flag is given, “Q” encoding (per RFC 2047) is used instead
of quoted-printable: it is similar, except that U+0020 (space) is output
as underscore (_), no whitespace is ever output (e.g.  tab/CR/LF are
hex-encoded, and the field width is ignored), and certain other special
characters are hex-encoded that normally would not be (e.g.  dollar sign,
percent, ampersand etc.).  With the underscore flag, the resulting output
is safe for all RFC 2047 “Q” encoding contexts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%W</span></code> Prints its UTF-8 string argument, encoding
linear-whitespace-separated tokens to RFC 2047 encoded-word format
(i.e.  “=?…?=” mail header tokens) as needed.  Tokens that do not
require encoding are left as-is.  A <code class="docutils literal notranslate"><span class="pre">!</span></code> flag indicates that decoding
instead of encoding should be done.  A <code class="docutils literal notranslate"><span class="pre">q</span></code> flag for <code class="docutils literal notranslate"><span class="pre">%W</span></code> indicates
that only the “Q” encoding should be used for encoded words; normally
either “Q” or base64 - whichever is shorter - is used.  The <code class="docutils literal notranslate"><span class="pre">hh</span></code>,
<code class="docutils literal notranslate"><span class="pre">hhh</span></code>, <code class="docutils literal notranslate"><span class="pre">j</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">|</span></code> flags are respected.  The <code class="docutils literal notranslate"><span class="pre">h</span></code> flag is
aslo supported for %``!W``.  If a non-zero field width is given, it is
used as the desired maximum byte length of encoded words: if an encoded
word would be longer than this, it is split atomically into multiple
words, separated by newline-space.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%z</span></code> Prints its argument, encoded (compressed) in the gzip deflate
format.  The <code class="docutils literal notranslate"><span class="pre">!</span></code> flag will decode (decompress) the argument instead.
A precision value will limit the output to that many bytes, as with
<code class="docutils literal notranslate"><span class="pre">%s</span></code>; this can be used to “peek” at the start of compressed data
without decoding all of it (and consuming memory to do so).</p></li>
<li><p>For either encode or decode, a single <code class="docutils literal notranslate"><span class="pre">l</span></code> flag may be given to indicate
zlib deflate format instead, or a <code class="docutils literal notranslate"><span class="pre">ll</span></code> (double el) to indicate raw
deflate format instead.  All variants use the same deflate algorithm,
but gzip adds (typically) 18 bytes of headers/footers, zlib 6, and raw
none.  Additionally, decoding with <code class="docutils literal notranslate"><span class="pre">%!z</span></code> (no flags) will accept any
of the three variants.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%b</span></code> Binary output of an integer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%F</span></code> Prints a float as a fraction: whole number plus fraction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%r</span></code> Lowercase Roman numeral output of an integer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%R</span></code> Uppercase Roman numeral output of an integer.</p></li>
</ul>
<p>All the standard flags, as well as the extended flags (below), can be given
to these codes, where applicable.</p>
<p>Examples:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;Year %R %H %R&quot;</span><span class="p">,</span> <span class="mi">1977</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="mi">1997</span><span class="p">)</span>
 <span class="p">);</span>
 <span class="cm">/* Year MCMLXXVII &amp;lt; MCMXCVII */</span>

 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%F&quot;</span><span class="p">,</span> <span class="mf">5.75</span><span class="p">)</span>
<span class="p">);</span>
<span class="cm">/* 5 3/4 */</span>
</pre></div>
</div>
</div>
<div class="section" id="extended-flags">
<h3>Extended Flags<a class="headerlink" href="#extended-flags" title="Permalink to this headline">¶</a></h3>
<p>The following flags are available for format codes, in addition to the standard
printf() flags described above:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> Next argument is strftime() format string; used for <code class="docutils literal notranslate"><span class="pre">%t</span></code>/<code class="docutils literal notranslate"><span class="pre">%T</span></code>
time code (here).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">k</span></code> For numeric formats, print a comma (,) every 3 places to the left
of the decimal (e.g.  every multiple of a thousand).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">K</span></code> (upper case “K”) Same as <code class="docutils literal notranslate"><span class="pre">k</span></code>, but print the next argument instead of
a comma.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (ampersand) Use the HTML entity <code class="docutils literal notranslate"><span class="pre">&amp;nbsp</span></code>; instead of space when
padding fields.  This is of some use when printing in an HTML
environment where spaces are normally compressed when displayed, and
thus space padding would be lost.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!</span></code> (exclamation point) When used with <code class="docutils literal notranslate"><span class="pre">%H</span></code>, <code class="docutils literal notranslate"><span class="pre">%U</span></code>, <code class="docutils literal notranslate"><span class="pre">%V</span></code>, <code class="docutils literal notranslate"><span class="pre">%B</span></code>,
<code class="docutils literal notranslate"><span class="pre">%c</span></code>, <code class="docutils literal notranslate"><span class="pre">%W</span></code> or <code class="docutils literal notranslate"><span class="pre">%z</span></code>, decode appropriately instead of encoding.
(Note that for <code class="docutils literal notranslate"><span class="pre">%H</span></code>, only ampersand-escaped entities are decoded)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore) Use decimal ASCII value 160 instead of 32 (space)
when padding fields.  This is the ISO Latin-1 character for the HTML
entity &amp;nbsp;.  For the <code class="docutils literal notranslate"><span class="pre">%v</span></code> (UTF-16 encode) format code, a leading
BOM (byte-order-mark) will not be output.  For the <code class="docutils literal notranslate"><span class="pre">%!v</span></code> (UTF-16
decode) format code, a leading BOM in the input will be preserved
instead of stripped in the output.  For the <code class="docutils literal notranslate"><span class="pre">%Q</span></code>/<code class="docutils literal notranslate"><span class="pre">%!Q</span></code>
(quoted-printable encode/decode) format codes, the “Q” encoding will be
used instead of quoted-printable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">^</span></code> (caret) Output only XML-safe characters; unsafe characters are
replaced with a question mark.  Valid for <code class="docutils literal notranslate"><span class="pre">%V</span></code>, <code class="docutils literal notranslate"><span class="pre">%=V</span></code>, <code class="docutils literal notranslate"><span class="pre">%!V</span></code>,
<code class="docutils literal notranslate"><span class="pre">%v</span></code>, <code class="docutils literal notranslate"><span class="pre">%!v</span></code>, <code class="docutils literal notranslate"><span class="pre">%W</span></code>, <code class="docutils literal notranslate"><span class="pre">%!W</span></code> and <code class="docutils literal notranslate"><span class="pre">%s</span></code> format codes (text is
assumed to be ISO-8859-1 for <code class="docutils literal notranslate"><span class="pre">%s</span></code>).  XML safe characters are all
characters except: <code class="docutils literal notranslate"><span class="pre">U+0000</span></code> through <code class="docutils literal notranslate"><span class="pre">U+0008</span></code> inclusive, <code class="docutils literal notranslate"><span class="pre">U+000B</span></code>,
<code class="docutils literal notranslate"><span class="pre">U+000C</span></code>, <code class="docutils literal notranslate"><span class="pre">U+000E</span></code> through <code class="docutils literal notranslate"><span class="pre">U+001F</span></code> inclusive, <code class="docutils literal notranslate"><span class="pre">U+FFFE</span></code> and
<code class="docutils literal notranslate"><span class="pre">U+FFFF</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">=</span></code> (equal sign) Input encoding is “equal to” (the same) as output
encoding, i.e.  just validate it and replace illegal encoding sequences
with “?”.  Unescaping of HTML sequences in the source (<code class="docutils literal notranslate"><span class="pre">h</span></code> flag) is
disabled.  Valid for <code class="docutils literal notranslate"><span class="pre">%V</span></code> format code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code> (pipe) Interpret illegal encoding sequences in the source as
individual ISO-8859-1 bytes, instead of replacing with the “?”
character.  When used with <code class="docutils literal notranslate"><span class="pre">%=V</span></code> for example, this allows UTF-8 to be
validated and passed through as-is, yet isolated ISO-8859-1 characters
(if any) will still be converted to UTF-8.  Valid for <code class="docutils literal notranslate"><span class="pre">%!V</span></code>, <code class="docutils literal notranslate"><span class="pre">%=V</span></code>,
<code class="docutils literal notranslate"><span class="pre">%v</span></code>, <code class="docutils literal notranslate"><span class="pre">%W</span></code> and %``!W`` format codes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code> For <code class="docutils literal notranslate"><span class="pre">%!V</span></code> (UTF-8 decode) and <code class="docutils literal notranslate"><span class="pre">%v</span></code> (UTF-16 encode): if given once,
HTML-escapes out-of-range (over 255 for <code class="docutils literal notranslate"><span class="pre">%!V</span></code> , over <code class="docutils literal notranslate"><span class="pre">0x10FFFF</span></code> for
%v) characters instead of replacing with <code class="docutils literal notranslate"><span class="pre">?</span></code>.  For <code class="docutils literal notranslate"><span class="pre">%V</span></code> (UTF-8
encode) and <code class="docutils literal notranslate"><span class="pre">%!v</span></code> (UTF-16 decode): if given once, unescapes HTML
sequences first; this allows characters that are out-of-range in the
input encoding to be represented natively in the output encoding.  For
<code class="docutils literal notranslate"><span class="pre">%V</span></code>, <code class="docutils literal notranslate"><span class="pre">%!V</span></code>, <code class="docutils literal notranslate"><span class="pre">%v</span></code>, <code class="docutils literal notranslate"><span class="pre">%!v</span></code>, <code class="docutils literal notranslate"><span class="pre">%W</span></code> and <code class="docutils literal notranslate"><span class="pre">%!W</span></code>, if given twice
(e.g.  <code class="docutils literal notranslate"><span class="pre">hh</span></code>), also HTML-escapes low (7-bit) values (e.g.  control
chars, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>) in the output.  If given three times (e.g.
<code class="docutils literal notranslate"><span class="pre">hhh</span></code>), just HTML-escapes 7-bit values; does not also decode HTML
entities in the input.  Note that the <code class="docutils literal notranslate"><span class="pre">h</span></code> flag is also used in another
context as a sub-flag for <a class="reference internal" href="#metamorph-hit-mark-up">Metamorph Hit Mark-up</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">j</span></code> (jay)   For the <code class="docutils literal notranslate"><span class="pre">%s</span></code>, <code class="docutils literal notranslate"><span class="pre">%H</span></code>, <code class="docutils literal notranslate"><span class="pre">%v</span></code>, <code class="docutils literal notranslate"><span class="pre">%V</span></code>, <code class="docutils literal notranslate"><span class="pre">%B</span></code> and <code class="docutils literal notranslate"><span class="pre">%Q</span></code>
format codes (and their <code class="docutils literal notranslate"><span class="pre">!</span></code>-decode variants), also do newline
translation.  Any of the newline byte sequences CR, LF, or CRLF in the
input will be replaced with the machine-native newline sequence in the
output, instead of being output as-is.  This allows text newlines to be
portably “cleaned up” for the current system, without having to detect
what the system is.  If <code class="docutils literal notranslate"><span class="pre">c</span></code> is given immediately after the <code class="docutils literal notranslate"><span class="pre">j</span></code>,
<code class="docutils literal notranslate"><span class="pre">CR</span></code> is used as the output sequence, instead of the machine-native
sequence.  If <code class="docutils literal notranslate"><span class="pre">l</span></code> (el) is given immediately after the <code class="docutils literal notranslate"><span class="pre">j</span></code>, <code class="docutils literal notranslate"><span class="pre">LF</span></code> is
used as the output sequence.  If both <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">l</span></code> are given (in
either order), CRLF is used.  The <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">l</span></code> subflags allow a
non-native system’s newline convention to be used, e.g.  by a web
application that is adapting to browsers of varying operating systems.
Note that for the <code class="docutils literal notranslate"><span class="pre">%B</span></code> format code, input CR/LF bytes are never
translated (since it is a binary encoding); <code class="docutils literal notranslate"><span class="pre">j</span></code> and its subflags only
affect the output of “soft” line-wrap newlines that do not correspond to
any input character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l</span></code> (el) For <code class="docutils literal notranslate"><span class="pre">%H</span></code>, only encode low (7-bit) characters; leave characters
above 127 as-is.  This is useful when HTML-escaping UTF-8 text, to avoid
disturbing multi-byte characters.  When combined with <code class="docutils literal notranslate"><span class="pre">!</span></code> (decode),
escape sequences are decoded to low (7-bit) strings, e.g.  “&amp;copy;” is
replaced with “(c)” instead of ASCII character 169.  (The <code class="docutils literal notranslate"><span class="pre">l</span></code> flag is
also used with numeric format codes to indicate a long integer or
double, and with the <code class="docutils literal notranslate"><span class="pre">j</span></code> flag as a subflag.) The l flag has yet
another meaning when used with the %/ or %: format codes; see discussion
of those codes above.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m</span></code> For the <code class="docutils literal notranslate"><span class="pre">%s</span></code>, <code class="docutils literal notranslate"><span class="pre">%H</span></code>, <code class="docutils literal notranslate"><span class="pre">%V</span></code> and <code class="docutils literal notranslate"><span class="pre">%v</span></code> codes, mark up with a
Metamorph query.  See next section for a discussion of this flag and its
subflags <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code>, <code class="docutils literal notranslate"><span class="pre">U</span></code>, <code class="docutils literal notranslate"><span class="pre">R</span></code>, <code class="docutils literal notranslate"><span class="pre">h</span></code>, <code class="docutils literal notranslate"><span class="pre">n</span></code>, <code class="docutils literal notranslate"><span class="pre">p</span></code>, <code class="docutils literal notranslate"><span class="pre">P</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and
<code class="docutils literal notranslate"><span class="pre">e</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code> Perform paragraph markup (for <code class="docutils literal notranslate"><span class="pre">%s</span></code> and <code class="docutils literal notranslate"><span class="pre">%H</span></code> codes).  Paragraph breaks
(text matching the REX expression “$=space+”) are replaced with “&lt;p/&gt;”
tags in the output.  For the <code class="docutils literal notranslate"><span class="pre">%U</span></code> code, do path escapement: space is encoded
to <code class="docutils literal notranslate"><span class="pre">%20</span></code> not <code class="docutils literal notranslate"><span class="pre">+</span></code>, and  <code class="docutils literal notranslate"><span class="pre">&amp;+;=</span></code> are left as-is and <code class="docutils literal notranslate"><span class="pre">+</span></code> is
not decoded when also using <code class="docutils literal notranslate"><span class="pre">!</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">P</span></code> (upper case “P”) For <code class="docutils literal notranslate"><span class="pre">%s</span></code> and <code class="docutils literal notranslate"><span class="pre">%H</span></code>, same as p, but use the next
additional argument as the REX expression to match paragraph breaks.  If
given twice (PP), use another additional argument after the REX expression
as the replacement string, instead of “&lt;p/&gt;”.  PP was added in version 6.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q</span></code> For the %U code, in version 7 and earlier, do full-encoding:
encode “/” (forward slash) and “&#64;” (at-sign) as well (implies <code class="docutils literal notranslate"><span class="pre">p</span></code> flag as
well).</p></li>
</ul>
<p>For the %W code, only the “Q” encoding will be used (no base64).</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;You owe $%10.2kf to us.&quot;</span><span class="p">,</span> <span class="mf">56387.34</span><span class="p">);</span>
<span class="cm">/* output  = &quot;You owe $ 56,387.34 to us.&quot; */</span>
</pre></div>
</div>
</div>
<div class="section" id="metamorph-hit-mark-up">
<h3>Metamorph Hit Mark-up<a class="headerlink" href="#metamorph-hit-mark-up" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">%s</span></code>, <code class="docutils literal notranslate"><span class="pre">%H</span></code>, <code class="docutils literal notranslate"><span class="pre">%V</span></code> and <code class="docutils literal notranslate"><span class="pre">%v</span></code> stringFormat codes can execute Metamorph queries on the
<span class="green">String</span> argument and mark-up the resulting hits.  An <code class="docutils literal notranslate"><span class="pre">m</span></code> flag to these codes
indicates that Metamorph hit mark-up should occur; the Metamorph query
string is then taken to be the next argument (before the normal <span class="green">String</span>
argument to be searched and printed).  The <code class="docutils literal notranslate"><span class="pre">m</span></code> flag and its sub-flags are only
valid for the <code class="docutils literal notranslate"><span class="pre">%s</span></code> and <code class="docutils literal notranslate"><span class="pre">%H</span></code> codes.</p>
<p>Following the m flag can be any of the following sub-flags.  These must
immediately follow the m flag, as some letters have other meanings
elsewhere:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">I</span></code> for inline stylesheet (&lt;span style=…&gt;) highlighting with different styles per term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C</span></code> for class (&lt;span class=…&gt;) highlighting with different classes per term</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b</span></code> for HTML bold highlighting of hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">B</span></code> for VT100 bold highlighting of hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">U</span></code> for VT100 underline highlighting of hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">R</span></code> for VT100 reverse-video highlighting of hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code> for HTML HREF highlighting (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> indicates that hits that overlap tags should not be truncated/moved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code> for paragraph formatting: print “&lt;p/&gt;” at paragraph breaks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">P</span></code> same as <code class="docutils literal notranslate"><span class="pre">p</span></code>, but use (next additional argument) REX expression to
match paragraph breaks.  If given twice (<code class="docutils literal notranslate"><span class="pre">PP</span></code>), use another additional
argument after REX expression as replacement string, instead of “&lt;p/&gt;”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code> to continue hit count into next query call</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N</span></code> to mark up NOT terms as well</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q</span></code> to mark up the query itself, not the text, e.g. as a legend</p></li>
</ul>
<p>Examples:</p>
<p>To highlight query terms from <code class="docutils literal notranslate"><span class="pre">query</span></code> in the text contained in
<code class="docutils literal notranslate"><span class="pre">text</span></code> in different colors, insert paragraph breaks, and escape the output
to be HTML-safe, use:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="s2">&quot;format javascript&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;Highlight formatting made easy in javascript.\n\n&lt;Try some formatting today!&gt;&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%mIpH&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
<span class="cm">/* output  = `</span>
<span class="cm">Highlight &lt;span style=&quot;background:#ffff66;color:black;font-weight:bold;&quot;&gt;formatting&lt;/span&gt; made easy in &lt;span style=&quot;background:#a0ffff;color:black;font-weight:bold;&quot;&gt;javascript&lt;/span&gt;.</span>
<span class="cm">&lt;p/&gt;</span>

<span class="cm">&amp;lt;Try some &lt;span style=&quot;background:#ffff66;color:black;font-weight:bold;&quot;&gt;formatting&lt;/span&gt; today!&amp;gt;`</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>To highlight query terms from <code class="docutils literal notranslate"><span class="pre">query</span></code> in <code class="docutils literal notranslate"><span class="pre">text</span></code> in bold with anchors
and links, insert paragraph breaks, and escape the output
to be HTML-safe, use:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">query</span>  <span class="o">=</span> <span class="s2">&quot;format javascript&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">text</span>   <span class="o">=</span> <span class="s2">&quot;Highlight formatting made easy in javascript.\n\n&lt;Try some formatting today!&gt;&quot;</span><span class="p">;</span>
                              <span class="cm">/* qc = mark up query itself and continue counting hits   *</span>
<span class="cm">                               *                 hb = create links, highlight in bold   *</span>
<span class="cm">                               *                   pH = mark paragraphs and html escape */</span>
<span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%mqchbpH\n&lt;p/&gt;\n%mhbpH&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
<span class="cm">/* output  = `</span>
<span class="cm">&lt;a name=&quot;hit1&quot; href=&quot;#hit2&quot;&gt;&lt;b&gt;format&lt;/b&gt;&lt;/a&gt; &lt;a name=&quot;hit2&quot; href=&quot;#hit3&quot;&gt;&lt;b&gt;javascript&lt;/b&gt;&lt;/a&gt;</span>
<span class="cm">&lt;p/&gt;</span>
<span class="cm">Highlight &lt;a name=&quot;hit3&quot; href=&quot;#hit4&quot;&gt;&lt;b&gt;formatting&lt;/b&gt;&lt;/a&gt; made easy in &lt;a name=&quot;hit4&quot; href=&quot;#hit5&quot;&gt;&lt;b&gt;javascript&lt;/b&gt;&lt;/a&gt;.</span>
<span class="cm">&lt;p/&gt;</span>

<span class="cm">&amp;lt;Try some &lt;a name=&quot;hit5&quot; href=&quot;#hit1&quot;&gt;&lt;b&gt;formatting&lt;/b&gt;&lt;/a&gt; today!&amp;gt;`</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p id="inlineprops"><a class="reference internal" href="sql-set.html#server-properties"><span class="std std-ref">Server Properties</span></a> may be given inline.  For example, in the
above example, if you did not want to match “formatting” from the query term
“format” but still wanted to highlight “javascript” where “format” is not
present (<code class="docutils literal notranslate"><span class="pre">&#64;0</span></code> for zero intersections; see
<span class="xref std std-ref">this section</span> for full explanation),
the following could be used:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>             <span class="cm">/* no suffix proc, 0 intersections required */</span>
<span class="kd">var</span> <span class="nx">query</span>  <span class="o">=</span> <span class="s2">&quot;@suffixproc=0 @0 format javascript&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">text</span>   <span class="o">=</span> <span class="s2">&quot;Highlight formatting made easy in javascript.\n\n&lt;Try some formatting today!&gt;&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s2">&quot;%mbpH&quot;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
<span class="cm">/* output  = `</span>
<span class="cm">Highlight formatting made easy in &lt;b&gt;javascript&lt;/b&gt;.</span>
<span class="cm">&lt;p/&gt;</span>

<span class="cm">&amp;lt;Try some formatting today!&amp;gt;</span>
<span class="cm">*/</span>
</pre></div>
</div>
<dl class="simple">
<dt>Discussion:</dt><dd><p><span class="blue">⠀</span></p>
</dd>
</dl>
<p>Each hit found by the query has each of its sets’ hits (e.g.  each term)
highlighted in the output.  With <code class="docutils literal notranslate"><span class="pre">I</span></code> and/or <code class="docutils literal notranslate"><span class="pre">C</span></code> highlighting, if there are
delimiters used in the query, the entire delimited region is also
highlighted.  The Metamorph query uses the same apicp defaults and
parameters as SQL queries.  These can be changed as described
<a class="reference internal" href="#inlineprops"><span class="std std-ref">above</span></a>.</p>
<p>If a width is given for the format code, it indicates the character offset
in the string argument to begin the query and printing (0 is the first
character).  Thus a large text argument can be marked up in several chunks.
Note that this differs from the normal behavior of the width, which is to
specify the overall width of the field to print in.  The precision is the
same - it gives the maximum number of characters of the input string to
print - only it starts counting from the width.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">h</span></code> flag sets HREF highlighting (the default).  Each hit becomes an HREF
that links to the next hit in the output, with the last hit pointing back to
the first.  In the output, the anchors for the hits are named hitN, where N
is the hit number (starting with 1).</p>
<p>Hits can be bold highlighted in the output with the <code class="docutils literal notranslate"><span class="pre">b</span></code> flag; this surrounds
them with <code class="docutils literal notranslate"><span class="pre">&lt;b&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/b&gt;</span></code> tags.  <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">h</span></code> can be combined; the default if
neither is given is HREF highlighting.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">U</span></code> flags may be given for VT100-terminal bold and underline
highlighting; this may be useful for command-line scripts.  The <code class="docutils literal notranslate"><span class="pre">R</span></code> flag
may be given for VT100-terminal reverse-video highlighting.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">I</span></code> or <code class="docutils literal notranslate"><span class="pre">C</span></code> flags may be given, for inline styles or
classes.  This allows much more flexibility in defining the markup, as a
style or class for each distinct query term may then be defined.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">q</span></code> flag may be given, to highlight the query itself, instead of the
following text buffer (which must still be given but is ignored).  This can
be used at the top of a highlighted document to give a highlighting “legend”
to illustrate what terms are highlighted and how.  The <code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">e</span></code> flags
are also implicitly enabled when <code class="docutils literal notranslate"><span class="pre">q</span></code> is given.  Note that settings given
inline with the query (e.g.  “&#64;suffixproc=0”) will not be highlighted since
they do not themselves ever find or match any terms - this helps avoid
misleading the user that such “terms” will ever be found in the text.
However, since they are still considered separate query sets - because their
order in the query is significant, as they only affect following sets - a
class/style is “reserved” (i.e.  not used) for them in the querycyclenum
rotation.</p>
<p>Normally, hits that overlap HTML tags in the search string are truncated or
moved to appear outside the tag in the output, so that the highlighting tags
do not overlap them and muddle the HTML output.  The <code class="docutils literal notranslate"><span class="pre">n</span></code> tag indicates that
this truncation should not be done.  (It is also not done for the <code class="docutils literal notranslate"><span class="pre">%H</span></code> (HTML
escapement) format code, since the tags in the string will be escaped
already.)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">P</span></code> flags do paragraph formatting as documented previously.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">c</span></code> flag indicates that the hit count should be continued for the next
query.  By default, the last hit marked up is linked back to the first hit.
Therefore, each <code class="docutils literal notranslate"><span class="pre">%</span></code>-code query markup is self-contained: if multiple calls are
made, the hit count (and resulting HREFs) will start over for each call,
which may not be desired.  If the <code class="docutils literal notranslate"><span class="pre">c</span></code> flag is given, the last hit in the
string is linked to the “next” hit (N+1) instead of the first, and the next
query will start numbering hits at N+1 instead of 1.  Thus, all but the last
query markup call by a script should use the <code class="docutils literal notranslate"><span class="pre">c</span></code> flag.</p>
<p>The following example creates an abstract, marks up each abstract value from
a table that matches the user’s submitted query string.  Each set (term) is
color-coded differently, and the <code class="docutils literal notranslate"><span class="pre">abstract(body)</span></code> is HTML-escaped:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">results</span><span class="o">=</span><span class="s1">&#39;&lt;div class=&quot;results&quot;&gt;&#39;</span><span class="p">;</span>
<span class="nx">sql</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;select abstract(body) abs from data_tbl where body like ?q&quot;</span><span class="p">,</span>
     <span class="p">{</span><span class="nx">q</span><span class="o">:</span><span class="nx">query</span><span class="p">},</span>
     <span class="kd">function</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">results</span> <span class="o">+=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">stringFormat</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;hit&quot;&gt;%mIH&lt;/div&gt;&#39;</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">row</span><span class="p">.</span><span class="nx">abs</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">);</span>
<span class="nx">results</span> <span class="o">+=</span><span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>For more information on <code class="docutils literal notranslate"><span class="pre">abstract</span></code>, see <a class="reference internal" href="#abstract">abstract()</a> below and
<code class="docutils literal notranslate"><span class="pre">abstract</span></code> in <a class="reference internal" href="sql-server-funcs.html#server-functions"><span class="std std-ref">Server Functions</span></a>.</p>
</div>
</div>
<div class="section" id="abstract">
<h2>abstract()<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>The abstract function generates an abstract of a given portion of text.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">options</span><span class="o">=</span>
   <span class="p">{</span>
      <span class="nx">max</span><span class="o">:</span> <span class="nx">max</span><span class="p">,</span>
      <span class="nx">style</span><span class="o">:</span> <span class="nx">style</span><span class="p">,</span>
      <span class="nx">query</span><span class="o">:</span> <span class="nx">query</span>
   <span class="p">};</span>
<span class="kd">var</span> <span class="kr">abstract</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="kr">abstract</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>or</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="kr">abstract</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="kr">abstract</span><span class="p">(</span><span class="nx">text</span> <span class="p">[,</span><span class="nx">max</span> <span class="p">[,</span><span class="nx">style</span> <span class="p">[,</span><span class="nx">query</span> <span class="p">[,</span><span class="nx">markup</span><span class="p">]]]]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 23%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>text</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>The text from which an abstract will be generated.</p></td>
</tr>
<tr class="row-odd"><td><p>max</p></td>
<td><p><span class="green">Number</span></p></td>
<td><p>Maximum length in characters of the abstract.</p></td>
</tr>
<tr class="row-even"><td><p>style</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>Method used to generate the abstract.</p></td>
</tr>
<tr class="row-odd"><td><p>query</p></td>
<td><p><span class="green">String</span></p></td>
<td><p>query or keywords used to center the abstract.</p></td>
</tr>
<tr class="row-even"><td><p>markup</p></td>
<td><p><span class="green">String</span> or
<span class="green">Boolean</span></p></td>
<td><p>perform markup as <a class="reference internal" href="#metamorph-hit-mark-up">Metamorph Hit Mark-up</a> above.
May be <code class="docutils literal notranslate"><span class="pre">true</span></code> for “%mbH” or a <span class="green">String</span>
for a custom format (such as “%mCH”).</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>Return Value:</dt><dd><p><span class="green">String</span>. The abstract text.</p>
</dd>
</dl>
<p>The abstract will be less than <code class="docutils literal notranslate"><span class="pre">max</span></code> characters long, and will attempt to
end at a word boundary.  If <code class="docutils literal notranslate"><span class="pre">max</span></code> is not specified (or is less than or
equal to 0) then a default size of 230 characters is used.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">style</span></code> argument allows a choice between several different ways of
creating the abstract.  Note that some of these styles require the <code class="docutils literal notranslate"><span class="pre">query</span></code>
argument as well, which is a Metamorph search query:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dumb</span></code> Start the abstract at the top of the document.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">smart</span></code> This style will look for the first meaningful chunk of text,
skipping over any headers at the top of the text.  This is the default if
neither <code class="docutils literal notranslate"><span class="pre">style</span></code> nor <code class="docutils literal notranslate"><span class="pre">query</span></code> is given.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">querysingle</span></code> Center the abstract contiguously on the best occurence
of <code class="docutils literal notranslate"><span class="pre">query</span></code> in the document.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">querymultiple</span></code> Like <code class="docutils literal notranslate"><span class="pre">querysingle</span></code>, but also break up the abstract into
multiple sections (separated with <code class="docutils literal notranslate"><span class="pre">...</span></code>) if needed to help ensure all
terms are visible.  Also it wll take care with URLs to try to show the start
and end.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">querybest</span></code> An alias for the best available query-based style; currently the
same as <code class="docutils literal notranslate"><span class="pre">querymultiple</span></code>.  Using <code class="docutils literal notranslate"><span class="pre">querybest</span></code> in a script ensures that
if improved styles become available in future releases, the script will
automatically “upgrade” to the best style.</p></li>
</ul>
<p>If no <code class="docutils literal notranslate"><span class="pre">query</span></code> is given with a <code class="docutils literal notranslate"><span class="pre">query*</span></code> mode (<code class="docutils literal notranslate"><span class="pre">querysingle</span></code>,
<code class="docutils literal notranslate"><span class="pre">querymultiple</span></code> or <code class="docutils literal notranslate"><span class="pre">querybest</span></code>), it falls back to <code class="docutils literal notranslate"><span class="pre">dumb</span></code> mode.
If a <code class="docutils literal notranslate"><span class="pre">query</span></code> is given with anything other than a <code class="docutils literal notranslate"><span class="pre">query*</span></code> mode
(<code class="docutils literal notranslate"><span class="pre">dumb</span></code>/<code class="docutils literal notranslate"><span class="pre">smart</span></code>), the mode is promoted to <code class="docutils literal notranslate"><span class="pre">querybest</span></code>.  The current locale
and index expressions also have an effect on the abstract in the <code class="docutils literal notranslate"><span class="pre">query*</span></code>
modes, so that it more closely reflects an index-obtained hit.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">gba</span><span class="o">=</span> <span class="s2">&quot;Four score and seven years ago our fathers brought forth on &quot;</span> <span class="o">+</span>
<span class="s2">&quot;this continent, a new nation, conceived in Liberty, and dedicated to &quot;</span> <span class="o">+</span>
<span class="s2">&quot;the proposition that all men are created equal.\n&quot;</span> <span class="o">+</span>

<span class="s2">&quot;Now we are engaged in a great civil war, testing whether that nation, &quot;</span> <span class="o">+</span>
<span class="s2">&quot;or any nation so conceived and so dedicated, can long endure.  We are &quot;</span> <span class="o">+</span>
<span class="s2">&quot;met on a great battle-field of that war.  We have come to dedicate a &quot;</span> <span class="o">+</span>
<span class="s2">&quot;portion of that field, as a final resting place for those who here &quot;</span> <span class="o">+</span>
<span class="s2">&quot;gave their lives that that nation might live.  It is altogether &quot;</span> <span class="o">+</span>
<span class="s2">&quot;fitting and proper that we should do this.\n&quot;</span> <span class="o">+</span>

<span class="s2">&quot;But, in a larger sense, we can not dedicate -- we can not consecrate &quot;</span> <span class="o">+</span>
<span class="s2">&quot;-- we can not hallow -- this ground.  The brave men, living and dead, &quot;</span> <span class="o">+</span>
<span class="s2">&quot;who struggled here, have consecrated it, far above our poor power to &quot;</span> <span class="o">+</span>
<span class="s2">&quot;add or detract.  The world will little note, nor long remember what we &quot;</span> <span class="o">+</span>
<span class="s2">&quot;say here, but it can never forget what they did here.  It is for us &quot;</span> <span class="o">+</span>
<span class="s2">&quot;the living, rather, to be dedicated here to the unfinished work which &quot;</span> <span class="o">+</span>
<span class="s2">&quot;they who fought here have thus far so nobly advanced.  It is rather &quot;</span> <span class="o">+</span>
<span class="s2">&quot;for us to be here dedicated to the great task remaining before us -- &quot;</span> <span class="o">+</span>
<span class="s2">&quot;that from these honored dead we take increased devotion to that cause &quot;</span> <span class="o">+</span>
<span class="s2">&quot;for which they gave the last full measure of devotion -- that we here &quot;</span> <span class="o">+</span>
<span class="s2">&quot;highly resolve that these dead shall not have died in vain -- that &quot;</span> <span class="o">+</span>
<span class="s2">&quot;this nation, under God, shall have a new birth of freedom -- and that &quot;</span> <span class="o">+</span>
<span class="s2">&quot;government of the people, by the people, for the people, shall not &quot;</span> <span class="o">+</span>
<span class="s2">&quot;perish from the earth.\n&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="kr">abstract</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="kr">abstract</span><span class="p">(</span><span class="nx">gba</span><span class="p">);</span>
<span class="cm">/* abstract =</span>
<span class="cm">   Four score and seven years ago our fathers brought forth on this</span>
<span class="cm">   continent, a new nation, conceived in Liberty, and dedicated to the</span>
<span class="cm">   proposition that all men are created equal.  Now we are engaged in a</span>
<span class="cm">   great civil war, testing ...</span>
<span class="cm">*/</span>

<span class="kr">abstract</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="kr">abstract</span><span class="p">(</span><span class="nx">gba</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;querybest&quot;</span><span class="p">,</span> <span class="s2">&quot;unfinished work&quot;</span><span class="p">);</span>
<span class="cm">/* abstract =</span>
<span class="cm">   It is for us the living, rather, to be dedicated here to the</span>
<span class="cm">   unfinished work which they who fought ...</span>
<span class="cm">*/</span>

<span class="kr">abstract</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="kr">abstract</span><span class="p">(</span><span class="nx">gba</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">max</span><span class="o">:</span><span class="mi">250</span><span class="p">,</span>
    <span class="nx">style</span><span class="o">:</span> <span class="s2">&quot;querybest&quot;</span><span class="p">,</span>
    <span class="nx">query</span><span class="o">:</span> <span class="s2">&quot;unfinished work&quot;</span><span class="p">,</span>
    <span class="nx">markup</span><span class="o">:</span> <span class="s2">&quot;%mCH&quot;</span>
<span class="p">});</span>
<span class="cm">/* abstract =</span>
<span class="cm">   The world will little note, nor long remember what we say here, but it can</span>
<span class="cm">   never forget what they did here. &lt;span class=&quot;query&quot;&gt;It is for us the living,</span>
<span class="cm">   rather, to be dedicated here to the &lt;span class=&quot;queryset1&quot;&gt;unfinished&lt;/span&gt;</span>
<span class="cm">   &lt;span class=&quot;queryset2&quot;&gt;work&lt;/span&gt; which they who fought here have thus far</span>
<span class="cm">   so nobly advanced. &lt;/span&gt;It is ...</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="sandr">
<h2>sandr()<a class="headerlink" href="#sandr" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sandr</span></code> function replaces in <code class="docutils literal notranslate"><span class="pre">data</span></code> every occurrence of <code class="docutils literal notranslate"><span class="pre">expr</span></code>
(<a class="reference internal" href="#rex">rex()</a> expression(s)) with the corresponding <span class="green">String</span>(s) from <code class="docutils literal notranslate"><span class="pre">replace</span></code>.  It
returns <code class="docutils literal notranslate"><span class="pre">dataOut</span></code>, a <span class="green">String</span> or <span class="green">Array</span> of <span class="green">Strings</span> with any replacements.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">replace</span></code> has fewer values than <code class="docutils literal notranslate"><span class="pre">expr</span></code>, it is “padded” with empty
replacement <span class="green">Strings</span> for the extra search values.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">dataOut</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">sandr</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">replace</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>

<span class="cm">/* or */</span>

<span class="kd">var</span> <span class="nx">dataOut</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">sandr</span><span class="p">(</span><span class="nx">rexargs</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 7%" />
<col style="width: 49%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>expr</p></td>
<td><p><span class="green">String</span>/<span class="green">Array</span> of <span class="green">Strings</span></p></td>
<td><p><a class="reference internal" href="#rex">rex()</a> expression(s) to search for</p></td>
</tr>
<tr class="row-odd"><td><p>replace</p></td>
<td><p><span class="green">String</span>/<span class="green">Array</span> of <span class="green">Strings</span></p></td>
<td><p>Text to replace the <a class="reference internal" href="#rex">rex()</a> expressions</p></td>
</tr>
<tr class="row-even"><td><p>rexargs</p></td>
<td><p><span class="green">Array</span> of <span class="green">Arrays</span> - search/replace pairs</p></td>
<td><p>pairs of expr and replace strings</p></td>
</tr>
<tr class="row-odd"><td><p>data</p></td>
<td><p><span class="green">String</span>/<span class="green">Array</span> of <span class="green">Strings</span></p></td>
<td><p>string(s) as input for search and replace</p></td>
</tr>
</tbody>
</table>
<dl>
<dt>Return Value:</dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">data</span></code> is an <span class="green">Array</span>, an <span class="green">Array</span> of <span class="green">Strings</span> corresponding to the <code class="docutils literal notranslate"><span class="pre">data</span></code>
<span class="green">Array</span> with replacements made.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">data</span></code> is a <span class="green">String</span>, a <span class="green">String</span> corresponding to the <code class="docutils literal notranslate"><span class="pre">data</span></code> <span class="green">String</span> with
replacements made.</p>
</dd>
</dl>
<div class="section" id="replacement-strings">
<h3>Replacement Strings:<a class="headerlink" href="#replacement-strings" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>The characters <code class="docutils literal notranslate"><span class="pre">?</span></code> <code class="docutils literal notranslate"><span class="pre">#</span></code> <code class="docutils literal notranslate"><span class="pre">{</span></code> <code class="docutils literal notranslate"><span class="pre">}</span></code> <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">\</span></code> are special.
To use them literally, precede them with the escapement character
<code class="docutils literal notranslate"><span class="pre">\</span></code>.</p></li>
<li><p>Replacement strings may just be a literal string or they may include
the “ditto” character <code class="docutils literal notranslate"><span class="pre">?</span></code>.  The ditto character will copy the character
in the position specified in the replace-string from the same position
in the located expression.</p></li>
<li><p>A decimal digit placed within curly-braces (e.g.  {5}) will place
that character of the located expression to the output.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by a decimal number will place that subexpression to
the output.  Subexpressions are numbered starting at 1.</p></li>
<li><p>The sequence <code class="docutils literal notranslate"><span class="pre">\&amp;</span></code> will place the entire expression match (not
including <code class="docutils literal notranslate"><span class="pre">\P</span></code> and <code class="docutils literal notranslate"><span class="pre">\F</span></code> portions) to the output.</p></li>
<li><p>A plus-character <code class="docutils literal notranslate"><span class="pre">+</span></code> will place an incrementing decimal number to the
output.  One purpose of this operator is to number lines.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">#</span></code> followed by a number will cause the numbered subexpression to
be printed in hexadecimal form.</p></li>
<li><p>Any character in the replace-string may be represented by the
hexadecimal value of that character using the following syntax:
<code class="docutils literal notranslate"><span class="pre">\xhh</span></code> where hh is the hexadecimal value.</p></li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">data</span><span class="o">=</span><span class="s2">&quot;I am not unhappy and am not unwilling to participate&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">expr</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participate&quot;</span><span class="p">,</span> <span class="s2">&quot;not un&quot;</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">replace</span><span class="o">=</span><span class="s2">&quot;try&quot;</span><span class="p">;</span> <span class="cm">/* &quot;participate&quot;-&gt;&quot;try&quot;, &quot;not un&quot;-&gt;&quot;&quot; */</span>
<span class="kd">var</span> <span class="nx">dataOut</span><span class="o">=</span><span class="nx">Sql</span><span class="p">.</span><span class="nx">sandr</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">replace</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="cm">/* dataOut = &quot;I am happy and am willing to try&quot; */</span>
</pre></div>
</div>
<p>Example using search/replace argument pairs :</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">data</span><span class="o">=</span><span class="s2">&quot;I am not unhappy and am not unwilling to participate&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">rexargs</span> <span class="o">=</span><span class="p">[</span> <span class="p">[</span><span class="s2">&quot;participate&quot;</span><span class="p">,</span><span class="s2">&quot;try&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;not un&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">]];</span>
<span class="kd">var</span> <span class="nx">dataOut</span><span class="o">=</span><span class="nx">Sql</span><span class="p">.</span><span class="nx">sandr</span><span class="p">(</span><span class="nx">rexargs</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="cm">/* dataOut = &quot;I am happy and am willing to try&quot; */</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#rex">rex()</a> for rex regular expression syntax.</p>
</div>
</div>
<div class="section" id="sandr2">
<h2>sandr2()<a class="headerlink" href="#sandr2" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sandr2</span></code> function operates in the same manner as <code class="docutils literal notranslate"><span class="pre">sandr</span></code>, with the
exception that it uses <a class="reference internal" href="#re2">re2()</a> regular expressions.</p>
</div>
<div class="section" id="rex">
<h2>rex()<a class="headerlink" href="#rex" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rex</span></code> function uses special (non-perlre) regular expressions to search for
substrings in text.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">data</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]);</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 43%" />
<col style="width: 51%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>expr</p></td>
<td><p><span class="green">String</span>/<span class="green">Array</span> of <span class="green">Strings</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rex</span></code> <a class="reference internal" href="#expressions">Expressions</a> to search for</p></td>
</tr>
<tr class="row-odd"><td><p>data</p></td>
<td><p><span class="green">String</span>/Buffer/<span class="green">Array</span></p></td>
<td><p>string(s)/buffers() as input text to be searched</p></td>
</tr>
<tr class="row-even"><td><p>callback</p></td>
<td><p><span class="green">Function</span></p></td>
<td><p>Optional callback Function</p></td>
</tr>
<tr class="row-odd"><td><p>options</p></td>
<td><p><span class="green">Object</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exclude</span></code> and <code class="docutils literal notranslate"><span class="pre">submatches</span></code> options</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>expr:</dt><dd><p>A <span class="green">String</span> or <span class="green">Array</span> of <span class="green">Strings</span> of <code class="docutils literal notranslate"><span class="pre">rex</span></code> regular expressions used to match
the text in <code class="docutils literal notranslate"><span class="pre">data</span></code>. See <a class="reference internal" href="#expressions">Expressions</a> below for full syntax.</p>
</dd>
<dt>data:</dt><dd><p>A <span class="green">String</span>, buffer or an <span class="green">Array</span> with <span class="green">Strings</span> and/or
<span class="green">Buffers</span> containing the text to be searched.</p>
</dd>
<dt>options:</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">rex</span></code> function may take an <span class="green">Object</span> of options:</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;exclude&quot;</span><span class="o">:</span>    <span class="p">[</span> <span class="s2">&quot;none&quot;</span> <span class="o">|</span> <span class="s2">&quot;overlap&quot;</span> <span class="o">|</span> <span class="s2">&quot;duplicate&quot;</span> <span class="p">],</span>
   <span class="s2">&quot;submatches&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="kc">true</span> <span class="o">|</span> <span class="kc">false</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The default value of <code class="docutils literal notranslate"><span class="pre">submatches</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code> if there is a callback,
otherwise <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">submatches</span></code> option is set <code class="docutils literal notranslate"><span class="pre">false</span></code> and no <code class="docutils literal notranslate"><span class="pre">callback</span></code> is
provided, an <span class="green">Array</span> of matching <span class="green">Strings</span> is returned.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">submatches</span></code> option is set <code class="docutils literal notranslate"><span class="pre">true</span></code> and no <code class="docutils literal notranslate"><span class="pre">callback</span></code> is
provided, the return value is set to an <span class="green">Array</span> of <span class="green">Objects</span>, one per match
containing the following information:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
   <span class="p">{</span>
      <span class="nx">match</span><span class="o">:</span><span class="s2">&quot;match1&quot;</span><span class="p">,</span>
      <span class="nx">expressionIndex</span><span class="o">:</span><span class="nx">matchedExpressionNo</span><span class="p">,</span>
      <span class="nx">submatches</span><span class="o">:</span>
         <span class="p">[</span>
            <span class="s2">&quot;array&quot;</span><span class="p">,</span>
            <span class="s2">&quot;of&quot;</span><span class="p">,</span>
            <span class="s2">&quot;submatches&quot;</span>
         <span class="p">]</span>
   <span class="p">},</span>
   <span class="p">{...},</span>
   <span class="p">...</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">match</span></code> - the matched <span class="green">String</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expressionIndex</span> <span class="pre">-</span> <span class="pre">the</span> <span class="pre">index</span> <span class="pre">in</span> <span class="pre">``expr</span></code> of the expression that
produced <code class="docutils literal notranslate"><span class="pre">match</span></code>, if <code class="docutils literal notranslate"><span class="pre">expr</span></code> is an <span class="green">Array</span>.  Otherwise <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sumbatches</span></code> - <span class="green">Array</span> of submatches (one per substring matched with a
<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">=</span></code> or <code class="docutils literal notranslate"><span class="pre">{x,y}</span></code>) from search expression in the order
specified in the search pattern.  For <code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">{0,y}</span></code>, this may be an
empty <span class="green">String</span> (“”).</p></li>
</ul>
<p>See <a class="reference internal" href="#callback">Callback</a> below for callback() parameters where <code class="docutils literal notranslate"><span class="pre">submatches</span></code> is set
<code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">exclude</span></code> option is used for when there are multiple expressions (as
provided by an <span class="green">Array</span> of <span class="green">Strings</span> for the <code class="docutils literal notranslate"><span class="pre">expr</span></code> argument) that might match
the same portion of text.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">none</span></code> returns all possible matches, even if the portion of text that
matches is the same or overlaps with another.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">overlap</span></code> will remove the shorter (in character length) of two matches
where one match overlaps with the other.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duplicate</span></code> (the default mode) will remove the shorter (in character
length) of two matches where one match is entirely encompassed in the
other.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">search</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;th=&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&gt;is=&#39;</span><span class="p">,</span><span class="s1">&#39;this &#39;</span><span class="p">,</span><span class="s1">&#39;his= is=&#39;</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">txt</span>    <span class="o">=</span>  <span class="s1">&#39;hello, this is a message&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="nx">search</span><span class="p">,</span> <span class="nx">txt</span><span class="p">,</span> <span class="p">{</span><span class="nx">exclude</span><span class="o">:</span><span class="s1">&#39;duplicate&#39;</span><span class="p">});</span>
<span class="cm">/* ret == [ &quot;this&quot;, &quot;his is&quot; ] */</span>

<span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="nx">search</span><span class="p">,</span> <span class="nx">txt</span><span class="p">,</span> <span class="p">{</span><span class="nx">exclude</span><span class="o">:</span><span class="s1">&#39;overlap&#39;</span><span class="p">});</span>
<span class="cm">/* ret == [ &quot;his is&quot; ] */</span>

<span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="nx">search</span><span class="p">,</span> <span class="nx">txt</span><span class="p">,</span> <span class="p">{</span><span class="nx">exclude</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">});</span>
<span class="cm">/* ret == [&quot;this &quot;, &quot;th&quot;, &quot;his is&quot;, &quot;is&quot;, &quot;is&quot;] */</span>
</pre></div>
</div>
<dl class="simple" id="callback">
<dt>Callback:</dt><dd><p>The callback function will be passed the following:</p>
</dd>
</dl>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="nx">search</span><span class="p">,</span> <span class="nx">txt</span><span class="p">,</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">submatches</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span>  <span class="s1">&#39;matched string &quot;&#39;</span> <span class="o">+</span> <span class="nx">match</span> <span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="s1">&#39;submatches: &#39;</span><span class="p">,</span> <span class="nx">submatches</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">);</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="nx">search</span><span class="p">,</span> <span class="nx">txt</span><span class="p">,</span> <span class="p">{</span><span class="nx">submatches</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span>
   <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="s1">&#39;matched string &quot;&#39;</span> <span class="o">+</span> <span class="nx">match</span> <span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">match</span></code> - the current <span class="green">String</span> matched.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sumbatches</span></code> - <span class="green">Array</span> of submatches (one per substring matched with a
<code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">=</span></code> or <code class="docutils literal notranslate"><span class="pre">{x,y}</span></code>) from search expression in the order
specified in the search pattern.  For <code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">{0,y}</span></code>, this may be an
empty <span class="green">String</span> (<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> - ordinal position of current match.</p></li>
</ul>
<dl>
<dt>Return Value:</dt><dd><p>Depending on the <code class="docutils literal notranslate"><span class="pre">submatches</span></code> option, an <span class="green">Array</span> of matching <span class="green">Strings</span> or
an <span class="green">Array</span> of <span class="green">Objects</span> with matching <span class="green">String</span> and submatch information.</p>
<p>If a callback function is specified, a <span class="green">Number</span>, the number of matches is returned.</p>
</dd>
</dl>
<div class="section" id="expressions">
<h3>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Expressions are composed of characters and operators.  Operators
are characters with special meaning to REX.  The following
characters have special meaning: <code class="docutils literal notranslate"><span class="pre">\=?+*{},[]^$.-!</span></code> and must
be escaped with a <code class="docutils literal notranslate"><span class="pre">\</span></code> if they are meant to be taken literally.
The string “&gt;&gt;” is also special and if it is to be matched,
it should be written <code class="docutils literal notranslate"><span class="pre">\&gt;&gt;</span></code>.  Not all of these characters are
special all the time; if an entire string is to be escaped so it
will be interpreted literally, only the characters <code class="docutils literal notranslate"><span class="pre">\=?+*{[^$.!&gt;</span></code>
need be escaped.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by an <code class="docutils literal notranslate"><span class="pre">R</span></code> or an <code class="docutils literal notranslate"><span class="pre">I</span></code> means to begin respecting
or ignoring alphabetic case distinction, until the end of the
sub-expression.  (Ignoring case is the default, and will re-apply
at the next sub-expression.)  These switches DO NOT apply to
characters inside range brackets.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by an <code class="docutils literal notranslate"><span class="pre">L</span></code> indicates that the characters following
are to be taken literally up to the next <code class="docutils literal notranslate"><span class="pre">\L</span></code>.  The purpose of
this operation is to remove the special meanings from characters.</p></li>
<li><p>A sub-expression following <code class="docutils literal notranslate"><span class="pre">\F</span></code> (followed by) or <code class="docutils literal notranslate"><span class="pre">\P</span></code> (preceded by)
can be used to root the rest of an expression to which it is tied.
It means to look for the rest of the expression “as long as followed
by …” or ” as long as preceded by …” the sub-expression
following the F or P, but the designated sub-expression will be
considered excluded from the located expression itself.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by one of the following <code class="docutils literal notranslate"><span class="pre">C</span></code> language character
classes matches any character in that class: <code class="docutils literal notranslate"><span class="pre">alpha</span></code>, <code class="docutils literal notranslate"><span class="pre">upper</span></code>,
<code class="docutils literal notranslate"><span class="pre">lower</span></code>, <code class="docutils literal notranslate"><span class="pre">digit</span></code>, <code class="docutils literal notranslate"><span class="pre">xdigit</span></code>, <code class="docutils literal notranslate"><span class="pre">alnum</span></code>, <code class="docutils literal notranslate"><span class="pre">space</span></code>, <code class="docutils literal notranslate"><span class="pre">punct</span></code>,
<code class="docutils literal notranslate"><span class="pre">print</span></code>, <code class="docutils literal notranslate"><span class="pre">graph</span></code>, <code class="docutils literal notranslate"><span class="pre">cntrl</span></code>, <code class="docutils literal notranslate"><span class="pre">ascii</span></code>.  Note that the definition of
these classes may be affected by the current locale.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by one of the following special characters
will assume the following meaning: <code class="docutils literal notranslate"><span class="pre">n</span></code> = newline, <code class="docutils literal notranslate"><span class="pre">t</span></code> = tab,
<code class="docutils literal notranslate"><span class="pre">v</span></code> = vertical tab, <code class="docutils literal notranslate"><span class="pre">b</span></code> = backspace, <code class="docutils literal notranslate"><span class="pre">r</span></code> = carriage return,
<code class="docutils literal notranslate"><span class="pre">f</span></code> = form feed, <code class="docutils literal notranslate"><span class="pre">0</span></code> = the null character.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by  <code class="docutils literal notranslate"><span class="pre">Xn</span></code> or <code class="docutils literal notranslate"><span class="pre">Xnn</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is a hexadecimal digit
will match that character.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">\</span></code> followed by any single character (not one of the above
special escape characters/tokens) matches that character.  Escaping
a character that is not a special escape is not recommended, as the
expression could change meaning if the character becomes an escape
in a future release.</p></li>
<li><p>The character <code class="docutils literal notranslate"><span class="pre">^</span></code> placed anywhere in an expression (except after a
<code class="docutils literal notranslate"><span class="pre">[</span></code>) matches the beginning of a line (same as x0A).</p></li>
<li><p>The character <code class="docutils literal notranslate"><span class="pre">$</span></code> placed anywhere in an expression
matches the end of a line (x0A in Unix).</p></li>
<li><p>The character <code class="docutils literal notranslate"><span class="pre">.</span></code> matches any character.</p></li>
<li><p>A single character not having special meaning matches that
character.</p></li>
<li><p>A string enclosed in brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) is a set, and matches any
single character from the string.  Ranges of ASCII character codes
may be abbreviated with a dash, as in <code class="docutils literal notranslate"><span class="pre">[a-z]</span></code> or <code class="docutils literal notranslate"><span class="pre">[0-9]</span></code>.
A <code class="docutils literal notranslate"><span class="pre">^</span></code> occurring as the first character of the set will invert
the meaning of the set, i.e. any character NOT in the set will
match instead.  A literal <code class="docutils literal notranslate"><span class="pre">-</span></code> must be preceded by a <code class="docutils literal notranslate"><span class="pre">\</span></code>.
The case of alphabetic characters is always respected within brackets.</p>
<p>A double-dash (<code class="docutils literal notranslate"><span class="pre">--</span></code>) may be used inside a bracketed set to subtract
characters from the set; e.g. <code class="docutils literal notranslate"><span class="pre">[\alpha--x]</span></code> for all alphabetic
characters except <code class="docutils literal notranslate"><span class="pre">x</span></code>.  The left-hand side of a set subtraction
must be a range, character class, or another set subtraction.
The right-hand side of a set subtraction must be a range, character
class, or a single character.  Set subtraction groups left-to-right.
The range operator <code class="docutils literal notranslate"><span class="pre">-</span></code> has precedence over set subtraction.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> operator in the first position of a fixed expression
will force REX to use that expression as the “root” expression
off which the other fixed expressions are matched.  This operator
overrides one of the optimizers in REX.  This operator can
be quite handy if you are trying to match an expression
with a <code class="docutils literal notranslate"><span class="pre">!</span></code> operator or if you are matching an item that
is surrounded by other items.  For example: <code class="docutils literal notranslate"><span class="pre">x+&gt;&gt;y+z+</span></code>
would force REX to find the “y’s’ first then go backwards
and forwards for the leading “x’s” and trailing “z’s”.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">!</span></code> character in the first position of an expression means
that it is NOT to match the following fixed expression.
For example: <code class="docutils literal notranslate"><span class="pre">start=!finish+</span></code> would match the word “start”
and anything past it up to (but not including the word “finish”.
Usually operations involving the NOT operator involve knowing
what direction the pattern is being matched in.  In these cases
the <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> operator comes in handy.  If the <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> operator is used,
it comes before the <code class="docutils literal notranslate"><span class="pre">!</span></code>.  For example: <code class="docutils literal notranslate"><span class="pre">&gt;&gt;start=!finish+finish</span></code>
would match anything that began with “start” and ended with
“finish”.  THE NOT OPERATOR CANNOT BE USED BY ITSELF in an
expression, or as the root expression in a compound expression.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">!</span></code> expressions match a character at a time, so their
repetition operators count characters, not expression-lengths
as with normal expressions.  E.g. <code class="docutils literal notranslate"><span class="pre">!finish{2,4}</span></code> matches 2 to 4
characters, whereas <code class="docutils literal notranslate"><span class="pre">finish{2,4}</span></code> matches 2 to 4 times the length
of <code class="docutils literal notranslate"><span class="pre">finish</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="repitition-operators">
<h3>Repitition Operators<a class="headerlink" href="#repitition-operators" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>A regular expression may be followed by a repetition operator in
order to indicate the number of times it may be repeated.</p></li>
<li><p>An expression followed by the operator <code class="docutils literal notranslate"><span class="pre">{X,Y}</span></code> indicates that
from X to Y occurrences of the expression are to be located.  This
notation may take on several forms: “{X}” means X occurrences of
the expression, “{X,}” means X or more occurrences of the
expression, and “{,Y}” means from 0 (no occurrences) to Y
occurrences of the expression.</p></li>
<li><p>The ‘?’ operator is a synonym for the operation <code class="docutils literal notranslate"><span class="pre">{0,1}</span></code>.
Read as: “Zero or one occurrence.”</p></li>
<li><p>The ‘*’ operator is a synonym for the operation <code class="docutils literal notranslate"><span class="pre">{0,}</span></code>.
Read as: “Zero or more occurrences.”</p></li>
<li><p>The ‘+’ operator is a synonym for the operation <code class="docutils literal notranslate"><span class="pre">{1,}</span></code>.
Read as: “One or more occurrences.”</p></li>
<li><p>The ‘=’ operator is a synonym for the operation <code class="docutils literal notranslate"><span class="pre">{1}</span></code>.
Read as: “One occurrence.”</p></li>
</ul>
</div>
<div class="section" id="discussion">
<h3>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">rex</span></code> is a highly optimized pattern recognition tool that has been modeled
after the Unix family of tools: GREP, EGREP, FGREP, and LEX.  Wherever
possible its syntax has been held consistent with these tools, but
there are several major departures that may bite those who are used to
using GREP or Perl Regular Expression families.</p>
<p><code class="docutils literal notranslate"><span class="pre">rex</span></code> uses a combination of techniques that allow it to surpass the speed of
anything similar to it by a very wide margin.</p>
<p>The technique that provides the largest advantage is called
“state-anticipation or state-skipping” which works as follows:</p>
<p>if we were looking for the pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ABCDE</span>
</pre></div>
</div>
<p>in the text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AAAAABCDEAAAAAAA</span>
</pre></div>
</div>
<p>a normal pattern matcher would do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ABCDE</span>
 <span class="n">ABCDE</span>
  <span class="n">ABCDE</span>
   <span class="n">ABCDE</span>
    <span class="n">ABCDE</span>
<span class="n">AAAAABCDEAAAAAAA</span>
</pre></div>
</div>
<p>The state-anticipation scheme would do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ABCDE</span>
    <span class="n">ABCDE</span>
<span class="n">AAAAABCDEAAAAAAA</span>
</pre></div>
</div>
<p>The normal algorithm moves one character at time through the text,
comparing the leading character of the pattern to the current text
character of text, and if they match, it compares the leading pattern
character +1 to the current text character +1 , and so on…</p>
<p>The state anticipation pattern matcher is aware of the length of the
pattern to be matched, and compares the last character of the pattern to
the corresponding text character.  If the two are not equal, it moves
over by an amount that would allow it to match the next potential hit.</p>
<p>If one were to count the number of comparison cycles for each pattern
matching scheme using the example above, the normal pattern matcher would
have to perform 13 compare operations before locating the first occurrence
vs. 6 compare operations for the state-anticipation pattern matcher.</p>
<p>One concept to grasp here is that: “The longer the pattern to be found,
the faster the state-anticipation pattern matcher will be.”  While a
normal pattern matcher will slow down as the pattern gets longer.</p>
<p>Herein lies the first major syntax departure: <code class="docutils literal notranslate"><span class="pre">rex</span></code> always applies
repetition operators to the longest preceding expression.  It does
this so that it can maximize the benefits of using the state-skipping
pattern matcher.</p>
<p>If you were to give GREP the expression : ab*de+
It would interpret it as:</p>
<blockquote>
<div><p>an “a” then 0 or more “b“‘s then a “d” then 1 or more “e“‘s.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rex</span></code> will interpret this as</p>
<blockquote>
<div><p>0 or more occurrences of “ab” followed by 1 or more occurrences of “de”.</p>
</div></blockquote>
<p>The second technique that provides <code class="docutils literal notranslate"><span class="pre">rex</span></code> with a speed advantage is ability
to locate patterns both forwards and backwards indiscriminately.</p>
<p>Given the expression: “abc*def”, the pattern matcher is looking for
“Zero to N occurrences of ‘abc’ followed by a ‘def’”.</p>
<p>The following text examples would be matched by this expression:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>abcabcabcabcdef
def
abcdef
</pre></div>
</div>
<p>But consider these patterns if they were embedded within a body of text:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>My country &#39;tis of abcabcabcabcdef sweet land of def, abcdef.
</pre></div>
</div>
<p>A normal pattern matching scheme would begin looking for ‘abc*’ .  Since
‘abc*’ is matched by every position within the text, the normal pattern
matcher would plod along checking for ‘abc*’ and then whether it’s there
or not it would try to match “def”.  <code class="docutils literal notranslate"><span class="pre">rex</span></code> examines the expression
in search of the the most efficient fixed length sub-pattern and uses it
as the root of search rather than the first sub-expression.  So, in the
example above, <code class="docutils literal notranslate"><span class="pre">rex</span></code> would not begin searching for “abc*” until it has located
a “def”.</p>
<p>There are many other techniques used in <code class="docutils literal notranslate"><span class="pre">rex</span></code> to improve the rate at which
it searches for patterns, but these should have no effect on the way in
which you specify an expression.</p>
<p>The three rules that will cause the most problems to experienced Perl
Regular Expression users are:</p>
<ol class="arabic simple">
<li><p>Repetition operators are always applied to strings, rather than
single characters.</p></li>
<li><p>There must be at least one sub-expression that has one or more
repetitions.</p></li>
<li><p>No matched sub-expression will be located as part of another.</p></li>
</ol>
<p>Rule 1 example:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">abc=def*</span></code>  means one “abc” followed by 0 or more “def“‘s .</p>
</div></blockquote>
<p>Rule 2 example:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">abc*def*</span></code>  <em>can not</em> be located because it matches every
position within the text.</p>
</div></blockquote>
<p>Rule 3 example:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">a+ab</span></code>  Is idiosyncratic because “a+” is a subpart of “ab”.</p>
</div></blockquote>
<p>Note that when using <code class="docutils literal notranslate"><span class="pre">\</span></code> escapes in JavaScript <span class="green">Strings</span>, they must be
double escaped as javascript interprets the <code class="docutils literal notranslate"><span class="pre">\</span></code> before it is passed on to
the <code class="docutils literal notranslate"><span class="pre">rex</span></code> function (.e.g.  <code class="docutils literal notranslate"><span class="pre">Sql.rex(&quot;\\n=[^\\n]+&quot;</span></code>, text)``).
However the following <em>unsupported</em> syntax can also be used in most cases:
<code class="docutils literal notranslate"><span class="pre">Sql.rex(/\n=[^\n]+/,</span> <span class="pre">text)</span></code>.  This may be useful for quick
scripting, but as the <code class="docutils literal notranslate"><span class="pre">/pattern/</span></code> is compiled by javascript, and then
again by <code class="docutils literal notranslate"><span class="pre">rex</span></code>, this will perform unnecessary computation and can fail if
the syntax of the statement is supported by <code class="docutils literal notranslate"><span class="pre">rex</span></code> but not by javascript.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">html</span>    <span class="o">=</span>  <span class="s1">&#39;&lt;img src=&quot;/img.gif&quot; alt=&quot;my image&quot;&gt;&#39;</span> <span class="o">+</span>
               <span class="s1">&#39;&lt;img alt = &quot;second img&quot; src =&quot;/img2.gif&quot;&gt;&#39;</span> <span class="o">+</span>
               <span class="s1">&#39;&lt;map&gt;&#39;</span><span class="o">+</span>
                  <span class="s1">&#39;&lt;area shape=&quot;rect&quot; coords=&quot;34,44,270,350&quot; &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;alt=&quot;not an img&quot;href=&quot;/nai.html&quot;&gt;&lt;/area&gt;&#39;</span><span class="o">+</span>
               <span class="s1">&#39;&lt;/map&gt;&#39;</span><span class="p">;</span>

<span class="cm">/* find alt text in img tags</span>
<span class="cm">   start at &quot;alt&quot;, search forward for alt text</span>
<span class="cm">   and backwards for &quot;&lt;img&quot;</span>
<span class="cm">   exclude all but the alt text.</span>
<span class="cm">*/</span>
<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="s1">&#39;&lt;img=!&lt;...*&gt;&gt;alt=\\space*\\==\\space*&quot;\\P=[^&quot;]+&#39;</span><span class="p">,</span> <span class="nx">html</span> <span class="p">);</span>
<span class="cm">/* ret == [ &quot;my image&quot;, &quot;second img&quot; ] */</span>
</pre></div>
</div>
<p>Note that this example is not robust and would also match
<code class="docutils literal notranslate"><span class="pre">&lt;img</span> <span class="pre">src=&quot;/img.gif&quot;&gt;&lt;a</span> <span class="pre">alt=&quot;alt&quot;&gt;link</span> <span class="pre">text&lt;/a&gt;</span></code>.  A more robust solution would be
as follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">html</span>    <span class="o">=</span>  <span class="s1">&#39;&lt;img src=&quot;/img.gif&quot; alt=&quot;my image&quot;&gt;&#39;</span> <span class="o">+</span>
               <span class="s1">&#39;&lt;img alt = &quot;second img&quot; src =&quot;/img2.gif&quot;&gt;&#39;</span> <span class="o">+</span>
               <span class="s1">&#39;&lt;map&gt;&#39;</span><span class="o">+</span>
                  <span class="s1">&#39;&lt;area shape=&quot;rect&quot; coords=&quot;34,44,270,350&quot; &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;alt=&quot;not an img&quot;href=&quot;/nai.html&quot;&gt;&lt;/area&gt;&#39;</span><span class="o">+</span>
               <span class="s1">&#39;&lt;/map&gt;&#39;</span><span class="o">+</span>
               <span class="s1">&#39;&lt;img src=&quot;/img.gif&quot;&gt;&lt;a alt=&quot;alt&quot;&gt;link text&lt;/a&gt;&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="s2">&quot;&gt;&gt;&lt;img =[^&gt;]*&gt;=&quot;</span><span class="p">,</span> <span class="nx">html</span><span class="p">);</span>
<span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rex</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;alt=\\space*\\==\\space*&quot;\\P=[^&quot;]+&#39;</span><span class="p">,</span> <span class="nx">ret</span><span class="p">);</span>
<span class="cm">/* ret == [ &quot;my image&quot;, &quot;second img&quot; ] */</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="re2">
<h2>re2()<a class="headerlink" href="#re2" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">re2</span></code> function operates identically to the <code class="docutils literal notranslate"><span class="pre">rex</span></code> function
except that it uses Perl Regular Expressions and no submatch information
is returned (empty <span class="green">Array</span>).  See <a class="reference internal" href="#rex">rex()</a> above.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">re2</span><span class="p">(</span><span class="nx">re2_expr</span><span class="p">,</span> <span class="nx">data</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="rexfile">
<h2>rexFile()<a class="headerlink" href="#rexfile" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rexFile</span></code> function operates identically to the <code class="docutils literal notranslate"><span class="pre">rex</span></code> function
except that it takes a file name for the text to search.
See <a class="reference internal" href="#rex">rex()</a> above.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">rexFile</span><span class="p">(</span><span class="nx">expr</span><span class="p">,</span> <span class="nx">filename</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]);</span>
</pre></div>
</div>
<p>In addition to the <code class="docutils literal notranslate"><span class="pre">options</span></code> available in <a class="reference internal" href="#rex">rex()</a>, (<code class="docutils literal notranslate"><span class="pre">exclude</span></code> and
<code class="docutils literal notranslate"><span class="pre">submatches</span></code>), there is also the option to specify a read buffer
<code class="docutils literal notranslate"><span class="pre">delimiter</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">delimiter</span></code> - pattern to match at the end of the read buffer.  Default
is <code class="docutils literal notranslate"><span class="pre">$</span></code> (end of line).  If your pattern crosses lines (includes a
<code class="docutils literal notranslate"><span class="pre">\n</span></code> character), this may be use to specify a delimiter which will not
be included in the pattern to be matched.  As such, this provides the
guarantee that matching of the desired pattern will occur even if a match
would otherwise cross the internal read buffer boundry.</p></li>
</ul>
</div>
<div class="section" id="re2file">
<h2>re2File()<a class="headerlink" href="#re2file" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">re2File</span></code> function operates identically to the <code class="docutils literal notranslate"><span class="pre">rexFile</span></code> function
except that it uses Perl Regular Expressions and no submatch information
is returned (empty <span class="green">Array</span>). See <a class="reference internal" href="#rexfile">rexFile()</a> above.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">re2File</span><span class="p">(</span><span class="nx">re2_expr</span><span class="p">,</span> <span class="nx">filename</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">]</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="searchfile">
<h2>searchFile()<a class="headerlink" href="#searchfile" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">searchFile</span></code> function performs a Metamorph keyword search on a file
and returns the matching portions of that file.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">searchFile</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">filename</span> <span class="p">[,</span> <span class="nx">options</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code> is a <span class="green">String</span> containing the terms used for the search.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code> is a <span class="green">String</span> specifying the file to be searched.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code> is an <span class="green">Object</span> containing optional search settings.
The following can be set (see <a class="reference internal" href="sql-set.html#server-properties"><span class="std std-ref">Server Properties</span></a> for
usage):  <code class="docutils literal notranslate"><span class="pre">alIntersects</span></code>, <code class="docutils literal notranslate"><span class="pre">suffixProc</span></code>, <code class="docutils literal notranslate"><span class="pre">prefixProc</span></code>, <code class="docutils literal notranslate"><span class="pre">defSuffRm</span></code>,
<code class="docutils literal notranslate"><span class="pre">rebuild</span></code>, <code class="docutils literal notranslate"><span class="pre">withinProc</span></code>, <code class="docutils literal notranslate"><span class="pre">intersects</span></code>, <code class="docutils literal notranslate"><span class="pre">minWordLen</span></code>,
<code class="docutils literal notranslate"><span class="pre">useEquiv</span></code>, <code class="docutils literal notranslate"><span class="pre">keepNoise</span></code>, <code class="docutils literal notranslate"><span class="pre">eqPrefix</span></code>, <code class="docutils literal notranslate"><span class="pre">uEqPrefix</span></code>, <code class="docutils literal notranslate"><span class="pre">suffixLst</span></code>,
<code class="docutils literal notranslate"><span class="pre">prefixLst</span></code>, <code class="docutils literal notranslate"><span class="pre">noiseLst</span></code>, <code class="docutils literal notranslate"><span class="pre">qMaxSets</span></code>, <code class="docutils literal notranslate"><span class="pre">qMaxSetWords</span></code>,
<code class="docutils literal notranslate"><span class="pre">qMaxWords</span></code>, <code class="docutils literal notranslate"><span class="pre">qMinWordLen</span></code>, <code class="docutils literal notranslate"><span class="pre">qMinPreLen</span></code>, <code class="docutils literal notranslate"><span class="pre">wordc</span></code> and <code class="docutils literal notranslate"><span class="pre">langc</span></code>.</p></li>
</ul>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An <span class="green">Array</span> of <span class="green">Objects</span> (one <span class="green">Object</span> per match)
where each <span class="green">Object</span> contains the properties <code class="docutils literal notranslate"><span class="pre">match</span></code> (a selection
of text matching the query) and <code class="docutils literal notranslate"><span class="pre">offset</span></code> (the position in the file of the
match).</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">Sql</span><span class="p">.</span><span class="nx">searchFile</span><span class="p">(</span>
   <span class="s2">&quot;live&quot;</span><span class="p">,</span>
   <span class="s2">&quot;gettysburg.txt&quot;</span><span class="p">,</span>
   <span class="p">{</span> <span class="nx">minwordlen</span><span class="o">:</span><span class="mi">3</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">printf</span><span class="p">(</span><span class="s2">&quot;%3J\n&quot;</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>

<span class="cm">/* expected output:</span>
<span class="cm">[</span>
<span class="cm">   {</span>
<span class="cm">      &quot;offset&quot;: 359,</span>
<span class="cm">      &quot;match&quot;: &quot; We have come to dedicate a portion of that\nfield, as a final resting place for those who here gave their lives that\nthat nation might live. &quot;</span>
<span class="cm">   },</span>
<span class="cm">   {</span>
<span class="cm">      &quot;offset&quot;: 668,</span>
<span class="cm">      &quot;match&quot;: &quot; The brave men, living and dead, who\nstruggled here, have consecrated it, far above our poor power to add or\ndetract. &quot;</span>
<span class="cm">   },</span>
<span class="cm">   {</span>
<span class="cm">      &quot;offset&quot;: 895,</span>
<span class="cm">      &quot;match&quot;: &quot; It is for us the living,\nrather, to be dedicated here to the unfinished work which they who fought\nhere have thus far so nobly advanced. &quot;</span>
<span class="cm">   }</span>
<span class="cm">]</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sql-server-funcs.html" class="btn btn-neutral float-right" title="Server Functions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sqltoc.html" class="btn btn-neutral" title="The rampart-sql module" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Moat Crossing Systems.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>