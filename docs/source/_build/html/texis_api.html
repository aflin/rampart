

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Texis Client API &mdash; Rampart 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rampart 0.1.0 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rampart
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"><ul>
<li><a class="reference internal" href="#">The Texis Client API</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#modifying-the-server">Modifying the server</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rampart</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>The Texis Client API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/texis_api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-texis-client-api">
<h1>The Texis Client API<a class="headerlink" href="#the-texis-client-api" title="Permalink to this headline">¶</a></h1>
<p>[Part:V:Chp:tcapi][Part:V:Chp:Embed]</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This chapter provides a reference to the functions that you will need to
use to write your own custom application that talks to Texis.</p>
<p><strong>SQL interface</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">texis_open</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">password</span><span class="p">);</span>
<span class="n">TEXIS</span> <span class="o">*</span><span class="n">texis_open_options</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span>
                          <span class="n">char</span> <span class="o">*</span><span class="n">group</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">password</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_set</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_prepare</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">sqlQuery</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_execute</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_param</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="nb">int</span> <span class="n">paramNum</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">long</span> <span class="o">*</span><span class="n">dataLen</span><span class="p">,</span>
                <span class="nb">int</span> <span class="n">cType</span><span class="p">,</span> <span class="nb">int</span> <span class="n">sqlType</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_resetparams</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_cancel</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">);</span>
<span class="n">FLDLST</span> <span class="o">*</span><span class="n">texis_fetch</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="nb">int</span> <span class="n">stringsFrom</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_flush</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_flush_scroll</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">,</span> <span class="nb">int</span> <span class="n">nrows</span><span class="p">);</span>

<span class="n">char</span> <span class="o">**</span><span class="n">texis_getresultnames</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="nb">int</span> <span class="o">*</span><span class="n">texis_getresultsizes</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_getrowcount</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_getCountInfo</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">,</span> <span class="n">TXCOUNTINFO</span> <span class="o">*</span><span class="n">countInfo</span><span class="p">);</span>
<span class="n">TEXIS</span> <span class="o">*</span><span class="n">texis_close</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">);</span>
<span class="n">FLDLST</span> <span class="o">*</span><span class="n">freefldlst</span><span class="p">(</span><span class="n">FLDLST</span> <span class="o">*</span><span class="n">fl</span><span class="p">);</span>
</pre></div>
</div>
<p>The Texis API provides the client program with an easy to use interface
to any Texis server.</p>
<p>The programmer is <em>strongly</em> encouraged to play with the example
programs provided with the package before attempting their own
implementation.</p>
<dl class="simple">
<dt>SQL interface</dt><dd><p>This group of operations is for passing a user’s query to the
database for processing and subsequently obtaining the results.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="n">FLDLST</span>
<span class="p">{</span>
   <span class="nb">int</span>      <span class="n">n</span><span class="p">;</span>                 <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">arrays</span> <span class="o">*/</span>
   <span class="nb">int</span>      <span class="nb">type</span> <span class="p">[</span><span class="n">FLDLSTMAX</span><span class="p">];</span>  <span class="o">/*</span> <span class="n">data</span> <span class="nb">type</span> <span class="o">*/</span>
   <span class="n">void</span>    <span class="o">*</span><span class="n">data</span> <span class="p">[</span><span class="n">FLDLSTMAX</span><span class="p">];</span>  <span class="o">/*</span> <span class="n">pointer</span> <span class="n">to</span> <span class="n">data</span> <span class="o">*/</span>
   <span class="nb">int</span>      <span class="n">ndata</span><span class="p">[</span><span class="n">FLDLSTMAX</span><span class="p">];</span>  <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">els</span> <span class="ow">in</span> <span class="n">data</span> <span class="o">*/</span>
   <span class="n">char</span>    <span class="o">*</span><span class="n">name</span> <span class="p">[</span><span class="n">FLDLSTMAX</span><span class="p">];</span>  <span class="o">/*</span> <span class="n">name</span> <span class="n">of</span> <span class="n">field</span> <span class="o">*/</span>
   <span class="nb">int</span>      <span class="n">ondata</span><span class="p">[</span><span class="n">FLDLSTMAX</span><span class="p">];</span> <span class="o">/*</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">05</span> <span class="n">number</span> <span class="n">of</span> <span class="n">els</span> <span class="ow">in</span> <span class="n">schema</span> <span class="o">*/</span>
<span class="p">}</span> <span class="n">FLDLST</span><span class="p">;</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">FLDLST</span></code> is a structure containing parallel arrays of information
about the selected fields and a count of those fields. <code class="docutils literal notranslate"><span class="pre">FLDLST</span></code>
members:</p>
<p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">n</span></code> — The number of fields in the following lists.</p>
<p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*type</span></code> — An array of types of the fields. Each element will be
one of the <code class="docutils literal notranslate"><span class="pre">FTN_xxxx</span></code> macros.</p>
<p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**data</span></code> — An array of data pointers. Each element will point to
the data for the field. The data for a field is an array of <code class="docutils literal notranslate"><span class="pre">type</span></code>s.</p>
<p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*ndata</span></code> — An array of data counts. Each element says how many
elements are in the <code class="docutils literal notranslate"><span class="pre">data</span></code> array for this field.</p>
<p><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">**name</span></code> — An array of strings containing the names of the
fields.</p>
<p><code class="docutils literal notranslate"><span class="pre">SRCHLST</span> <span class="pre">*sl</span></code> — An array of SRCHLSTs containing information Metamorph
searches, if any. Filled in, on request only, by <code class="docutils literal notranslate"><span class="pre">n_fillsrchlst()</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MMOFFS</span> <span class="pre">mmoff</span></code> — An array of Metamorph subhit offsets and lengths from
Metamorph searches, if any. Filled in, on request only, by
<code class="docutils literal notranslate"><span class="pre">n_fillsrchlst()</span></code>.</p>
<p>Possible types in <code class="docutils literal notranslate"><span class="pre">FLDLST-&gt;type</span></code> array:</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_BYTE</span></code> — An 8 bit <code class="docutils literal notranslate"><span class="pre">byte</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_CHAR</span></code> — A <code class="docutils literal notranslate"><span class="pre">char</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_DOUBLE</span></code> — A <code class="docutils literal notranslate"><span class="pre">double</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_DATE</span></code> — A <code class="docutils literal notranslate"><span class="pre">long</span></code> in the same form as that from the <code class="docutils literal notranslate"><span class="pre">time()</span></code>
system call.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_DWORD</span></code> — A 32 bit <code class="docutils literal notranslate"><span class="pre">dword</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_FLOAT</span></code> — A <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_INT</span></code> — An <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_INTEGER</span></code> — An <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_LONG</span></code> — A <code class="docutils literal notranslate"><span class="pre">long</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_INT64</span></code> — An <code class="docutils literal notranslate"><span class="pre">int64</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_UINT64</span></code> — A <code class="docutils literal notranslate"><span class="pre">uint64</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_SHORT</span></code> — A <code class="docutils literal notranslate"><span class="pre">short</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_SMALLINT</span></code> — A <code class="docutils literal notranslate"><span class="pre">short</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_WORD</span></code> — A 16 bit <code class="docutils literal notranslate"><span class="pre">word</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_INDIRECT</span></code> — A <code class="docutils literal notranslate"><span class="pre">char</span></code> string URL indicating the file that the
data for this field is stored in.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_COUNTER</span></code> — A <code class="docutils literal notranslate"><span class="pre">ft_counter</span></code> structure containing a unique serial
number.</p>
<p><code class="docutils literal notranslate"><span class="pre">FTN_STRLST</span></code> — A delimited list of strings.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> may also be <code class="docutils literal notranslate"><span class="pre">|</span></code>ed with <code class="docutils literal notranslate"><span class="pre">FTN_NotNullableFlag</span></code>
(formerly <code class="docutils literal notranslate"><span class="pre">DDNULLBIT</span></code>) and/or <code class="docutils literal notranslate"><span class="pre">DDVARBIT</span></code>. If <code class="docutils literal notranslate"><span class="pre">FTN_NotNullableFlag</span></code>
is set, it indicates that the field is not allowed to be NULL.
<code class="docutils literal notranslate"><span class="pre">DDVARBIT</span></code> indicated that the field is variable length instead of
fixed length. When handling result rows these bits can generally be
ignored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="n">TXCOUNTINFO</span>
<span class="p">{</span>
  <span class="n">EPI_HUGEINT</span> <span class="n">rowsMatchedMin</span><span class="p">;</span>
  <span class="n">EPI_HUGEINT</span> <span class="n">rowsMatchedMax</span><span class="p">;</span>
  <span class="n">EPI_HUGEINT</span> <span class="n">rowsReturnedMin</span><span class="p">;</span>
  <span class="n">EPI_HUGEINT</span> <span class="n">rowsReturnedMax</span><span class="p">;</span>
  <span class="n">EPI_HUGEINT</span> <span class="n">indexCount</span><span class="p">;</span>
<span class="p">}</span> <span class="n">TXCOUNTINFO</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TXCOUNTINFO</span></code> struct contains information about the min/max number
of table rows matching the query. The <code class="docutils literal notranslate"><span class="pre">rowsMatchedMin</span></code> and
<code class="docutils literal notranslate"><span class="pre">rowsMatchedMax</span></code> members are before</p>
<ul class="simple">
<li><p>GROUP BY</p></li>
<li><p>likeprows</p></li>
<li><p>aggregates (count(*))</p></li>
<li><p>multivaluetomultirow</p></li>
</ul>
<p>If the number is unknown the result will be less than 0. If
<code class="docutils literal notranslate"><span class="pre">rowsMatchedMin</span></code> and <code class="docutils literal notranslate"><span class="pre">rowsMatchedMax</span></code> are different then the exact
count is unknown.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rowsReturnedMin</span></code> and <code class="docutils literal notranslate"><span class="pre">rowsReturnedMax</span></code> members indicate the
number of rows that would be returned by <code class="docutils literal notranslate"><span class="pre">texis_fetch</span></code> and are after</p>
<ul class="simple">
<li><p>GROUP BY</p></li>
<li><p>likeprows</p></li>
<li><p>aggregates (count(*))</p></li>
<li><p>multivaluetomultirow</p></li>
</ul>
<p>If the number is unknown the result will be less than 0. If
<code class="docutils literal notranslate"><span class="pre">rowsReturnedMin</span></code> and <code class="docutils literal notranslate"><span class="pre">rowsReturnedMax</span></code> are different then the exact
count is unknown.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;texisapi.h&quot;</span>
<span class="nb">int</span> <span class="n">texis_getCountInfo</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">,</span> <span class="n">TXCOUNTINFO</span> <span class="o">*</span><span class="n">countinfo</span><span class="p">);</span>
</pre></div>
</div>
<p>This function will return the count of rows to be read from the index
for the prepared statement, if available.</p>
<p>This function populates a <code class="docutils literal notranslate"><span class="pre">TXCOUNTINFO</span></code> structure with information
about the number of rows expected to be returned. A range of rows may be
provided if rows may be filtered as rows are returned, for example a
combination of indexed and unindexed clauses.</p>
<p>The lower and upper bounds of the array will be updated as rows are
returned and they may converge to the same number.</p>
<p>If the bound is negative that means it is unknown, for example if no
index is being used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">texis_open</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="n">database</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">password</span><span class="p">);</span>
<span class="n">TEXIS</span> <span class="o">*</span><span class="n">texis_dup</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="n">TEXIS</span> <span class="o">*</span><span class="n">texis_close</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">texis_open()</span></code> opens the database. It returns a valid TEXIS pointer on
success or <code class="docutils literal notranslate"><span class="pre">TEXISPN</span></code> on failure. <code class="docutils literal notranslate"><span class="pre">TEXISPN</span></code> is an alias for
<code class="docutils literal notranslate"><span class="pre">(TEXIS</span> <span class="pre">*)NULL</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">texis_dup()</span></code> creates a new TEXIS pointer to the same database as a
currently valid handle. This saves much of the overhead of opening a new
connection to the database. The returned handle is a clean TEXIS handle,
and will not have a copy of the SQL statement from the copied handle. It
returns a valid TEXIS pointer on success or <code class="docutils literal notranslate"><span class="pre">TEXISPN</span></code> on failure.
<code class="docutils literal notranslate"><span class="pre">TEXISPN</span></code> is an alias for <code class="docutils literal notranslate"><span class="pre">(TEXIS</span> <span class="pre">*)NULL</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">texis_close()</span></code> closes the previously opened database. It always
returns <code class="docutils literal notranslate"><span class="pre">TEXISPN</span></code>.</p>
<p>SQL statements are setup and executed with <code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code>,
<code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code>, and <code class="docutils literal notranslate"><span class="pre">texis_fetch()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">texis_prepare</span><span class="p">(),</span> <span class="n">texis_execute</span><span class="p">(),</span> <span class="ow">and</span> <span class="n">texis_fetch</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">texis_set</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="nb">property</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<p>Equivalent to the the SQL SET statement for setting server properties
(p. )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">texis_prepare</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">sqlQuery</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_prepexec</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">sqlQuery</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">texis_execute</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="p">);</span>
</pre></div>
</div>
<p>These functions perform SQL statement setup and execution for databases
opened with <code class="docutils literal notranslate"><span class="pre">texis_open()</span></code>. <code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code> takes a <code class="docutils literal notranslate"><span class="pre">TEXIS</span></code>
pointer from <code class="docutils literal notranslate"><span class="pre">texis_open()</span></code> and a SQL statement.</p>
<p>These functions provide an efficient way to perform the same SQL
statement multiple times with varying parameter data.
<code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code> will return 1 on success, 0 on failure.</p>
<p><code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code> and <code class="docutils literal notranslate"><span class="pre">texis_fetch()</span></code> or <code class="docutils literal notranslate"><span class="pre">texis_flush()</span></code> would
then be called to handle the results of the statement as with
<code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code>.</p>
<p>Once a SQL statement is prepared with <code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code> it may be
executed multiple times with <code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code>. Typically the
parameter data is changed between executions using the <code class="docutils literal notranslate"><span class="pre">texis_param()</span></code>
function.</p>
<p><code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code> will start to execute the statement prepared with
<code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code>. <code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code> will return 1 on success, 0 on
failure.</p>
<p>Parameters should be set between <code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code> and
<code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code>. If there are no parameters you can also use
<code class="docutils literal notranslate"><span class="pre">texis_prepexec()</span></code>, which will call <code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code> and
<code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code> in one call.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>SERVER *se;
TEXIS     *tx;
long    date;
char   *title;
char   *article;
int     tlen, alen, dlen;

   ...
   if(!texis_prepare(tx,&quot;insert into docs values(counter,?,?,?);&quot;))
      { puts(&quot;texis_prepare Failed&quot;); return(0); }
   for( each record to insert )
   {
      ...
      date=...
      dlen=sizeof(date);
      title=...
      tlen=strlen(title);
      article=...
      alen=strlen(article);
      if(!texis_param(tx,1,&amp;date  ,&amp;dlen,SQL_C_LONG,SQL_DATE       ) ||
         !texis_param(tx,2,title  ,&amp;tlen,SQL_C_CHAR,SQL_LONGVARCHAR) ||
         !texis_param(tx,3,article,&amp;alen,SQL_C_CHAR,SQL_LONGVARCHAR));
         { puts(&quot;texis_param Failed&quot;); return(0); }
      if(!texis_execute(tx))
         { puts(&quot;texis_execute Failed&quot;); return(0); }
      texis_flush(tx);
   }
   ...
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TEXIS     *tx;
char   *query;
int     qlen;
FLDLST *fl;

   ...
   if(!texis_prepare(tx,
         &quot;select id,Title from docs where Article like ?;&quot;))
      { puts(&quot;texis_prepare Failed&quot;); return(0); }
   for( each Article query to execute )
   {
      query=...
      qlen=strlen(query);
      if(!texis_param(tx,1,query,&amp;qlen,SQL_C_CHAR,SQL_LONGVARCHAR))
         { puts(&quot;texis_param Failed&quot;); return(0); }
      if(!texis_execute(tx))
         { puts(&quot;texis_execute Failed&quot;); return(0); }
      while((fl=texis_fetch(tx,-1))!=FLDLSTPN)
      {
         ...
      }
   }
   ...
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">texis_open</span><span class="p">(),</span> <span class="n">texis_fetch</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FLDLST</span> <span class="o">*</span><span class="n">texis_fetch</span><span class="p">(</span><span class="n">TEXIS</span> <span class="o">*</span><span class="n">tx</span><span class="p">,</span> <span class="nb">int</span> <span class="n">stringsFrom</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">texis_fetch()</span></code> returns a <code class="docutils literal notranslate"><span class="pre">FLDLST</span></code> pointer to the result set. The
<code class="docutils literal notranslate"><span class="pre">stringsFrom</span></code> paramter lets you control if results are automatically
converted to text. An argument value of -1 will not convert any result,
other numbers will start converting from that result column, so passing
0 will cause all fields to be converted.</p>
<p>Continue calling <code class="docutils literal notranslate"><span class="pre">texis_fetch()</span></code> to get subsequent result rows.
<code class="docutils literal notranslate"><span class="pre">texis_fetch()</span></code> will return <code class="docutils literal notranslate"><span class="pre">FLDLSTPN</span></code> when there are no more result
rows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEXIS</span>     <span class="o">*</span><span class="n">tx</span><span class="p">;</span>
<span class="n">FLDLST</span> <span class="o">*</span><span class="n">fl</span><span class="p">;</span>

   <span class="o">...</span>
   <span class="k">if</span><span class="p">((</span><span class="n">tx</span><span class="o">=</span><span class="n">texis_open</span><span class="p">())</span><span class="o">!=</span><span class="n">TEXISPN</span><span class="p">)</span>      <span class="o">/*</span> <span class="n">initialize</span> <span class="n">database</span> <span class="n">connection</span> <span class="o">*/</span>
   <span class="p">{</span>
      <span class="o">...</span>
                                                     <span class="o">/*</span> <span class="n">setup</span> <span class="n">query</span> <span class="o">*/</span>
      <span class="k">if</span><span class="p">(</span><span class="n">texis_prepare</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span>
                 <span class="s2">&quot;select NAME from SYSTABLES where CREATOR!=&#39;texis&#39;;&quot;</span>
                <span class="p">)</span><span class="o">!=</span><span class="n">TEXISPN</span><span class="p">)</span>
         <span class="k">while</span><span class="p">((</span><span class="n">fl</span><span class="o">=</span><span class="n">texis_fetch</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span><span class="o">!=</span><span class="n">FLDLSTPN</span><span class="p">)</span><span class="o">/*</span> <span class="n">get</span> <span class="nb">next</span> <span class="n">result</span> <span class="n">row</span> <span class="o">*/</span>
         <span class="p">{</span>
            <span class="n">dispfields</span><span class="p">(</span><span class="n">fl</span><span class="p">);</span>            <span class="o">/*</span> <span class="n">display</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">the</span> <span class="n">fields</span> <span class="o">*/</span>
         <span class="p">}</span>
      <span class="o">...</span>
      <span class="n">texis_close</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>                   <span class="o">/*</span> <span class="n">close</span> <span class="n">database</span> <span class="n">connection</span> <span class="o">*/</span>
   <span class="p">}</span>
   <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">texis_prepare</span><span class="p">(),</span> <span class="n">texis_execute</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">texis_param</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">sqltype</span><span class="p">)</span>
<span class="n">TEXIS</span>   <span class="o">*</span><span class="n">tx</span><span class="p">;</span>
<span class="nb">int</span>     <span class="n">ipar</span><span class="p">;</span>
<span class="n">void</span>    <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
<span class="nb">int</span>     <span class="o">*</span><span class="nb">len</span><span class="p">;</span>
<span class="nb">int</span>     <span class="n">ctype</span><span class="p">;</span>
<span class="nb">int</span>     <span class="n">sqltype</span><span class="p">;</span>

<span class="nb">int</span> <span class="n">texis_resetparams</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="n">TEXIS</span>   <span class="o">*</span><span class="n">tx</span><span class="p">;</span>
</pre></div>
</div>
<p>These functions allow you to pass arbitrarily large or complex data into
a SQL statement. Sometimes there is data that won’t work in the confines
of the simple C string that comprises an SQL statement. Large text
fields or binary data for example.</p>
<p>Call <code class="docutils literal notranslate"><span class="pre">texis_param()</span></code> to setup parameters after <code class="docutils literal notranslate"><span class="pre">texis_prepare()</span></code> and
before <code class="docutils literal notranslate"><span class="pre">texis_execute()</span></code>. If you have a statement you have already
executed once, and you want to execute again with different data, which
may have parameters unset which were previously set you can call
<code class="docutils literal notranslate"><span class="pre">texis_resetparams()</span></code>. This is not neccessary if you will explicitly
set all the parameters. Place a question mark (<code class="docutils literal notranslate"><span class="pre">?</span></code>) in the SQL
statement where you would otherwise place the data.</p>
<p>These are the parameters:</p>
<dl class="simple">
<dt>TEXIS *tx</dt><dd><p>The prepared SQL statement.</p>
</dd>
<dt>int ipar</dt><dd><p>The number of the parameter, starting at 1.</p>
</dd>
<dt>void *buf</dt><dd><p>A pointer to the data to be transmitted.</p>
</dd>
<dt>int *len</dt><dd><p>A pointer to the length of the data. This can be <code class="docutils literal notranslate"><span class="pre">(int</span> <span class="pre">*)NULL</span></code> to
use the default length, which assumes a <code class="docutils literal notranslate"><span class="pre">'\0'</span></code> terminated string
for character data.</p>
</dd>
<dt>int ctype</dt><dd><p>The type of the data. For text use SQL_C_CHAR.</p>
</dd>
<dt>int sqltype</dt><dd><p>The type of the field being inserted into. For varchar use
SQL_LONGVARCHAR.</p>
</dd>
</dl>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 29%" />
<col style="width: 28%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Field type</p></th>
<th class="head"><p>sqltype</p></th>
<th class="head"><p>ctype</p></th>
<th class="head"><p>C type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>varchar</p></td>
<td><p>SQL_LONGVARCHAR</p></td>
<td><p>SQL_C_CHAR</p></td>
<td><p>char</p></td>
</tr>
<tr class="row-odd"><td><p>varbyte</p></td>
<td><p>SQL_BINARY</p></td>
<td><p>SQL_C_BINARY</p></td>
<td><p>byte</p></td>
</tr>
<tr class="row-even"><td><p>date</p></td>
<td><p>SQL_DATE</p></td>
<td><p>SQL_C_LONG</p></td>
<td><p>long</p></td>
</tr>
<tr class="row-odd"><td><p>integer</p></td>
<td><p>SQL_INTEGER</p></td>
<td><p>SQL_C_INTEGER</p></td>
<td><p>long</p></td>
</tr>
<tr class="row-even"><td><p>smallint</p></td>
<td><p>SQL_SMALLINT</p></td>
<td><p>SQL_C_SHORT</p></td>
<td><p>short</p></td>
</tr>
<tr class="row-odd"><td><p>float</p></td>
<td><p>SQL_FLOAT</p></td>
<td><p>SQL_C_FLOAT</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>double</p></td>
<td><p>SQL_DOUBLE</p></td>
<td><p>SQL_C_DOUBLE</p></td>
<td><p>double</p></td>
</tr>
<tr class="row-odd"><td><p>varind</p></td>
<td><p>SQL_LONGVARCHAR</p></td>
<td><p>SQL_C_CHAR</p></td>
<td><p>char</p></td>
</tr>
<tr class="row-even"><td><p>counter</p></td>
<td><p>SQL_COUNTER</p></td>
<td><p>SQL_C_COUNTER</p></td>
<td><p>ft_counter</p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TEXIS  *tx;
char   *description;
char   *article;
int     lend, lena;

   if(!texis_prepare(tx,&quot;insert into docs values(?,?);&quot;))
      { puts(&quot;texis_prepare Failed&quot;); return(0); }
   ...
   description=&quot;a really large article&quot;;
   lend=strlen(description);
   article=...
   lena=strlen(article);
   if(!texis_param(tx,1,description,&amp;lend,SQL_C_CHAR,SQL_LONGVARCHAR)||
      !texis_param(tx,2,article    ,&amp;lena,SQL_C_CHAR,SQL_LONGVARCHAR));
      { puts(&quot;texis_param Failed&quot;); return(0); }
   if(!texis_execute(tx))
      { puts(&quot;texis_execute Failed&quot;); return(0); }
   ...
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">texis_cancel</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
<span class="n">TEXIS</span>      <span class="o">*</span><span class="n">tx</span><span class="p">;</span>
</pre></div>
</div>
<p>This function is used to cancel a TEXIS statement. It can be called in a
signal handler or thread to flag that the currently executing call on
the TEXIS handle should terminate at the next possible opportunity.</p>
<p>Once the thread has returned the TEXIS handle should be closed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">texis_flush</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>
<span class="n">TEXIS</span>      <span class="o">*</span><span class="n">tx</span><span class="p">;</span>
</pre></div>
</div>
<p>This function flushes any remaining results from the current SQL
statement. Execution of the statement is finished however. This is
useful for ignoring the output of <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> statements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SERVER</span> <span class="o">*</span><span class="n">se</span><span class="p">;</span>

   <span class="o">...</span>
                                                     <span class="o">/*</span> <span class="n">setup</span> <span class="n">query</span> <span class="o">*/</span>
   <span class="k">if</span><span class="p">(</span><span class="n">texis_prepare</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span>
              <span class="s2">&quot;delete from customer where lastorder&lt;&#39;1990-01-01&#39;;&quot;</span>
             <span class="p">)</span><span class="o">!=</span><span class="n">TEXISPN</span><span class="p">)</span>
      <span class="n">texis_flush</span><span class="p">(</span><span class="n">tx</span><span class="p">);</span>                        <span class="o">/*</span> <span class="n">ignore</span> <span class="n">result</span> <span class="nb">set</span> <span class="o">*/</span>
   <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">texis_flush_scroll</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">nrows</span><span class="p">);</span>
<span class="n">TEXIS</span>      <span class="o">*</span><span class="n">tx</span><span class="p">;</span>
<span class="nb">int</span>     <span class="n">nrows</span><span class="p">;</span>
</pre></div>
</div>
<p>This function flushes up to nrows results from the specified SQL
statement. This is useful for skipping a number of records from a
<code class="docutils literal notranslate"><span class="pre">SELECT</span></code>.</p>
<p>The return will be the number of records actually flushed if successful,
or if an error occurred then the return will be a negative number of (-1
- rowsflushed). Reaching the end of the results is not considered an
error, and will result in a return less than nrows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SERVER</span> <span class="o">*</span><span class="n">se</span><span class="p">;</span>

   <span class="o">...</span>
                                                     <span class="o">/*</span> <span class="n">setup</span> <span class="n">query</span> <span class="o">*/</span>
   <span class="k">if</span><span class="p">(</span><span class="n">texis_prepare</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span>
              <span class="s2">&quot;select name from customer where lastorder&lt;&#39;1990-01-01&#39;;&quot;</span>
             <span class="p">)</span><span class="o">!=</span><span class="n">TEXISPN</span><span class="p">)</span>
      <span class="n">texis_flush_scroll</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>           <span class="o">/*</span> <span class="n">ignore</span> <span class="n">first</span> <span class="mi">10</span> <span class="n">results</span> <span class="o">*/</span>
   <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-the-server">
<h2>Modifying the server<a class="headerlink" href="#modifying-the-server" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;sys/types.h&gt;</span>
<span class="c1">#include &quot;dbquery.h&quot;</span>

<span class="n">void</span> <span class="n">adduserfuncs</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span>
<span class="n">FLDOP</span> <span class="o">*</span><span class="n">fo</span><span class="p">;</span>
</pre></div>
</div>
<p>This section describes how to add user defined types and functions to
the texis server. The file aufex.c in the api directory provides an
outline of how to do this. The server calls the function adduserfuncs
which gives you the opportunity to add data types, operators and
functions to the server. There are three functions that are used for
adding to the server. They are dbaddtype, foaddfuncs and fosetop.</p>
<p>Once you have created your own version of aufex.c you need to compile
and link this file with the rest of the daemon objects. You must make
sure that this file is linked before the libraries to make sure your
function gets called. An example makefile is also included in the api
directory which shows the needed objects and include paths to make a new
daemon. After a new daemon has been created, make sure that it is
running and not the standard daemon. See the documentation on texisd to
see how to invoke it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">dbaddtype</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="nb">int</span> <span class="nb">type</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">size</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>name</dt><dd><p>the new name for the type. It should not start with the string
“var”, as that is reserved for declaring the variable size form of
the datatype.</p>
</dd>
<dt>type</dt><dd><p>an integer which is used to refer to the type in functions etc. For
a user added type this number should be between 32 and 63 inclusive.
This number should be unique.</p>
</dd>
<dt>size</dt><dd><p>the size of one element of the datatype. When one item of this type
is written to the database, at least size bytes will be transferred.</p>
</dd>
</dl>
<p>The function will return 0 if successful, and -1 if there is no room for
more datatypes, or if a type with a different name already exists with
the same type number.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="n">tagTIMESTAMP</span>
<span class="p">{</span>
   <span class="n">short</span>           <span class="n">year</span><span class="p">;</span>
   <span class="n">unsigned</span> <span class="n">short</span>  <span class="n">month</span><span class="p">;</span>
   <span class="n">unsigned</span> <span class="n">short</span>  <span class="n">day</span><span class="p">;</span>
   <span class="n">unsigned</span> <span class="n">short</span>  <span class="n">hour</span><span class="p">;</span>
   <span class="n">unsigned</span> <span class="n">short</span>  <span class="n">minute</span><span class="p">;</span>
   <span class="n">unsigned</span> <span class="n">short</span>  <span class="n">second</span><span class="p">;</span>
   <span class="n">unsigned</span> <span class="n">long</span>   <span class="n">fraction</span><span class="p">;</span>
<span class="p">}</span> <span class="n">TIMESTAMP</span><span class="p">;</span>

<span class="n">dbaddtype</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;sys/types.h&gt;</span>
<span class="c1">#include &quot;dbquery.h&quot;</span>

<span class="nb">int</span> <span class="n">foaddfuncs</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span> <span class="n">ff</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">FLDOP</span> <span class="o">*</span><span class="n">fo</span><span class="p">;</span>
<span class="n">FLDFUNC</span> <span class="o">*</span><span class="n">ff</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">n</span><span class="p">;</span>
</pre></div>
</div>
<p>Foaddfuncs adds a function to the math unit of Texis. The function can
take up to five arguments, and returns a single argument. The function
will be called with pointers to FLD structures. The return values should
be stuffed into the pointer to the first argument.</p>
<p>The math unit takes care of all the required stack manipulation, so no
stack manipulation is required in the function. The math unit will
always pass the maximum number of arguments to the function.</p>
<p>Foaddfuncs takes an array of function descriptions as one of its
arguments. The functions description function looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="p">{</span>
   <span class="n">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>                                  <span class="o">/*</span> <span class="n">name</span> <span class="n">of</span> <span class="n">function</span> <span class="o">*/</span>
   <span class="nb">int</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)();</span>                                        <span class="o">/*</span> <span class="n">handler</span> <span class="o">*/</span>
   <span class="nb">int</span>   <span class="n">minargs</span><span class="p">;</span>                 <span class="o">/*</span> <span class="n">minimum</span> <span class="c1"># of arguments allowed */</span>
   <span class="nb">int</span>   <span class="n">maxargs</span><span class="p">;</span>                 <span class="o">/*</span> <span class="n">maximum</span> <span class="c1"># of arguments allowed */</span>
   <span class="nb">int</span>   <span class="n">rettype</span><span class="p">;</span>                                    <span class="o">/*</span> <span class="k">return</span> <span class="nb">type</span> <span class="o">*/</span>
   <span class="nb">int</span>   <span class="n">types</span><span class="p">[</span><span class="n">MAXFLDARGS</span><span class="p">];</span>   <span class="o">/*</span> <span class="n">argument</span> <span class="n">types</span><span class="p">,</span> <span class="mi">0</span> <span class="n">means</span> <span class="n">don</span><span class="s1">&#39;t care */</span>
<span class="p">}</span> <span class="n">FLDFUNC</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt>fo</dt><dd><p>The math unit to add to.</p>
</dd>
<dt>ff</dt><dd><p>Array of function descriptions to be added.</p>
</dd>
<dt>n</dt><dd><p>The number of functions being added.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>
<span class="n">fsqr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">FLD</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
<span class="p">{</span>
   <span class="nb">int</span>     <span class="n">x</span><span class="p">;</span>
   <span class="n">size_t</span>  <span class="n">sz</span><span class="p">;</span>

   <span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">ft_int</span> <span class="o">*</span><span class="p">)</span><span class="n">getfld</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sz</span><span class="p">);</span>      <span class="o">/*</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">number</span> <span class="o">*/</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="p">;</span>                              <span class="o">/*</span> <span class="n">Square</span> <span class="n">it</span> <span class="o">*/</span>
   <span class="n">putfld</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>                    <span class="o">/*</span> <span class="n">Put</span> <span class="n">the</span> <span class="n">result</span> <span class="o">*/</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">static</span> <span class="n">FLDFUNC</span>  <span class="n">dbfldfuncs</span><span class="p">[]</span><span class="o">=</span>
<span class="p">{</span>
   <span class="p">{</span><span class="s2">&quot;sqr&quot;</span><span class="p">,</span>   <span class="n">fsqr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">FTN_INT</span><span class="p">,</span> <span class="n">FTN_INT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>
<span class="c1">#define NFLDFUNCS (sizeof(dbfldfuncs)/sizeof(dbfldfuncs[0]))</span>

<span class="n">foaddfuncs</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span> <span class="n">dbfldfuncs</span><span class="p">,</span> <span class="n">NFLDFUNCS</span><span class="p">);</span>
</pre></div>
</div>
<p>This will add a function to square an integer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;sys/types.h&gt;</span>
<span class="c1">#include &quot;dbquery.h&quot;</span>

<span class="nb">int</span> <span class="n">fosetop</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span> <span class="n">type1</span><span class="p">,</span> <span class="n">type2</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">ofunc</span><span class="p">)</span>
<span class="n">FLDOP</span> <span class="o">*</span><span class="n">fo</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">type1</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">type2</span><span class="p">;</span>
<span class="n">fop_type</span> <span class="n">func</span><span class="p">;</span>
<span class="n">fop_type</span> <span class="o">*</span><span class="n">ofunc</span><span class="p">;</span>
</pre></div>
</div>
<p>Fosetop changes a binary operator in the math unit of Texis. The
function func will be called for all operations on (type1, type2). If
the function does not know how to handle the specific operation, and
ofunc is not NULL, ofunc can be called to hande the operation.</p>
<p>The function being called should look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>
<span class="n">func</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
<span class="n">FLD</span> <span class="o">*</span><span class="n">f1</span><span class="p">;</span>
<span class="n">FLD</span> <span class="o">*</span><span class="n">f2</span><span class="p">;</span>
<span class="n">FLD</span> <span class="o">*</span><span class="n">f3</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">op</span><span class="p">;</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Parameters</strong></p>
<dl class="simple">
<dt>fo</dt><dd><p>The math unit to change.</p>
</dd>
<dt>type1</dt><dd><p>The type of the first operand.</p>
</dd>
<dt>type2</dt><dd><p>The type of the second operand.</p>
</dd>
<dt>func</dt><dd><p>Pointer to the function to perform the operation.</p>
</dd>
<dt>ofunc</dt><dd><p>Pointer to pointer to function. The pointer to function will be
stuffed with the old function to perform the operation. This can be
used to add some cases, and keep the old functionality in others.
The return value should be 0 for success. The result of the
operation should be put in f3.</p>
</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;sys/types.h&gt;</span>
<span class="c1">#include &quot;dbquery.h&quot;</span>

<span class="n">fop_type</span> <span class="n">o_ftich</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">the</span> <span class="n">pointer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">handler</span> <span class="o">*/</span>

<span class="nb">int</span>
<span class="n">n_ftich</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
<span class="n">FLD</span>     <span class="o">*</span><span class="n">f1</span><span class="p">;</span>
<span class="n">FLD</span>     <span class="o">*</span><span class="n">f2</span><span class="p">;</span>
<span class="n">FLD</span>     <span class="o">*</span><span class="n">f2</span><span class="p">;</span>
<span class="nb">int</span>     <span class="n">op</span><span class="p">;</span>
<span class="p">{</span>
        <span class="n">TIMESTAMP</span>       <span class="o">*</span><span class="n">ts</span><span class="p">;</span>
        <span class="n">double</span>          <span class="n">d</span><span class="p">;</span>
        <span class="nb">int</span>             <span class="n">n</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">!=</span> <span class="n">FOP_ASN</span><span class="p">)</span>      <span class="o">/*</span> <span class="n">We</span> <span class="n">only</span> <span class="n">know</span> <span class="n">about</span> <span class="n">assignment</span><span class="o">.</span> <span class="o">*/</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">o_ftich</span><span class="p">)</span>
                        <span class="k">return</span> <span class="p">((</span><span class="o">*</span><span class="n">o_ftich</span><span class="p">)(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">op</span><span class="p">));</span>
                <span class="k">else</span>
                        <span class="k">return</span> <span class="n">FOP_EINVAL</span><span class="p">;</span>

        <span class="o">/*</span> <span class="n">Set</span> <span class="n">up</span> <span class="n">the</span> <span class="k">return</span> <span class="n">field</span><span class="o">.</span> <span class="o">*/</span>
        <span class="n">f3</span><span class="o">-&gt;</span><span class="nb">type</span> <span class="o">=</span> <span class="n">FTN_TIMESTAMP</span><span class="p">;</span>
        <span class="n">f3</span><span class="o">-&gt;</span><span class="n">elsz</span> <span class="o">=</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">);</span>
        <span class="n">f3</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">);</span>
        <span class="n">f3</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">f3</span><span class="o">-&gt;</span><span class="n">alloced</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">void</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>

                <span class="n">v</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">));</span>
                <span class="n">setfld</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">));</span>
                <span class="n">f3</span><span class="o">-&gt;</span><span class="n">alloced</span> <span class="o">=</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">TIMESTAMP</span><span class="p">);</span>
        <span class="p">}</span>

<span class="o">/*</span> <span class="n">First</span> <span class="mi">0</span> <span class="n">out</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">elements</span> <span class="o">*/</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">getfld</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">year</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">month</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">day</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ts</span><span class="o">-&gt;</span><span class="n">fraction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Now</span> <span class="n">read</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">values</span> <span class="o">*/</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">getfld</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">NULL</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">%hu</span><span class="s2">/</span><span class="si">%hu</span><span class="s2">/</span><span class="si">%hd</span><span class="s2"> </span><span class="si">%hu</span><span class="s2">:</span><span class="si">%hu</span><span class="s2">:</span><span class="si">%hu%lf</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">month</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">day</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">year</span><span class="p">,</span>
                <span class="o">&amp;</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">hour</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">minute</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>

<span class="o">/*</span> <span class="n">Convert</span> <span class="nb">any</span> <span class="n">fractional</span> <span class="n">seconds</span> <span class="n">into</span> <span class="n">the</span> <span class="n">appropriate</span> <span class="n">number</span>
   <span class="n">of</span> <span class="n">billionths</span> <span class="n">of</span> <span class="n">a</span> <span class="n">second</span><span class="o">.</span>
<span class="o">*/</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">ts</span><span class="o">-&gt;</span><span class="n">fraction</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="mi">1000000000</span> <span class="p">;</span>
<span class="p">}</span>

 <span class="o">.</span>
 <span class="o">.</span>
 <span class="o">.</span>
        <span class="n">fosetop</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span> <span class="n">FTN_TIMESTAMP</span><span class="p">,</span> <span class="n">FTN_CHAR</span><span class="p">,</span> <span class="n">n_ftich</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">o_ftich</span><span class="p">);</span>
 <span class="o">.</span>
 <span class="o">.</span>
 <span class="o">.</span>
</pre></div>
</div>
<p>This example adds an operator to allow the assignment of a TIMESTAMP
field from a character string. See dbaddtype for the definition of
TIMESTAMP.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Moat Crossing Systems.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>